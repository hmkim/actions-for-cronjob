<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>준이어데브</title>
        <description>야금야금 모으는 지식 저장소</description>
        <link>junebuug.github.io/</link>
        <atom:link href="junebuug.github.io/feed.xml" rel="self" type="application/rss+xml"/>
        <pubDate>Sat, 04 May 2019 14:24:06 +0000</pubDate>
        <lastBuildDate>Sat, 04 May 2019 14:24:06 +0000</lastBuildDate>
        <generator>Jekyll v3.8.5</generator>
        <image>
        <url>https://junebuug.github.io/assets/favicon-32x32.png</url>
		<title>준이어데브</title>
		<link>junebuug.github.io </link>
        </image>
        
        <item>
            <title>MIL(Monthly I learned) 4월 공유</title>
            <description>&lt;p&gt;TIL (Today I Learned) 는 매일 매일 배운 점을 적는 것인데요.&lt;/p&gt;

&lt;p&gt;매일 매일 무언가를 지속해나간다는 건 참으로 힘든 일이네요.&lt;/p&gt;

&lt;p&gt;그래도 다달이 하나쯤 공유하는 건 어렵지 않을 테니, 열심히 정리해보려고 합니다.&lt;/p&gt;

&lt;h3 id=&quot;dto-data-transfer-object-만들-때-annotation-팁&quot;&gt;DTO (Data Transfer Object) 만들 때 annotation 팁&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;필드 하나만 바꿔야 하면 JsonProperty,&lt;/li&gt;
  &lt;li&gt;클래스 레벨에서 전략을 적용해서 일괄로 바꾸려면 JsonNaming,&lt;/li&gt;
  &lt;li&gt;애플리케이션 전체에서 전략을 적용해서 일괄로 바꾸려면 프로퍼티 파일에서 spring.jackson.property-naming-strateg 을 통해 바꾸면 엄청 편해요.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;by 사수님&lt;/p&gt;

&lt;h3 id=&quot;jpa-에서-여러-칼럼을-합쳐서-unique-key를-걸고-싶을-때&quot;&gt;JPA 에서 여러 칼럼을 합쳐서 unique key를 걸고 싶을 때&lt;/h3&gt;

&lt;p&gt;예를 들어 칼럼에 이름와 이메일이 있는데 합쳐서 unique key를 걸고 싶다는 말은,&lt;/p&gt;

&lt;p&gt;(june, “abcd@naver.com”) 과 (june, “abcd@gmail.com”) 은 중복해서 들어갈 수 있지만&lt;/p&gt;

&lt;p&gt;이름도 이메일도 같은 경우는 들어갈 수 없다는 것이다.&lt;/p&gt;

&lt;p&gt;그럴 땐 엔티티 위에 다음과 같이 적어주자.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Table&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;테이블이름&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;uniqueConstraints&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@UniqueConstraint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;columnNames&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;칼럼이름1&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;칼럼이름2&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;칼럼이름3&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})})&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;querydsl-에서-앞뒤로-like검색하기&quot;&gt;queryDsl 에서 앞뒤로 Like검색하기&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;containsIgnoreCase&lt;/code&gt; 사용&lt;/p&gt;

&lt;h3 id=&quot;java-optional-사용-시&quot;&gt;Java Optional 사용 시&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;orElseThrow 는 getOrElseThrow 를 줄인 것. 즉, empty도 잡아준다 !&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;jpa에서-id-list로-검색하고-싶을-때&quot;&gt;JPA에서 id List로 검색하고 싶을 때&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;findByIdIn&lt;/code&gt; 을 사용하면 된다. idList를 넘겨주면 해당하는 값들이 entity로 뽑혀나온다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;하지만 주의! idList의 순서대로 나오지는 않는다. 테이블에서 매긴 랭크 (id 값)으로 나옴.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;그래서 나는 따로 stream으로 sorted 해주었다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;sorted(Comparator.comparingInt(o -&amp;gt; idList.getIndexof(o.getId)))&lt;/code&gt; 였던 것 같은데. 소스가 기억은 안난다. idList의 인덱스로 비교해서 다시 정렬해줌.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;매우 칭찬 받았다. 😙&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;brew-cask-와의-만남&quot;&gt;brew cask 와의 만남&lt;/h3&gt;

&lt;p&gt;java 11 로 업데이트하면서 만나게 되었음.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;커맨드라인에서 맥용 어플을 설치하게 해주는 유틸리티&lt;/li&gt;
  &lt;li&gt;즉, 그냥 앱들도 설치 가능&lt;/li&gt;
  &lt;li&gt;brew가 이미 있다면 &lt;code class=&quot;highlighter-rouge&quot;&gt;brew tap caskroom/cask&lt;/code&gt; 로 설치가 가능함.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;brew cask search 어플이름&lt;/code&gt; 어플을 찾을수있음&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#1. Install homebrew&lt;/span&gt;

/usr/bin/ruby &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;$(&lt;/span&gt;curl &lt;span class=&quot;nt&quot;&gt;-fsSL&lt;/span&gt; https://raw.githubusercontent.com/Homebrew/install/master/install&lt;span class=&quot;k&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# 2. Update homebrew if already installed:&lt;/span&gt;

brew update
&lt;span class=&quot;c&quot;&gt;# 3.  allow brew to lookup versions&lt;/span&gt;

brew tap caskroom/versions

&lt;span class=&quot;c&quot;&gt;# 4. list available java versions&lt;/span&gt;

brew search java

&lt;span class=&quot;c&quot;&gt;# Optional: to find out the minor version of java&lt;/span&gt;
brew cask info java8

&lt;span class=&quot;c&quot;&gt;# 5.install java 8 (or any other version available)&lt;/span&gt;
brew cask install java8

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;deprecated-너는-어디까지-가니-&quot;&gt;@Deprecated 너는 어디까지 가니 🤔&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Deprecated 태그는 어디에나 붙을 수 있나?&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;정의를 보자&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nd&quot;&gt;@Target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;={&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CONSTRUCTOR&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;FIELD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LOCAL_VARIABLE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;METHOD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PACKAGE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARAMETER&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TYPE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;생성자, 필드, 로컬변수, 메소드, 패키지, 파라미터, 타입까지&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;mockito-직관적으로-이해하기&quot;&gt;Mockito 직관적으로 이해하기&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@InjectMocks&lt;/code&gt; 는 위에 mock이나 spy로 표시한 애들을 넣어준다.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@mock&lt;/code&gt;은, 그냥 null로 표시 안될 깡통 instance 만들어주는거.&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@spy&lt;/code&gt;는 실제로 동작하는 instance 만들어주는거. 안에 있는 로직이 다 돈다. 부분적으로 mocking해서 원하는 동작을 하게 할 수 있다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;MIL, 내받코리처럼 종종 써먹자 !&lt;/p&gt;
</description>
            <pubDate>Sat, 04 May 2019 00:00:00 +0000</pubDate>
            <link>/2019-05-04/monthly-I-learned</link>
            <guid isPermaLink="true">junebuug.github.io/2019-05-04/monthly-I-learned</guid>
            
            <category>Java</category>
            
            <category>CodeReview</category>
            
            
        </item>
        
        <item>
            <title>NDC(Nexon Developer Conference) 2019, &lt;FIFA 온라인 4&gt; 서버 포스트모템 후기</title>
            <description>&lt;p&gt;발표자료는 올라올테지만, 가장 인상깊게 들었던 발표를 들으며 적었던 노트를 날것으로 (ㅋㅋ) 공유합니다.&lt;/p&gt;

&lt;h2 id=&quot;fifa-온라인-4-서버-포스트모템&quot;&gt;&amp;lt;FIFA 온라인 4&amp;gt; 서버 포스트모템&lt;/h2&gt;

&lt;p&gt;김에스더님 From EA Korea&lt;/p&gt;

&lt;p&gt;런칭 이전에 서버 준비과정부터 런칭 이후 운영 이슈까지 공유하고자 함&lt;/p&gt;

&lt;p&gt;Microservices on Kubernetes(오케스트레이션 툴)&lt;/p&gt;

&lt;h3 id=&quot;서버-아키텍쳐&quot;&gt;서버 아키텍쳐&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;피파온라인4는 FIFA시리즈 바탕 온라인 게임&lt;/li&gt;
  &lt;li&gt;아시아 4개국, PC와 모바일로 서비스 중&lt;/li&gt;
  &lt;li&gt;전작 피파3은 &lt;strong&gt;Monolithic Architecture&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;하나의 애플리케이션에 모든 구현이 담겨있었음 (Db- Game Server - User Interface)&lt;/li&gt;
      &lt;li&gt;세가지 단점
        &lt;ul&gt;
          &lt;li&gt;장애 → 전체 서비스 장애&lt;/li&gt;
          &lt;li&gt;작은 변경을 위해 전체 서버 빌드 및 배포 필요&lt;/li&gt;
          &lt;li&gt;비효율적인 서버 Scale out 비용 (휴일 등 트래픽 대응에 전체 서버를 스케일 아웃해야했음.)&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;MicroService Architecture&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;여러개를 합쳐서 운영하는 방식&lt;/li&gt;
      &lt;li&gt;개발 속도가 빠르다&lt;/li&gt;
      &lt;li&gt;배포가 쉽다&lt;/li&gt;
      &lt;li&gt;서버 장애의 영향도가 일부 서비스에 국한된다&lt;/li&gt;
      &lt;li&gt;스케일링이 쉽고 효율적이다&lt;/li&gt;
      &lt;li&gt;백엔드는 RabbitMQ, MongoDB, Redis 등을 사용함.  (서비스 단의 메시지 통신을 위해 메시지 큐)&lt;/li&gt;
      &lt;li&gt;서비스 모니터링을 위한 Grafana 등으로 구성&lt;/li&gt;
      &lt;li&gt;대표적인 서비스 - GateWay, Auth, Session, API, Data, Log, Chat, Noti, Matchmaker&lt;/li&gt;
      &lt;li&gt;로그인 : Gateway가 받아서 처리할 수 있는 Authenticate 서비스에 보냄&lt;/li&gt;
      &lt;li&gt;전달하는 매개체는 RabbitMQ&lt;/li&gt;
      &lt;li&gt;훨씬 복잡한 구성이 있기때문에, hop이 길어지는 경우도 많음&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;배포&quot;&gt;배포&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;배포해야 하는 대상이 너무 많음
    &lt;ul&gt;
      &lt;li&gt;게이트웨이&lt;/li&gt;
      &lt;li&gt;인증&lt;/li&gt;
      &lt;li&gt;알림&lt;/li&gt;
      &lt;li&gt;로그&lt;/li&gt;
      &lt;li&gt;데이터&lt;/li&gt;
      &lt;li&gt;매치메이킹 등 .. 40가지 서버 부자가 되었다.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;이렇게 많은 종류의 서비스를 라이브 서버에 어떻게 배포하지?
    &lt;ul&gt;
      &lt;li&gt;config 하나하나 작성해서 40번 올리면 되지 🙂&lt;/li&gt;
      &lt;li&gt;이걸 관리할 수 있는 오케스트레이션 툴&lt;/li&gt;
      &lt;li&gt;구동, 배포, 관리하기 위해서 &lt;strong&gt;Kubernetes를 사용&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;구글이 개발, 선택하게 된 이유 중&lt;/li&gt;
      &lt;li&gt;라이브 서비스를 하기에 적합한 툴이라는 생각이 들음
        &lt;ul&gt;
          &lt;li&gt;장애나 형상관리를 할 때 유용한 Feature 들&lt;/li&gt;
          &lt;li&gt;Rolling Update&lt;/li&gt;
          &lt;li&gt;Version Control&lt;/li&gt;
          &lt;li&gt;Auto Scaling&lt;/li&gt;
          &lt;li&gt;Resource Allocation 이 가능하다.&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;kubernetes-cluster&quot;&gt;Kubernetes Cluster&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Master - Node 의 단순한 구조&lt;/li&gt;
  &lt;li&gt;Master의 요소랑 일반 노드의 요소랑 다름&lt;/li&gt;
  &lt;li&gt;Master는 관리자 역할이 있으니까, 다양 - DNS 서버, API 서버, Scheduler, Controller Manager&lt;/li&gt;
  &lt;li&gt;클러스터 마스터에 명령을 내릴 때 실제 명령을 내리게 해주는 매개가 API 서버 (이를 통해 cluster 내에서, 그리고 관리자와 소통)&lt;/li&gt;
  &lt;li&gt;Node 내에는 Kubelet이라는 노드 agent가 뜸.&lt;/li&gt;
  &lt;li&gt;node 마다 role을 줄 수 있는데, role에 따라 어떤 서비스를 띄울 지 결정할 수 있음&lt;/li&gt;
  &lt;li&gt;e.g.) Backend node는 MQ들이 뜨고, Game node에는 API 서버, cronjobs, data server 가 뜨는 방식&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;서비스-배포-단계&quot;&gt;서비스 배포 단계&lt;/h4&gt;

&lt;ol&gt;
  &lt;li&gt;서비스 빌드 &amp;amp; 업로드&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Kubernetes Manifest 작성 ← 어려움&lt;/strong&gt;, Kubernetes 적용 config
    &lt;ul&gt;
      &lt;li&gt;작성하는 포맷이 복잡하여 작성 작업이 시간이 크게 소요됨&lt;/li&gt;
      &lt;li&gt;스키마가 다 다름&lt;/li&gt;
      &lt;li&gt;indentation 이 중요 ( yml 파일임 ㅠㅠ)&lt;/li&gt;
      &lt;li&gt;오타 등 실수가 감지하기 어려움&lt;/li&gt;
      &lt;li&gt;히스토리 관리와 공유가 어려움&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
  &lt;p&gt;Helm이라는 패키지 매니저를 통해서 Manifest를 관리 및 배포 프로세스  구축 + Jenkins와 Herfos(?)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Helm&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;버전 컨트롤 뿐아니라 manifest respository 구성 가능 → 어떻게 manifest 작성할지 막막할때 helm 오피셜 repo에서 fetch 해올수 있음&lt;/li&gt;
  &lt;li&gt;방식이 좀 달라서, 지속적으로 변경이 일어나는 상수 부분을 대체할 수 있음.&lt;/li&gt;
  &lt;li&gt;40개의 서비스 manifest에 버전이나 서버 갯수를 바꿔야한다면..?!&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;배포-프로세스&quot;&gt;배포 프로세스&lt;/h4&gt;

&lt;p&gt;레포에 manifest 커밋 → 젠킨스 job CI → Jenkins가 helm repo에 manifest push → 서버에서 fetch 해감&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;서버에 Manifest 적용하여 서비스 업데이트&lt;/li&gt;
&lt;/ol&gt;

&lt;h5 id=&quot;장점&quot;&gt;장점&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;배포 히스토리 관리&lt;/li&gt;
  &lt;li&gt;Helm 기능으로 설정 오류 감소 , 오류 보정됨&lt;/li&gt;
  &lt;li&gt;팀내 sync up&lt;/li&gt;
  &lt;li&gt;작업시간 감소&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;stability&quot;&gt;Stability&lt;/h3&gt;

&lt;p&gt;어떻게 서비스를 안정적으로 ?&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;서비스 오픈날도 장애없이 4개 국 동시 운영&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;장애 대비와 대응을 어떻게 했나? 🤨&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;Microservice Architecture&lt;/p&gt;

    &lt;p&gt;부하가 전체 서비스가 아닌 일부에만 영향을 준다!&lt;/p&gt;

    &lt;p&gt;match maker라든지 일부 서비스만 다운되면 로그인해서, 거래 시장 이용, 채팅 등은 문제가 없는 부분!&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;단점일 때도 있었음..&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;어떤 서비스에 얼마만큼의 영향을 주는지 파악하기 힘들다&lt;/li&gt;
      &lt;li&gt;물리서버 발주하는 시점에서(ㅋㅋㅋ) 서비스가 얼마나 리소스를 사용하는지 모름! 😢&lt;/li&gt;
      &lt;li&gt;매치 1판 할때 어떤 서비스에 얼마만큼 부하가 발생하는지 명확하게 알 수 있을까..?&lt;/li&gt;
      &lt;li&gt;Monolithic 이면 부하만 보면 단순히 계산이 되는데!&lt;/li&gt;
      &lt;li&gt;Micro 인 경우 - Gateway 부하가 얼마고, log에, match maker에 부하가 얼마나 들어가는지 계산이 어려움. 커뮤니케이터인 RabbitMQ인 경우 MQ의 부하도 생각해야하고, DB도 생각하고 …&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;대규모 로드테스트를 하게 됨&lt;/strong&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;대규모-로드테스트&quot;&gt;대규모 로드테스트&lt;/h4&gt;

&lt;p&gt;CBT나 OBT말고 대규모(동접 30만 기준)&lt;/p&gt;

&lt;p&gt;criteria를 정함 : &lt;strong&gt;서버가 초당 3만 건 요청을 처리할 수 있어야 부하를 견딜 수 있다!&lt;/strong&gt; 라고 생각함&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;유저 시나리오를 작성&lt;/li&gt;
  &lt;li&gt;AWS 로드 테스트 서버 구축
    &lt;ul&gt;
      &lt;li&gt;라이브 서버와 똑같이 Kubernetes 구성,  HA 구성, LoadBalancer도 붙임&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;로드 테스트 실행&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;기준(criteria)을 통과할 때까지 반복 실행&lt;/strong&gt;&lt;/p&gt;

&lt;h5 id=&quot;뭐가-좋아요&quot;&gt;뭐가 좋아요?&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;부하가 높을 때만 발생하는 문제를 확인할 수 있음&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;e.g.) 부하가 높을 때 →  서비스의 메모리 100% 차는 현상&lt;/li&gt;
  &lt;li&gt;처음에 말한 목적처럼 &lt;strong&gt;리소스 측정해서 할당 할 수 있음&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;미처-대비하지-못한-문제&quot;&gt;미처 대비하지 못한 문제&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;패치 데이터 오류&lt;/li&gt;
  &lt;li&gt;발견하기 어려운 서버 코드 버그&lt;/li&gt;
  &lt;li&gt;CPU 나 메모리등의 서버 리소스 사용량 급증&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;이런 문제가 발생했을 때 &lt;strong&gt;Kubernetes를 사용해서 해결&lt;/strong&gt;&lt;/p&gt;

&lt;h5 id=&quot;solution-1&quot;&gt;&lt;strong&gt;Solution #1&lt;/strong&gt;&lt;/h5&gt;

&lt;p&gt;Server Hotfix : Rolling Update&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;유저 몰래 업데이트 😗&lt;/li&gt;
  &lt;li&gt;점검 없이 rolling update 가능&lt;/li&gt;
  &lt;li&gt;단. 라이브 서비스 중에 재시작되어도 트랜잭션 처리 등 서버 임팩트가 없도록 보장되어야 함&lt;/li&gt;
  &lt;li&gt;에러를 쓰루하는 등의 처리가 명확하지 않으면 CS 처리로 해야함.. 조심해..😭&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;solution-2&quot;&gt;&lt;strong&gt;Solution #2&lt;/strong&gt;&lt;/h5&gt;

&lt;p&gt;손쉬운 명령어로 빠른 Scale out&lt;/p&gt;

&lt;h5 id=&quot;solution-3&quot;&gt;&lt;strong&gt;Solution #3&lt;/strong&gt;&lt;/h5&gt;

&lt;p&gt;auto scaling으로 자동 리소스 관리&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;미연에 장애를 관리할 수 있는 기능&lt;/li&gt;
  &lt;li&gt;“부하가 늘면 자동으로 늘어나네”&lt;/li&gt;
  &lt;li&gt;단, Scale in 이 될수도 있기때문에 이 경우를 고려해야한다&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;monitoring&quot;&gt;Monitoring&lt;/h3&gt;

&lt;p&gt;모니터링 시스템을 구축안해도 Kubernetes Dashboard를 만들어준다 ! 🙂&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;하지만.. 사실상 모니터링보다는 관리자 작업 페이지에 가까움&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;서비스 구성 요소&lt;/li&gt;
  &lt;li&gt;리소스 사용량 확인&lt;/li&gt;
  &lt;li&gt;콘솔 로그 확인&lt;/li&gt;
  &lt;li&gt;서비스 생성 및 삭제&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;위와 같은 기능 제공!&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;리얼 타임으로 이걸 보기엔 괜찮지만 시간을 조절해서 볼수도 없다!&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;필요한-데이터는-뭐지-&quot;&gt;필요한 데이터는 뭐지 🤔&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;물리/VM 서버 상태&lt;/li&gt;
  &lt;li&gt;리소스 사용량&lt;/li&gt;
  &lt;li&gt;Kubernetes 서비스 상태&lt;/li&gt;
  &lt;li&gt;CCU 증감 추이  (게임 서비스의 데이터)&lt;/li&gt;
  &lt;li&gt;서버 응답 지연 및 에러 발견&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;위의 세개는  다음과 같이 해결할 수있는데&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Google Cloud Engine을 사용! (무료)&lt;/li&gt;
  &lt;li&gt;DataDog같은 솔루션을 사용 (유료)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;아래 두개는 다음과 같이 해결할 수있는데&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CCU API를 통해 감시&lt;/li&gt;
  &lt;li&gt;Sentry로 에러 감시&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;솔루션이 나눠져 있는데 통합해서 볼 수 없을까?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;대시보드가 여러 개면&lt;/li&gt;
  &lt;li&gt;뭔가 문제가 있을 때 한번에 보고 파악하기가 어렵다 .&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;custom-monitoring-tool이-필요하다&quot;&gt;&lt;strong&gt;Custom Monitoring Tool이 필요하다!&lt;/strong&gt;&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;Kubernetes + Game Server를 다 보자&lt;/li&gt;
  &lt;li&gt;Kubernetes API Sever (모니터링 통해서 가져올수있는걸 준다)&lt;/li&gt;
  &lt;li&gt;cAdvisor는 container 의 상태를 가져와서 Kublet에게 주고. API Server가 가져가고 싶은것만 Kublet에서 fetch해서 가져감&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;API Server → 프로메테우스에 저장하고 → Grafana(대시보드)&lt;/p&gt;

&lt;p&gt;대시보드가 없을때는 Manifest를 들어가서 확인해야했음 ㅠ.ㅠ&lt;/p&gt;

&lt;p&gt;NEEDS&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;gateway 서버 100개면 평균적인 inbound outbound 값을 보여주고싶은데 그런 툴이 없어서 아직 custom 사용중.&lt;/li&gt;
  &lt;li&gt;처리 건수가 줄어들면 병목 상황을 감지 가능&lt;/li&gt;
  &lt;li&gt;Slow API 가 초당 몇개 발생하고 있는지!&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;summary&quot;&gt;SUMMARY&lt;/h2&gt;

&lt;h3 id=&quot;microservice-단점&quot;&gt;MicroService 단점&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;nanoservice 가 될 수 있음 → 갯수가 너무 늘어남&lt;/li&gt;
  &lt;li&gt;서비스 개수만큼 관리비용이 크다&lt;/li&gt;
  &lt;li&gt;트랜잭션과 같은 로직 구현이 까다롭다
    &lt;ul&gt;
      &lt;li&gt;서비스가 여러개인데 같은 document 에 접근하려고 할 때 로직 구현 어렵&lt;/li&gt;
      &lt;li&gt;lock 걸때 지연속도가 늘어나서 어려움&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;서비스 간 통신 시간만큼의 서비스 처리 속도 증가 (hop 마다 속도가 늘어남)&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;kubernetes-단점&quot;&gt;Kubernetes 단점&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;기본 구성이 매우 복잡하다&lt;/li&gt;
  &lt;li&gt;초기 프로세스를 구축하기 위해 많은 노력&lt;/li&gt;
  &lt;li&gt;소규모에 적합하지 않다&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;장점-1&quot;&gt;장점&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;다양한 기능 제공&lt;/li&gt;
  &lt;li&gt;오토스케일링, 롤링 업데이트, Failover 기능으로 라이브 운영에 적합&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;개인적으로는 게임 서버 뿐 아니라 어떤 서버든 적용되는 내용을 꼼꼼하게 설명해주셔서 좋았다.
아는게 조금 늘어났다고 좀더 이해되는게 너무 신기하고 (그래서 후기도 쓸 수 있었고 ㅋㅋ),
좀더 개발 세션 들어야겠다.&lt;/p&gt;

&lt;p&gt;위의 내용이 발표와 다르거나 틀린 점이 있는 경우 둥글게 댓글 부탁드립니다.&lt;/p&gt;
</description>
            <pubDate>Thu, 25 Apr 2019 00:00:00 +0000</pubDate>
            <link>/2019-04-25/ndc-2019</link>
            <guid isPermaLink="true">junebuug.github.io/2019-04-25/ndc-2019</guid>
            
            <category>Conference</category>
            
            
        </item>
        
        <item>
            <title>스트레티지 패턴 🌚</title>
            <description>&lt;p&gt;HEAD FIRST DESIGN PATTERN 을 정리합니다.&lt;/p&gt;

&lt;h1 id=&quot;01-디자인-패턴-소개--그리고-스트레티지-패턴&quot;&gt;01 디자인 패턴 소개 , 그리고 스트레티지 패턴&lt;/h1&gt;

&lt;h2 id=&quot;상속의-문제점&quot;&gt;상속의 문제점&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;서브 클래스에서 코드가 중복된다&lt;/li&gt;
  &lt;li&gt;모든 서브클래스의 행동을 알기가 어렵다&lt;/li&gt;
  &lt;li&gt;코드를 변경했을 때 원치 않는 서브클래스들에게 영향을 끼칠 수 있다&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;duck-예제&quot;&gt;Duck 예제&lt;/h3&gt;

&lt;p&gt;Duck 종류를 총괄하는 Duck 클래스가 있다.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Duck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    	&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;quack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 꽉&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;swim&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 헤엄&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//오리모양 보여주기&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;이를 상속하는 청둥오리도 있고 고무오리도 있다.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RubberDuck&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    	&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;quack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;고무 꽉&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Duck 이 날 수 있다는 점에 착안해 Duck 에 fly() 메소드를 추가했다&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Duck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    	&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;quack&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 꽉&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;swim&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 헤엄&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;//오리모양 보여주기&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fly&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 새로 추가된 fly?&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;그러고 나서 보니… 고무 오리가 날 수 있게 됐다? 🤔&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RubberDuck&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    	&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fly&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;고무도 날 수 있다!!!! &quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
  &lt;p&gt;날 수 없는 Duck 들은 Override 해서 날 수 없다고 말해주면 되겠네!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;그럼 날 수 없는 Duck이 추가될때마다 오버라이드를 끊임없이 해줘야한다!&lt;/p&gt;

&lt;p&gt;그리고 어떤 Duck들이 날 수 없는지 알 방법이 없네 😭&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Flyable, Quackable 인터페이스를 만들어서, Duck에서 해당 메소드를 제거하고 필요한 Duck만 인터페이스 상속하게 하는 건 어떨까? RubberDuck extends Duck, implements Quackable 하는 식으로!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;그럼 코드 재사용성은 어떡할거야..? (Java 8이하에서는 interface에 default 메소드 를 사용할 수 없는 단점이 있었다.)&lt;/p&gt;

&lt;p&gt;일단 다음 원칙을 기억해서 해결방법을 도출해보자!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;디자인원칙 &lt;code class=&quot;highlighter-rouge&quot;&gt;애플리케이션에서 달라지는 부분을 찾아내고, 달라지지 않는 부분으로부터 분리시킨다.&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;스트레티지-패턴-straetegy-패턴-등장-배경&quot;&gt;스트레티지 패턴 (Straetegy 패턴) 등장 배경&lt;/h2&gt;

&lt;h3 id=&quot;duck-예제에서-달라지는-부분-뽑아보기&quot;&gt;Duck 예제에서 달라지는 부분 뽑아보기&lt;/h3&gt;

&lt;p&gt;fly와 quack은 오리마다 달라지는 부분이네? 이 메소드를 끄집어내서 새로운 클래스로 만들어버리자!&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;최대한 유연하게 만들어야 한다.
    &lt;ul&gt;
      &lt;li&gt;애초에 유연하지 못해서 이렇게 변경하게 생겼으니까💦&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;오리의 행동을 동적으로 바꾸고싶다
    &lt;ul&gt;
      &lt;li&gt;세터 메소드를 만들어 변경할 수 있으면 좋겠네.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;그럼 아까 말한 대로 인터페이스를 뽑아내면 좋겠네.. 그런데 재사용성은 ?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;디자인원칙 &lt;code class=&quot;highlighter-rouge&quot;&gt;구현이 아닌 인터페이스에 맞춰서 프로그래밍한다&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;fly와 quack은 이제 duck에서 표현하지 않아! 대신 우리는 FlyBehavior와 QuackBehavior라는 &lt;strong&gt;인터페이스&lt;/strong&gt;를 만들 생각이야. 예를 들어 FlyBehavior를 상속하는 FlyWithWings 그리고 CantFly 클래스를 사용하면, 날수있는 애들과 못나는 애들끼리 코드를 재사용할 수 있다 👀&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;아하, 그러면 구조가 어떻게 되는거야?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;nd&quot;&gt;@Setter&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Getter&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Duck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FlyBehavior&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flyBehavior&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;performFly&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;flyBehavior&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;fly&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FlyBehavior&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
         &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fly&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FlywithWings&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FlyBehavior&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
         &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;fly&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;난 날 수 있아!!!!!&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
         &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;이제 Duck은 fly메소드를 갖지 않아. 대신 FlyBehavior를 멤버로 가지고. 이 멤버에 뭘 집어 넣어주는 지에 따라서 나는 방식이 달라지겠지?&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MallardDuck&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Duck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MallardDuck&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;flyBehavior&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FlyWithWings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
       &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
       &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// 이 경우&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;MallardDuck&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;duck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MallardDuck&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;duck&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;performFly&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// &quot;난 날 수 있아!!!!!&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;어떨 때는 A는 B이다(메소드, 멤버) 관계보다 A에는 B가 있다(구성) 관계가 나을 때도 있다.&lt;/p&gt;

&lt;p&gt;두 클래스를 이렇게 합치는 것을 &lt;strong&gt;구성(composition)&lt;/strong&gt;이라고 한다네. 구체적으로는 한 클래스가 다른 클래스를 멤버 변수로 갖는 걸 의미하고.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;디자인 원칙 &lt;code class=&quot;highlighter-rouge&quot;&gt;상속보다는 구성을 활용한다&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;무조건적으로 구성이 좋다는 건 아니고, 장단점을 배워야해.&lt;/p&gt;

&lt;p&gt;구성을 활용한 이 패턴은 스트레티지 패턴이라고 부른다. 이름이 겁나 와닿진 않는데, 일단 정의를 보면..&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;알고리즘군을 정의하고 각각을 캡슐화하여 교환해서 사용할 수 있도록만든다. 스트래티지를 활용하면 알고리즘을 사용하는 클라이언트와는 독립적으로 알고리즘을 변경할 수 있다.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;이 정의를 예제에 붙이면 클라이언트는 Duck, 알고리즘은 flyBehavior겠다.&lt;/p&gt;
</description>
            <pubDate>Wed, 17 Apr 2019 00:00:00 +0000</pubDate>
            <link>/2019-04-17/design-pattern-strategy</link>
            <guid isPermaLink="true">junebuug.github.io/2019-04-17/design-pattern-strategy</guid>
            
            <category>DesignPattern</category>
            
            <category>Java</category>
            
            
        </item>
        
        <item>
            <title>Redis 뭔지나 알고가자</title>
            <description>&lt;p&gt;프로젝트에서 like 를 Redis로 관리하고 있다.&lt;/p&gt;

&lt;p&gt;관련해서 한번 짚고 넘어가려고한다.&lt;/p&gt;

&lt;h2 id=&quot;redis&quot;&gt;Redis?&lt;/h2&gt;

&lt;p&gt;기본적으로 Storage, 즉 저장소이다. 가장 큰 특징은 메모리 기반의 Key-value 저장소라는 점이다.&lt;/p&gt;

&lt;p&gt;빠르고, 다양한 데이터 구조체(String, Set, Sorted Set ..)를 지원한다.&lt;/p&gt;

&lt;p&gt;그래서 &lt;strong&gt;큐로도, Cache로도, Dictionary, 세션용도&lt;/strong&gt;로도 다양하게 사용할 수 있다!&lt;/p&gt;

&lt;p&gt;안정성은 보장할 수 없어서 주로 cache로 사용하는 모양이다.&lt;/p&gt;

&lt;p&gt;풀네임은 REmote DIctionary Sever. 공식홈페이지는 &lt;a href=&quot;https://redis.io/&quot;&gt;https://redis.io&lt;/a&gt; 다.&lt;/p&gt;

&lt;h3 id=&quot;key---value--특정한-키-값에-값을-저장한다&quot;&gt;KEY - VALUE : 특정한 키 값에 값을 저장한다&lt;/h3&gt;

&lt;p&gt;json 처럼, 하나의 key에 하나의 value를 매핑하는 형태로 되어있다. (value의 모양은 다양하다).&lt;/p&gt;

&lt;p&gt;key에 대해서 PUT, GET 하는 기능을 지원한다.&lt;/p&gt;

&lt;h3 id=&quot;다양한-데이터-구조체&quot;&gt;다양한 데이터 구조체&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;String
    &lt;ul&gt;
      &lt;li&gt;일반적인 문자열을 지원한다. Text 문자열 뿐 아니라 숫자나 이미지 같은 바이너리 파일도 저장이된다.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Set
    &lt;ul&gt;
      &lt;li&gt;순서가 없는 집합이다. SET 간의 연산 (합집합, 교집합, 차집합)을 지원한다.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Sorted Set
    &lt;ul&gt;
      &lt;li&gt;순서가 생긴 집합! 오름차순으로 내부 정렬된다.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Hash
    &lt;ul&gt;
      &lt;li&gt;hash 자체는 field - string 쌍으로 이루어진 구조체이다. 결국 이를 redis에 저장하면 key- field - string 쌍이 된다.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;List
    &lt;ul&gt;
      &lt;li&gt;String의 집합이지만 link list같은 형태이다. 앞뒤로 push와 pop이 가능하며, 순서가 있어 특정 위치를 지정할 수 있다.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;메모리면-너무-위험한데-디스크에-데이터-저장하는-건-없어&quot;&gt;메모리면 너무 위험한데.. 디스크에 데이터 저장하는 건 없어?&lt;/h3&gt;

&lt;p&gt;메모리에 데이터를 저장하면 서버가 꺼진 이후에는 데이터가 유실된다. 이런 것을 막기 위해서 디스크에 저장할 수 있다. 두 가지 방식이 있는 데 둘다 안일함..&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;스냅샷 방식(RDB) 방식
    &lt;ul&gt;
      &lt;li&gt;순간적으로 메모리에 있는 내용을 전체를 사진을 찍어 옮겨 담는 방식
        &lt;ul&gt;
          &lt;li&gt;SAVE : 순간적으로 redis 동작을 정지시킨다음 사진을 찍는 방식&lt;/li&gt;
          &lt;li&gt;BGSAVE:  별도 프로세스를 띄워서 명령어 수행 당시의 사진을 찍음&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;장점: 스냅샷 크기가 일정하고, 서버 리스타트시 스냅샷만 로드하면 되므로 리스타트 시간이 빠르다&lt;/li&gt;
      &lt;li&gt;단점: 스냅샷 시점 이후의 데이터를 유실된다. 스냅샷을 찍는데 오래걸린다.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;AOF 방식 (Append On File)
    &lt;ul&gt;
      &lt;li&gt;사용된 명령어들을 모두 로깅하는 방식. 서버가 재시작되면 순차적으로 명령어를 실행해서 데이터를 복구한다.
        &lt;ul&gt;
          &lt;li&gt;장점: 로그파일에 append하기때문에 log write 속도가 빠르고, 서버가 다운되더라도 해당 시점까지 복구가 가능함&lt;/li&gt;
          &lt;li&gt;단점: 무한히 늘어나는 로그파일… 데이터양이 갈수록 커진다. 따라서 리스타트 후 데이터가 복구되는 시간도 길다.&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;요거를 좀 보완하기 위해서 &lt;strong&gt;rewrite&lt;/strong&gt; 를 하기도 한다. write - delete 명령이 있다면 이를 삭제해서 좀 줄이는 식이다.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;둘다 장단이 있고 안일해서(…) 섞어 써야한다고 한다.&lt;/p&gt;

&lt;h3 id=&quot;싱글스레드-입니다&quot;&gt;싱글스레드 입니다&lt;/h3&gt;

&lt;p&gt;싱글스레드이기때문에 keys() 같은 명령어를 때리면 무한히 뒤에 명령어들이 기다리게 된다.&lt;/p&gt;

&lt;p&gt;유의합시다~,~&lt;/p&gt;

&lt;h3 id=&quot;master---slave-그리고-sentinel&quot;&gt;Master - Slave, 그리고 Sentinel&lt;/h3&gt;

&lt;p&gt;Redis 한대로는 유실의 위험이 계속 있고, Redis 자체가 죽을 경우가 있다.&lt;/p&gt;

&lt;p&gt;이때를 대비해서 Slave를 만든다. 그리고 주기적으로 master 정보를 slave에 내려준다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/2019-03-29/redis-ha.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;마스터와 슬레이브만으로는 서버가 내려갔을 때 보장을 하기가 어렵기 때문에 sentinel이라는 보초를 단다.&lt;/p&gt;

&lt;p&gt;그래서 마스터와 슬레이브가 살아있는지 계속해서 감시한다.&lt;/p&gt;

&lt;p&gt;안일한(…) redis에 비해 redis client는 상당히 스마트해야한다.&lt;/p&gt;

&lt;p&gt;맨 처음에 바로 master에게 가는 게 아니라&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;sentinel에 먼저 master가 떠있는지 물어보고, 마스터에 접근해서 액션을 수행&lt;/strong&gt;한다.&lt;/p&gt;

&lt;p&gt;우리의 redis master는 sentinel이 자기를 감시하고 있는지도 모른다. 맹충이&lt;/p&gt;

&lt;p&gt;sentinel은 master에 문제가 생길 경우에 바로 slave에 바꿔치기하는 failover 를 수행한다.&lt;/p&gt;

&lt;hr /&gt;
&lt;h2 id=&quot;redis-cluster&quot;&gt;Redis Cluster&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;목적&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;1000대의 노드까지 확장할 수 있도록 설계되었다 (서버의 갯수를 늘리는, scale out)&lt;/p&gt;

&lt;p&gt;노드를 추가하거나 삭제할 때 클러스터 전체를 중지할 필요가 없게&lt;/p&gt;

&lt;p&gt;키 이동시에만 해당 키에 대해서 잠시 멈출 수 있다&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;그러면 키 할당은 어떻게 나눠?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;입력된 키가 있다고 하자. 그리고 레디스 서버가 10대 있다고 하자.&lt;/p&gt;

&lt;p&gt;이때 입력된 키를 1-100 사이의 숫자로 바꿔주는 해시 함수(Hash function) 을 적용해서 변환한다.&lt;/p&gt;

&lt;p&gt;그리고 1-10 의 키는 1번 서버에, 11-20은 2번 서버에, … 91-100번은 10번 서버에 할당한다.&lt;/p&gt;

&lt;p&gt;이때 1-100의 숫자를 슬롯이라고  말한다.&lt;/p&gt;

&lt;p&gt;레디스 클러스터는 16384개의 슬롯을 사용한다. (2의 13승이네)&lt;/p&gt;

&lt;p&gt;레디스 노드(서버)가 3개 일 경우, 1번 노드는 0-5460, 2번 노드는 5461 - 10922, 3번 노드는 10923-16383 슬롯을 갖게 된다.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;얘네도 센티널 필요함?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;레디스 클러스터에는 별도의 센티널이 필요없다.&lt;/p&gt;

&lt;p&gt;센티널이 해주는 장애조치(failover)를 서로 서로 해주기 때문인데, 한 마스터가 다운될 경우 다른 마스터들이 장애조치를 진행한다. 마스터가 다운되어도 걱정 말라구~ 🙈&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;못하는 건 뭐야?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;일반적으로 transaction이라고 부르는, 멀티 키 명령어는 못씀. (특히 data merge!)&lt;/p&gt;

&lt;p&gt;transaction이라고 하면 보통 명령어의 묶음이 atomic하게 (all or nothing)으로 실행되는 걸 의미하는데,&lt;/p&gt;

&lt;p&gt;redis에서는 &lt;code class=&quot;highlighter-rouge&quot;&gt;MULTI&lt;/code&gt;라는 명령어로 transaction 을 시작한다.&lt;/p&gt;

&lt;p&gt;하지만 redis cluster에서는 이런 명령을 수행할 수 없다! 일단 키들이 나눠져있는데, data merge를 실행한다고 하면 노드간 데이터를 전송해야한다. 성능이 우선인 redis에는 그런게 병목현상이 될 수 있고, 치명적인 현상이 되기 때문임!&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;참고&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://redisgate.jp/redis/cluster/cluster_introduction.php&quot;&gt;http://redisgate.jp/redis/cluster/cluster_introduction.php&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bcho.tistory.com/654&quot;&gt;https://bcho.tistory.com/654&lt;/a&gt;&lt;/p&gt;
</description>
            <pubDate>Fri, 29 Mar 2019 00:00:00 +0000</pubDate>
            <link>/2019-03-29/redis-basics</link>
            <guid isPermaLink="true">junebuug.github.io/2019-03-29/redis-basics</guid>
            
            <category>Redis</category>
            
            
        </item>
        
        <item>
            <title>JAVA url 매핑 정규식 공유</title>
            <description>&lt;p&gt;테스트를 8개 정도밖에 만들지 못했지만, 
일단 원하는 바에 부합하는 정규식인 듯 하여 블로그에 작성해 둡니다.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-regex&quot;&gt;^((http|https)://)?(www.)?([a-zA-Z0-9]+)\.[a-z]+([a-zA-Z0-9.?#]+)?
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
  &lt;li&gt;http나 https로 시작하는 경우에는 ://가 반드시 붙는다. Optional.&lt;/li&gt;
  &lt;li&gt;www. 로 시작하는 경우가 있다. Optional.&lt;/li&gt;
  &lt;li&gt;알파벳 혹은 숫자를 포함한 문자열이 반드시 1개 이상 있다.&lt;/li&gt;
  &lt;li&gt;이후에 &lt;code class=&quot;highlighter-rouge&quot;&gt;.&lt;/code&gt; 이 반드시 하나 포함된다. (.)&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;.&lt;/code&gt; 를 기점으로 이후에 소문자가 반드시 1개 이상 포함됨&lt;/li&gt;
  &lt;li&gt;이후에는 계속해서 영문자, 숫자, 특수문자가 붙을 수 있다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Java String으로는 다음과 같이 표기&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;regex&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;^((http|https)://)?(www.)?([a-zA-Z0-9]+)\\.[a-z]+([a-zA-z0-9.?#]+)?&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;june (x)&lt;/li&gt;
  &lt;li&gt;website (x)&lt;/li&gt;
  &lt;li&gt;http:web.site(x)&lt;/li&gt;
  &lt;li&gt;naver.com (O)&lt;/li&gt;
  &lt;li&gt;www.web.site(O)&lt;/li&gt;
  &lt;li&gt;https://web.site.sth(O)&lt;/li&gt;
  &lt;li&gt;http://web.site(O)&lt;/li&gt;
  &lt;li&gt;https://june.me(O)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;https://www.regexplanet.com/share/index.html?share=yyyyuw9406r&quot;&gt;데모보기&lt;/a&gt;&lt;/p&gt;
</description>
            <pubDate>Mon, 04 Mar 2019 00:00:00 +0000</pubDate>
            <link>/2019-03-04/java-url-regex</link>
            <guid isPermaLink="true">junebuug.github.io/2019-03-04/java-url-regex</guid>
            
            <category>Java</category>
            
            <category>Regex</category>
            
            
        </item>
        
        <item>
            <title>JPA 영속성 컨텍스트 정리</title>
            <description>&lt;h2 id=&quot;영속성-컨텍스트&quot;&gt;영속성 컨텍스트&lt;/h2&gt;

&lt;p&gt;JPA를 사용하고 테스트를 짜다보면 영속성 컨텍스트를 몰라서 오류를 겪게되는 일이 생긴다.&lt;/p&gt;

&lt;p&gt;그래서 한번은 짚고 넘어가야겠다는 생각에 참고글을 나름대로 정리해보았다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/2019-02-28/persistence.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;정의&quot;&gt;정의&lt;/h2&gt;

&lt;p&gt;영속성 컨텍스트는 엔티티를 저장하는 환경이다. 엔티티 하나하나를 식별자 값(&lt;code class=&quot;highlighter-rouge&quot;&gt;@Id&lt;/code&gt;)로 구한다.&lt;/p&gt;

&lt;p&gt;이 컨텍스트는 &lt;code class=&quot;highlighter-rouge&quot;&gt;EntityManager&lt;/code&gt; 객체 당 하나가 만들어진다. (Manager는 팩토리에서 만들어진다.)&lt;/p&gt;

&lt;p&gt;위 그림에서의 메소드는 &lt;code class=&quot;highlighter-rouge&quot;&gt;EntityManager.persist(entity)&lt;/code&gt; 형태로 호출한다.&lt;/p&gt;

&lt;p&gt;영속성 컨텍스트가 관리하는 엔티티는 &lt;code class=&quot;highlighter-rouge&quot;&gt;영속상태(managed)&lt;/code&gt;라고 말한다.&lt;/p&gt;

&lt;h2 id=&quot;특징&quot;&gt;특징&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;JPA는 트랜잭션을 커밋하는 순간, 영속성 컨텍스트에 새롭게 저장된 엔티티를 데이터베이스에 반영한다.&lt;/p&gt;

    &lt;p&gt;(컨텍스트에 저장되는 순간 DB에 바로 반영되는 게 아님 =) )&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;1차 캐시 사용&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;영속성 컨텍스트는 Map 형태로 엔티티를 저장하는데, 이를 &lt;strong&gt;1차 캐시&lt;/strong&gt;라고 부른다.  &lt;code class=&quot;highlighter-rouge&quot;&gt;entityManager.find()&lt;/code&gt;를 호출하면 1차 캐시를 뒤져서 먼저 찾고, 만약 없으면 DB에서 조회해서 1차 캐시로 가져온다. 그 다음 영속상태인 해당 객체를 반환한다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;객체 동일성 보장&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;위에서 말했듯이 1차 캐시에 있는 Entity인스턴스를 반환하기때문에 같은 객체임을 보장한다! (key가 id인 map을 캐시로 사용하기 때문!)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;쓰기 지연 지원&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;트랜잭션 커밋하기 전까지 entity를 DB에 저장하지 않고, 영속성 컨텍스트 내부에 SQL 저장소에 생성 쿼리를 저장해둔다.  트랜잭션을 커밋하면 저장소에 일괄 SQL를 보내서 저장한다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;변경 감지&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;스냅샷이 존재해서,  flush 시점에 스냅샷과 엔티티를 비교해서 변경된 entity를 찾는다. 있으면 수정 쿼리를 날린다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;지연 로딩&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;프록시 객체를 로딩해두고 실제 사용할 때만 영속성 컨텍스트를 통해 데이터를 불러오는 방법.&lt;/p&gt;

    &lt;p&gt;User 내부에  Badge 객체가 있으면, User를 로딩할 땐 Badge 프록시만 가져온다. 실제 badge에 접근할 때 영속성 컨텍스트에 있는 Badge 인스턴스를 가져온다.&lt;/p&gt;

    &lt;p&gt;따라서 detached 상태이면 - 프록시 객체만 있는데 원본과의 연결이 없으므로 지연로딩이 불가능하다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;cascade 는 영속성을 따라 관리합니다&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;JPA 에서 엔티티 선언 시 cascade를 설정하면, 부모가 자식의 영속시점을 조절할 수 있다. 부모가 1차 캐시 들어갈 때 함께 같이 들어가고, 나올때 같이 나오는 등!&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;참고: &lt;a href=&quot;https://hyeooona825.tistory.com/87&quot;&gt;https://hyeooona825.tistory.com/87&lt;/a&gt;&lt;/p&gt;
</description>
            <pubDate>Thu, 28 Feb 2019 00:00:00 +0000</pubDate>
            <link>/2019-02-28/jpa-persistence</link>
            <guid isPermaLink="true">junebuug.github.io/2019-02-28/jpa-persistence</guid>
            
            <category>JPA</category>
            
            <category>PersistenceContext</category>
            
            
        </item>
        
        <item>
            <title>Webpack과 babel이 뭐요</title>
            <description>&lt;p&gt;vue를 어설프게 써보려고, vue-cli 모듈로 프로젝트를 만들면 이런 설명부터 나온다. ‘그냥 디폴트 스펙(webpack &amp;amp; babel) 깔아줄까? 아니면 다른 모듈쓸래? ^_^’ 물론 webpack이랑 babel을 모르면 무슨 얘기인지 모르고 ‘ㅇㅇ.. 깔아줘…’ 할 수밖에 없지만, 그러기에는 너무 바보같으니까 정리해보기로 한다.&lt;/p&gt;

&lt;h2 id=&quot;뭐-자바스크립트는-모듈-import-개념이-없었다고&quot;&gt;뭐 자바스크립트는 모듈 import 개념이 없었다고&lt;/h2&gt;

&lt;p&gt;자바스크립트는 모듈을 지원하지 않는다. 아니 않았다. (ES5) 아니 그러면 한 파일에 모든 코드를 때려넣어야하니..? 하고 생각하면 그것도 아니라고 한다. 커뮤니티에서 이 현실을 개탄하면서 어떻게든 코드를 모듈화 하고 서로 임포트하는 개념을 만들어 냈다. 그렇게 등장한 두가지 스탠다드가 바로 CommonJS 모듈 (node.js 가 쓰는) 과 Asynchronous Module Definition(RequireJS 사용하는) 이다.&lt;/p&gt;

&lt;p&gt;아니, 그렇지만 아무리 그래도 모듈 개념이 없는 건 너무 하잖아.. 하면서 자바스크립트에 새로운 표준이 생겼다. 바로 ECMAScript6 (ES6)다. ES6는 위의 두 스탠다드의 특장점들을 가져와서 새로운 포맷을 만들어냈다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CommonJS 처럼 간결한 문법을 갖추어, 싱글 익스포트 와 순환 의존성 지원함.&lt;/li&gt;
  &lt;li&gt;AMD 처럼 바로 비동기 로딩과 (설정가능한) 모듈 로딩을 지원함.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;거기에 ‘&lt;strong&gt;언어가 모듈을 지원하며’&lt;/strong&gt;  생기는 장점도 추가 되었다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CommonJS보다 문법이 더 간결함.&lt;/li&gt;
  &lt;li&gt;구조가 static하게 분석 가능하고, 최적화도 됨.&lt;/li&gt;
  &lt;li&gt;CommonJS보다 순환 의존성 지원이 잘됨&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;그런데-브라우저는-여전히-파일-단위-모듈을-잘-모른다&quot;&gt;그런데 브라우저는 여전히 파일 단위 모듈을 잘 모른다&lt;/h2&gt;

&lt;p&gt;ES6는 일부 브라우저에서만 지원한다.(크롬, 사파리) 여러 버전의 각기 다른 브라우저는 이런 모듈화를 지원하지 않는 경우도 있다. 하나의 소스로 모든 브라우저에서 보여주는 게 웹의 특장점이다. 그래서 모듈을 하나의 파일로 묶어 네트워크 비용을 최소화 할 수 있어야한다. 이 과정을 번들링 &lt;code class=&quot;highlighter-rouge&quot;&gt;bundling&lt;/code&gt; 이라고 한다.&lt;/p&gt;

&lt;p&gt;웹팩 &lt;code class=&quot;highlighter-rouge&quot;&gt;webpack&lt;/code&gt; 은 모듈 번들러이다. 웹팩의 다음 네가지 개념을 알아보자.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;엔트리&lt;/li&gt;
  &lt;li&gt;아웃풋&lt;/li&gt;
  &lt;li&gt;로더&lt;/li&gt;
  &lt;li&gt;플러그인&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;엔트리&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;엔트리는 의존성 그래프의 시작점을 의미한다. 엔트리 파일을 의존하는 파일은 없고, 엔트리가 A를 의존하고, A가 다시 B, C를 의존하고.. 하는 식으로 모듈이 연결된다. 이때 웹팩은 이미지, 폰트, 스타일시트 역시 모듈로 관리한다. 설정파일에서 엔트리 파일을 지정할 수 있다.&lt;/p&gt;
&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// webpack.config.js&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'./src/main.js'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;이렇게 넣으면 시작점이 src/main.js 가 된다. &lt;code class=&quot;highlighter-rouge&quot;&gt;entry&lt;/code&gt; 키에 시작점 경로를 지정한다.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;아웃풋&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;엔트리에 설정한 자바스크립트 파일을 시작으로, 의존되어 있는 모듈을 하나로 묶어서 내보낸다 (번들링). 번들된 결과물이 나오는 위치는 &lt;code class=&quot;highlighter-rouge&quot;&gt;output&lt;/code&gt; 키에 기록한다.&lt;/p&gt;
&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// webpack.config.js&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'bundle.js'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
        &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'.dist'&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;dist 폴더에 bundle.js 파일에 결과가 나오게 된다.&lt;/p&gt;

&lt;p&gt;html 파일에는 번들링된 이 파일만 나오게 되면 된다.&lt;/p&gt;
&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;./dist/bundle.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;웹팩을 터미널에서 &lt;code class=&quot;highlighter-rouge&quot;&gt;webpack&lt;/code&gt; 커맨드를 입력하여 바로 빌드할 수 있다. vue-cli 를 사용하는 상황이었으니 기본으로 webpack은 설치되어있다. webpack이 없는 경우 node.js 설치 후 &lt;code class=&quot;highlighter-rouge&quot;&gt;npm install -g webpack&lt;/code&gt; 으로 전역 설치를 해준다.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;로더&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;웹팩은 자바스크립트 파일 뿐 아니라 이미지, 폰트, 스타일시트까지 전부 모듈로 관리한다. 그런데 어떻게 하는 걸까? 웹팩은 자바스크립트밖에 모른다. 자바스크립트가 아닌 파일들은 웹팩이 이해하도록 변경해야한다. 이 역할을 바로 로더가 해준다.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;css-loader&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;css를 자바스크립트 파일로 변환해서 로딩할 때 사용하는 로더이다.&lt;/p&gt;

&lt;p&gt;다음과 같이 설정해주자. test에 로딩할 파일을 지정해주고, user에 사용할 로더를 정해주면 된다.&lt;/p&gt;
&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;//webpack.config.js &lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[{&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;css$/&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;na&quot;&gt;use&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'style-loader'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'css-loader'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;플러그인&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;로더는 (번들되기 전) 파일단위를 처리하는 반면, 플러그인은 번들된 결과물을 추가로 처리한다. 번들된 자바스크립트를 난독화 한다거나 특정 텍스트를 추출하는 용도로 사용할 수 있다.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;UglifyJsPlugin&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;자바스크립트 결과물을 난독화 처리하는 플러그인이다.&lt;/p&gt;

&lt;p&gt;플러그인을 사용할 때는 웹팩 객체의 &lt;code class=&quot;highlighter-rouge&quot;&gt;plugins&lt;/code&gt; 배열에 추가한다.&lt;/p&gt;

&lt;h2 id=&quot;바벨은-뭐야&quot;&gt;바벨은 뭐야&lt;/h2&gt;

&lt;p&gt;그놈의 브라우저가 계속 문제다. 어쨌든 저렇게 했음에도 불구하고, ES6나 ES7(최신표준) 브라우저가 이해하지 못하기때문에 ES5로 바꿔주는 과정이 필요하다. 이 과정을 해주는 자바스크립트 컴파일러가 &lt;strong&gt;바벨이다&lt;/strong&gt;. 개발자는 ES6 + 버전으로 개발할 수 있으니 생산성은 향상된다.&lt;/p&gt;

&lt;p&gt;다만 babel을 사용한다고 해서 모든 최신 자바스크립트 함수를 다 사용할 수 있는 것은 아니고, 브라우저에서 지원하지 않는 함수를 검사하는 작업이 프로그램 시작에 진행되어야한다. 이 역할은 &lt;code class=&quot;highlighter-rouge&quot;&gt;babel-polyfill&lt;/code&gt;이 담당한다.&lt;/p&gt;

&lt;p&gt;바벨은 다음과 같이 문법을 바꿔준다.&lt;/p&gt;
&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// 바벨 Input: ES2015(ES6)의  =&amp;gt; 문법 &lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 결과는 [2,3,4]&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// 바벨 Output: ES5 호환 가능 &lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;설치는-이렇게&quot;&gt;설치는 이렇게&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;커맨드 라인에 다음 명령어를 실행한다. 물론 npm은 깔려있어야한다.
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;npm install &lt;span class=&quot;nt&quot;&gt;--save-dev&lt;/span&gt; @babel/core @babel/cli @babel/preset-env
npm install &lt;span class=&quot;nt&quot;&gt;--save&lt;/span&gt; @babel/polyfill
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;프로젝트 루트에 &lt;code class=&quot;highlighter-rouge&quot;&gt;babel.config.js&lt;/code&gt; 라는 파일을 만든다. 그리고 다음과 같이 작성
    &lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;presets&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
     &lt;span class=&quot;s2&quot;&gt;&quot;@babel/env&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
     &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;na&quot;&gt;targets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
         &lt;span class=&quot;na&quot;&gt;edge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;17&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;na&quot;&gt;firefox&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;60&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;na&quot;&gt;chrome&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;67&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
         &lt;span class=&quot;na&quot;&gt;safari&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;11.1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
       &lt;span class=&quot;na&quot;&gt;useBuiltIns&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;usage&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
     &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    
 &lt;span class=&quot;nx&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;presets&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;src&lt;/code&gt; 디렉토리에 있는 모든 파일을 컴파일(babel 문법변환) 해서 &lt;code class=&quot;highlighter-rouge&quot;&gt;lib&lt;/code&gt; 으로 옮겨준다.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;다음 명령어를 치면 된다.&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./node_modules/.bin/babel src &lt;span class=&quot;nt&quot;&gt;--out-dir&lt;/span&gt; lib 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;참고&quot;&gt;참고&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.jeonghwan.net/js/2017/05/15/webpack.html&quot;&gt;http://blog.jeonghwan.net/js/2017/05/15/webpack.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://moon9342.github.io/javascript-babel&quot;&gt;https://moon9342.github.io/javascript-babel&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://babeljs.io/docs/en/&quot;&gt;https://babeljs.io/docs/en/&lt;/a&gt;&lt;/p&gt;
</description>
            <pubDate>Wed, 20 Feb 2019 00:00:00 +0000</pubDate>
            <link>/2019-02-20/webpack-babel</link>
            <guid isPermaLink="true">junebuug.github.io/2019-02-20/webpack-babel</guid>
            
            <category>FE</category>
            
            <category>Javascript</category>
            
            
        </item>
        
        <item>
            <title>Netflix Zuul - 요청을 다른데로 보내고 싶다면</title>
            <description>&lt;h2 id=&quot;zuul-을-만나다&quot;&gt;Zuul 을 만나다&lt;/h2&gt;

&lt;p&gt;사건의 발단&lt;/p&gt;

&lt;p&gt;서비스용 Stat 페이지를 운영툴에 붙이고 싶었다. 이 Stat 페이지는 vue 코드가,  elastic search API를 찔러야하는 구조로 되어있고, elastic search가 설치된 서버는 물론~ &lt;strong&gt;운영툴의 도메인과는 다른 도메인&lt;/strong&gt;이다.&lt;/p&gt;

&lt;p&gt;같은 vue로 되어있는 운영툴 frontend에 떡하니 붙여보니, 운영툴 FE 도메인이 다른 도메인에 요청을 보내므로 CORS가 뜬다.&lt;/p&gt;

&lt;p&gt;운영툴의 backend 는 frontend와 같은 도메인이므로 CORS 에러가 나지 않는다.&lt;/p&gt;

&lt;p&gt;따라서 이런 결론에 다다르게 되었다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;backend에서 특정 uri로 들어온 요청을 elastic search로 프록시해주자!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;그래서 이미 프로젝트에서 같은 목적으로 쓰고 있던 zuul을 사용 해보게 되었다.&lt;/p&gt;

&lt;h2 id=&quot;zuul&quot;&gt;Zuul?&lt;/h2&gt;

&lt;p&gt;참고한 링크를 보면 Zuul에 대한 설명이 나와있다. ‘Zuul은 모든 디바이스/웹사이트에서 넷플릭스 백엔드에 보내는 요청의 &lt;strong&gt;앞문&lt;/strong&gt;이다. Zuul은 동적 라우팅, 모니터링, 탄성, 그리고 보안을 가능하게 만들어졌다.’&lt;/p&gt;

&lt;p&gt;즉, client가 요청을 zuul에 보내고, zuul 을 통해서 넷플릭스의 백엔드 서비스로 퍼지게 된다.&lt;/p&gt;

&lt;p&gt;넷플릭스는 시스템들이 복잡하게 엮여 있고, 1,000 개 이상의 디바이스 종류를 지원하며, 초당 5만 건 이상의 요청을 처리하는 API를 갖고 있다. 또한 매일매일 피쳐를 새롭게 개발하며, 계속해서 변경점이 생긴다. 새로운 AWS 리전에 배포를 시작하고, UI에서도 변경점이 계속 만들어진다. 이런 변화에 대응하기 위해서, 빠른 개발, 높은 유연성, 인사이트가 필요했다. 이를 해결해줄 것이 바로 Zuul인것이고!&lt;/p&gt;

&lt;h2 id=&quot;어떻게-작동하나&quot;&gt;어떻게 작동하나?&lt;/h2&gt;

&lt;p&gt;Zuul의 핵심에는 HTTP 요청과 응답을 라우팅하는 과정에서 특정 액션을 수행하는 &lt;strong&gt;필터&lt;/strong&gt;들이 있다. Zuul 필터의 핵심 특징은 다음과 같다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Type: 라우팅 플로우 중에 필터가 어디에 적용될지를 의미한다 ( 라우팅 훨씬 전에, 직전에, 이후에 등)&lt;/li&gt;
  &lt;li&gt;Execution Order: 여러 필터 중 몇번째로 실행될 것인지 의미한다. Type과 관련되어 있음.&lt;/li&gt;
  &lt;li&gt;Criteria: 필터가 작동할 조건을 의미한다.&lt;/li&gt;
  &lt;li&gt;Action: 조건(위의 Criteria)가 만족할때 어떤 행동을 할 것인지 정의한다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;아래는 simple filter의 예이다.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;DeviceDelayFilter&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ZuulFilter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ZuulFilter를 꼭 상속해야함 &lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Random&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rand&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
    
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;filterType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pre&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;'&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 필터 종류 - pre, route, post 가 있다. FilterConstant에서 참조&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;filterOrder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 5번째로 실행됨 &lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;shouldFilter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;RequestContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getRequest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 받은 Request의 deviceType이 BrokenDevice인 경우 필터 실행  &lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;getParameter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;deviceType&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)?&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;BrokenDevice&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;):&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rand&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;nextInt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Sleep for a random number of&lt;/span&gt;
                                    &lt;span class=&quot;c1&quot;&gt;// seconds between [0-20]&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Zuul 은 이런 필터를 동적으로 읽고, 컴파일하고, 동작하는 프레임워크를 제공한다. 필터는 서로 직접적으로 통신하진 않고, 각 Request 마다 유니크하게 생성되는 RequstContext라는 상태를 공유한다. 현재는 필터가 Groovy로 쓰여있지만, Zuul은 JVM 기반 언어를 모두 지원한다. 각 필터의 소스코드는 줄 서버의 특정 디렉토리에 들어가 있고, 변경사항이 있는지 주기적으로 poll 을 돌린다. 업데이트된 필터를 디스크에서 가져와서, 현재 돌고 있는 서버에 &lt;strong&gt;동적으로 컴파일&lt;/strong&gt;되고 이후 요청부터는 &lt;strong&gt;변경된 필터로 동작&lt;/strong&gt;한다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://s3.us-west-2.amazonaws.com/secure.notion-static.com/329ea0af-fea9-4dad-8aa8-3d9de0d3f819/ZuulCoreArchitecture.png?AWSAccessKeyId=ASIAT73L2G45L275FNDU&amp;amp;Expires=1550730857&amp;amp;Signature=diHrb1o0v5A8yrUfSFzvNz9ml8s%3D&amp;amp;response-content-disposition=filename%20%3D%22ZuulCoreArchitecture.png%22&amp;amp;x-amz-security-token=FQoGZXIvYXdzEB0aDPf98Z%2Bi4prKSNHuxyK3A4G%2FPnmeCYjIYt%2FeXjpJXAH9alQnzAgFdZhJ4g7MD2lAM%2BwazxmDW9y4ljTXZNjwHAO06iFH%2FyI00iDKYJcuMdZZrOom9gVRJSgcZzE%2FI3kWAcghtSzavHNgGlDjq4YZ%2Fz2gRbtCS25tJKRrXn9GjREznO498f2J0Fga5ohqJLNzZzl56sKEQfPLizHquP73ww3EQLUpBLjqUrabvtHdv7BspeJ1PxcFqijnkPxe67lGwwXddsVdz0kXpUj%2BRf2ZwV9RXYgGWu0jDdBEtie0LO8PVaWF36USjDKOBBb5YoHKcRMjEiqirkuqAq%2FiFXZGDWIiSZwEEbeqH5kpwOxyrbAQ7wx%2BTLIGsT5C2xrex6pGwsUazUFwMZm%2Fk3UIAZFeF%2FlVB6hrulaeJXNfmS%2F%2Fil8gR0bJR7dnw6Yqd%2BRcNJlWSwIVKYNrygVzpdcdMNf7MuMDthdUS2MCTdzk6EchLY3zxEiirjpi0cpgDQydOCEn8D0hWjM9TPNWmMjSlhxOfItJkeXPmO5QTXdErFFrjVsAfHzqdRMSMPqyC%2Bd8T3ntcxxT0R9JlLexQBaUzGlrXKSLpLJF4JUoj5Sz4wU%3D&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Zuul의 핵심 아키텍처 구조.&lt;/p&gt;

&lt;p&gt;요청이 들어오면 통과하게되는 필터 타입들을 알아보자.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;PRE : 라우팅되기 전에 실행된다. 여기에서는 대개 요청에 대한 인증, origin server 선택, 디버깅 정보를 로깅하는 등의 일을 한다. (origin은 요청이 원래 도달해야하는 서버를 의미한다.)&lt;/li&gt;
  &lt;li&gt;ROUTING: origin으로의 요청 라우팅을 다룬다. origin에 보낼 HTTP Request가 생성되는 곳이자 Apache HttpClient 혹은 Netflix ribbon을 사용해서 보내지는 곳이다.&lt;/li&gt;
  &lt;li&gt;POST : 요청이 origin 에 도달한 이후 실행된다. 클라이언트에 보낼 응답에 HTTP header를 붙이거나, 통계나 지표 수집, origin 에서 client로 응답을 스트리밍하는 등에 사용한다.&lt;/li&gt;
  &lt;li&gt;ERROR: 다른 단계에서 에러가 발생하면 실행된다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Zuul에는 기본 필터들이 차례대로 실행되고, 그 중간에 &lt;strong&gt;custom filter&lt;/strong&gt;를 넣을 수 있다.&lt;/p&gt;

&lt;p&gt;내 경우 origin에 해당하는 서버에 따로 인증을 했어야해서, Custom filter를 사용해서 라우팅 때 인증 정보를 함께 보내려고 맘을 먹었다. 이에 필요한 정보는 &lt;a href=&quot;https://supawer0728.github.io/2018/03/11/Spring-Cloud-Zuul/&quot;&gt;https://supawer0728.github.io/2018/03/11/Spring-Cloud-Zuul/&lt;/a&gt; 를 참고했다.&lt;/p&gt;

&lt;h2 id=&quot;프로젝트에-적용&quot;&gt;프로젝트에 적용&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;build.gradle에 의존성을 추가해준다.
    &lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt; 
     &lt;span class=&quot;c1&quot;&gt;// zuul&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;implementation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'org.springframework.cloud:spring-cloud-starter-netflix-zuul:2.1.0.RC3'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Application.java 혹은 Config 파일에 &lt;code class=&quot;highlighter-rouge&quot;&gt;@EnableZuulProxy&lt;/code&gt; Annotation을 설정해준다. 프로젝트에서는 다음과 같은 ZuulConfig를 사용했다.
    &lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@EnableZuulProxy&lt;/span&gt; 
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ZuulConfig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;c1&quot;&gt;// 이따가 bean 설정을 넣을 것이다&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;application.yml에 라우팅할 루트를 설정한다.
    &lt;div class=&quot;language-yml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;zuul&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; 
 &lt;span class=&quot;na&quot;&gt;routes&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
     &lt;span class=&quot;na&quot;&gt;customRoute&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
             &lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/api/custom&lt;/span&gt;
             &lt;span class=&quot;na&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;https://another-api.com/search&lt;/span&gt;
             &lt;span class=&quot;na&quot;&gt;sensitive-headers&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Cookie, Set-Cookie&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;이렇게 하면, 프로젝트 백엔드 서버 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;host명&amp;gt;/api/custom&lt;/code&gt; 하위로 요청이 들어가면 &lt;code class=&quot;highlighter-rouge&quot;&gt;[https://another-api.com/search](https://another-api.com/search)&lt;/code&gt; 에 요청이 라우팅된다.  &lt;code class=&quot;highlighter-rouge&quot;&gt;another api&lt;/code&gt; 서버에 인증이 필요해서 custom filter에 authorization header를 따로 붙여줄 것이므로, sensitive-headers에 다른 헤더 명들만 명시해준다(Cookie, Set-Cookie).&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Custom filter를 만든다.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;내 경우  크게 두가지를 해주어야 했다.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;origin 서버에 대한 인증&lt;/li&gt;
  &lt;li&gt;uri 변경
    &lt;ul&gt;
      &lt;li&gt;위의 설정처럼 하면, origin으로 요청이 /search/api/custom으로 간다.&lt;/li&gt;
      &lt;li&gt;백엔드에서는 /api/custom 으로 요청을 보내고, origin에서는 요청이 search로 가도록 해주고 싶다.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;이 요구조건을 Custom Filter로 해결할 수 있다.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Component&lt;/span&gt; 
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CustomFilter&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ZuulFilter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CUSTOM_URI&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;/api/custom&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AUTH_INFO&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;id:password&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;filterType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ROUTE_TYPE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ROUTE 필터 소속&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;filterOrder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SIMPLE_HOST_ROUTING_FILTER_ORDER&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; 
                &lt;span class=&quot;c1&quot;&gt;// 원래 ROUTING 필터 직전에 호출해줌&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;shouldFilter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;RequestContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RequestContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getCurrentContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// 공통 변수인 RequestContext에서 요청이 /api/custom으로 올때만 필터 사용&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CUSTOM_URI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;REQUEST_URI_KEY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ZuulException&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;RequestContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RequestContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getCurrentContext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;basicAuth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 1. auth 진행 &lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;refineUri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 2. uri 변경&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;refineUri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RequestContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;containsKey&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;REQUEST_URI_KEY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;REQUEST_URI_KEY&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;basicAuth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RequestContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoded&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Base64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getEncoder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;encodeToString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AUTH_INFO&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getBytes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;addZuulRequestHeader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Authorization&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Basic &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoded&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;인증은 보통 Pre filter에서 한다-라고 대부분의 문서에 나와있지만,  이는 API GATEWAY에 대한 인증이었나보다… origin 에 대한 인증은 Route 필터에서 해야 동작했다. 이 필터는 이 custom api 에 대해서만 동작했으면 해서 shouldFilter로 조건을 부여했다. 이 부분이 위에서 말한 Criteria에 해당한다.&lt;/p&gt;

&lt;p&gt;filter가 실행되면&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;RequestContext에 인증 헤더를 붙이고&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;URI를 변경하는 작업을 한다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Filter를 bean으로 등록한다.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;아까 설정한 Config 내부에 bean으로 등록한다. application.java에서 해도 되지만 좀더 깔끔한 표현을 위해!&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@EnableZuulProxy&lt;/span&gt; 
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ZuulConfig&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// 이따가 bean 설정을 넣을 것이다&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CustomFilter&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;customFilter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CustomFilter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
  &lt;li&gt;테스트 해본다.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;POSTMAN으로 backend에 요청을 보내서 origin 에서 내려주는 응답이 오는지 확인해본다.&lt;/p&gt;

&lt;h2 id=&quot;결론&quot;&gt;결론&lt;/h2&gt;

&lt;p&gt;zuul은 적용하기도 쉽고, 손쉽게 CORS 오류를 피할 수 있는 방법이라 편리하게 사용했다.&lt;/p&gt;

&lt;p&gt;대용량 시스템에서의 로드밸런싱 등에도 효과적으로 사용할 수 있는 것으로 보이는데, 다음에 쓸일이 있으면 더 정리하도록 하겠다.&lt;/p&gt;

&lt;h2 id=&quot;참고&quot;&gt;참고&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://woowabros.github.io/r&amp;amp;d/2017/06/13/apigateway.html&quot;&gt;http://woowabros.github.io/r&amp;amp;d/2017/06/13/apigateway.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://medium.com/netflix-techblog/announcing-zuul-edge-service-in-the-cloud-ab3af5be08ee&quot;&gt;https://medium.com/netflix-techblog/announcing-zuul-edge-service-in-the-cloud-ab3af5be08ee&lt;/a&gt;&lt;/p&gt;
</description>
            <pubDate>Wed, 20 Feb 2019 00:00:00 +0000</pubDate>
            <link>/2019-02-20/netflix-zuul</link>
            <guid isPermaLink="true">junebuug.github.io/2019-02-20/netflix-zuul</guid>
            
            <category>Zuul</category>
            
            <category>proxy</category>
            
            
        </item>
        
        <item>
            <title>내받코리 1월,2월</title>
            <description>&lt;p&gt;이전에 &lt;a href=&quot;https://junebuug.github.io/2018-12-15/code-review-i-got&quot;&gt;내가 처음으로 받은 받은 JAVA 코드리뷰 모음&lt;/a&gt; 이라는 제목으로 글을 올렸었는데,&lt;/p&gt;

&lt;p&gt;그 이후에도 이건 &lt;strong&gt;꾸준히 하면 좋겠다!&lt;/strong&gt; 라는 생각이 들어서 또 다시 적습니다.&lt;/p&gt;

&lt;p&gt;2월에는 Vue 공부도 조금했는데, Java 코드리뷰가 아닌 관계로 제외되었더니 양이 적네요.&lt;/p&gt;

&lt;h2 id=&quot;보안이슈로-이전-api-deprecated&quot;&gt;보안이슈로 이전 API Deprecated&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;나중에 없앨 계획이시면 @deprecated 붙여 두시고, 언제 없앨 건지 커맨트 남겨두시면 좋습니다. swagger 에도 반영되었던 걸로 기억해요&lt;/li&gt;
  &lt;li&gt;반영 후 클라이언트에 API 변경 전달 부탁드려요.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;회원-탈퇴로직&quot;&gt;회원 탈퇴로직&lt;/h2&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;외부&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Exception&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;UserException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ErrorReason&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;USER_SESSION_INVALID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;Exception이 항상 session invalid가 아닐 수도 있지 않을까요?외부Exception e를 살려두는게 도움이 될 것 같습니다!
    &lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;n&quot;&gt;assertThatExceptionOfType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserException&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isThrownBy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userService&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;탈퇴&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;타입말고 에러메시지에서도 확인해 볼 수 있는데, 연습도 할겸 적용해 보셔요~&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;로그인-시-검사-로직&quot;&gt;로그인 시 검사 로직&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;앱 로그인 시에 login 을 먼저 호출하고, 아닌 경우 signup을 하므로 login 에 검사 로직을 추가했습니다.-&amp;gt; 호출 순서에 무관하게 막야야 하니…signup api 에도 체크 해야 하지않을까요?&lt;/li&gt;
  &lt;li&gt;상수 명이 REGION_CODE 인 것 보다는 REGION_JAPAN 처럼 일본임을 명시하는 게 자연스러울 것 같아요~&lt;/li&gt;
  &lt;li&gt;Locale.JAPAN.getCountry() 저는 이거 많이 사용하긴 했어요~&lt;/li&gt;
  &lt;li&gt;테스트 모킹 코드가 중복이 많은 것 같은데~ 별도 메서드로 분리하는 거 검토해보시면 좋을 것 같아요.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;db-ddl-변경분-에-대해서&quot;&gt;DB DDL 변경분 에 대해서&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;ddl 파일에 칼럼 추가 부탁드려요.&lt;/li&gt;
  &lt;li&gt;국가코드 넣는거라면 CHAR(2)로 해도 될것같아요.
```java
  if (!응답.get정보().equals(상수)) {
    &lt;ul&gt;
      &lt;li&gt;throw new UserException(ErrorReason.User.NOT_SERVICED_REGION_CODE);&lt;/li&gt;
      &lt;li&gt;}
```&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;응답에 있는 정보는 항상 오는 걸까요? 혹시 모를 NPE를 막으려면,상수.equals(응답.get정보()) 가 낫겠네요~
    &lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;n&quot;&gt;HashMap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HashMap&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;HashMap을 쓰실거면 Map&amp;lt;String, Object&amp;gt; 로 받아주세요.간혹 HashMap 에만 있는 기능을 쓰는 케이스가 있긴하지만 많지는 않아서 꼭 필요한 경우아니면 interface로 받아주시는게 좋겠습니다~자매품 Collections 도 있습니다. java9으로 가면 이런것도 고민 좀 덜하게 될텐데 말이죠 쩝…
Collections.singletonMap()&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;테스트-정리-pr&quot;&gt;테스트 정리 PR&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;정리 잘하셨네요.&lt;/p&gt;

    &lt;p&gt;좀 더 단순하게 만들어서 더 줄일 수 있는지 포인트를 찾아보면 몇 군데 정도 더 줄 일 수 있을 것 같습니다.변수값을 보면 대부분 의미가 있는 경우가 아니어서 꼭 필요한 것들만 남기거나, method 로 객체를 빼놓는 등 의미별로 분리를 할 수 있을 것 같아요.&lt;/p&gt;

    &lt;p&gt;전역의 경우는 클래스가 길어지면 아무래도 참조해서 보기 어렵기도 하고, 변경 가능성도 있고 해서 많이 사용하지는 않았던 것 같습니다.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;외부response 를 예로 보자면,지금 이 테스트에서 관심있고 테스트하고자하는 부분은 지역코드 입니다.나머지는 어떤 값이 들어가도 신경쓰지않고(verify) 있기 때문에 아무거나 넣어도 되는 상황이어서,response 들은 method 로 빼놓으면 여러곳에서 사용하기 편할 것 같습니다. ExternalResponse externalResponse = defaultResponse().setRegineCode(“JP”); 이정도로하고 나머지는 다른 테스트들과 동일한 구조로 반복하는게 가능할 것 같습니다.&lt;/p&gt;

    &lt;p&gt;테스트 하려는 부분이나 비교하려는 값을 제외하고는 되도록이면 읽어서 분석하지 않게 해주면 테스트 목적이 확 드러나지 않을까 합니다.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;
</description>
            <pubDate>Wed, 20 Feb 2019 00:00:00 +0000</pubDate>
            <link>/2019-02-20/codereview-i-got-2</link>
            <guid isPermaLink="true">junebuug.github.io/2019-02-20/codereview-i-got-2</guid>
            
            <category>Java</category>
            
            <category>CodeReview</category>
            
            
        </item>
        
        <item>
            <title>RestTemplate 말고 WebClient</title>
            <description>&lt;p&gt;가장 먼저 코드로 본 web 요청 인터페이스는 WebClient였고, 명확하고 직관적이여서 자주 썼다.&lt;/p&gt;

&lt;p&gt;그런데 현재 프로젝트에서는 RestTemplate과 WebClient가 혼재되어있어서, 이 둘에 대해서 조금 알아볼까 한다.&lt;/p&gt;

&lt;h2 id=&quot;뭐가-더-먼저-나왔을까--resttemplate&quot;&gt;뭐가 더 먼저 나왔을까 : RestTemplate&lt;/h2&gt;

&lt;p&gt;WebClient vs RestTemplate으로 치면 스택오버플로우 글 하나가 나온다.&lt;/p&gt;

&lt;p&gt;“야 Spring 5로 업글하고 싶으면 RestTemplate 못씀??? 그럼 RestTemplate쓴 옛날 어플리케이션들 어떡함?? 다 WebClient 써야해? “ &lt;a href=&quot;https://stackoverflow.com/questions/47974757/webclient-vs-resttemplate&quot;&gt;https://stackoverflow.com/questions/47974757/webclient-vs-resttemplate&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;침착하게 다른 사람들이 이렇게 답변해줬다.&lt;/p&gt;

&lt;p&gt;“아니 RestTemplate 계속 있을거고 WebClient 안써도 돼. 제일 큰 차이는 RestTemplate은 &lt;strong&gt;synchronous하고 blocking&lt;/strong&gt; 하다는 거임. 그게 무슨 말이냐면… web 요청을 하고 다음 행동을 하려면 response가 올때까지 기다려야한다는 뜻임ㅎㅎ WebClient는 완전 반대야. 호출한 사람은 response 올 때까지 기다릴 필요가 없고, response가 오면 알림을 받게 될거임!!!&lt;/p&gt;

&lt;p&gt;그런 기능 필요하면 WebClient로 갈아타시고~ WebClient에서 resttemplate처럼 &lt;strong&gt;synchronous&lt;/strong&gt;하게도 쓸 수 있으니까 (block()) 잘생각해봐~ 참고로 반대 방향(Rest template에서 Webclient 처럼 쓰기) 는 안됨 =) “&lt;/p&gt;

&lt;p&gt;“Java Doc이 그러는데 RestTemplate 나중에~~~~~ deprecated될거래 &lt;a href=&quot;https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html&quot;&gt;https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html&lt;/a&gt; “&lt;/p&gt;

&lt;p&gt;정리해보면,&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;RestTemplate은 WebClient 보다 이전에 나왔다&lt;/li&gt;
  &lt;li&gt;RestTemplate은 동기식이며, response가 올 때까지 다음 행동으로 넘어갈 수 없다&lt;/li&gt;
  &lt;li&gt;RestTemplate은 곧 deprecated 되어 역사의 뒤안길로 사라지게 될거다 (ㅠㅠ)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;그럼-webclient-부터-알아보자&quot;&gt;그럼 WebClient 부터 알아보자&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://www.baeldung.com/spring-5-webclient&quot;&gt;https://www.baeldung.com/spring-5-webclient&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WebClient는 웹 요청을 하는 데 있어 출입문 역할을 하는!  인터페이스이다.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Spring Web Reactive&lt;/code&gt; 모듈에 포함되어 있고,  RestTemplate 을 대체한다.&lt;/p&gt;

&lt;h2 id=&quot;설치의존성-설정&quot;&gt;설치/의존성 설정&lt;/h2&gt;

&lt;p&gt;gradle에는 다음과 같은 dependencies 를 설정해준다.&lt;/p&gt;
&lt;div class=&quot;language-groovy highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;n&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'org.springframework.boot:spring-boot-starter-webflux'&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'org.projectreactor:reactor-spring:1.0.1.RELEASE'&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;webclient-instance-생성하기&quot;&gt;WebClient Instance 생성하기&lt;/h2&gt;

&lt;p&gt;프로젝트 소스코드에서는 builder 패턴을 사용하여 인스턴스를 만든다.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;n&quot;&gt;Webclient&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WebClient&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;baseUrl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://localhost:8080&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;defaultCookie&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;쿠키키&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;쿠키값&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;defaultHeader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HttpHeaders&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;CONTENT_TYPE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MediaType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;APPLICATION_JSON_VALUE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;request-요청하기&quot;&gt;Request 요청하기&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;일단 HTTP 메소드를 정해야한다.
    &lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;WebClient&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;UriSpec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;WebClient&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;RequestBodySpec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;req&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;두번째로 uri API를 제공해야한다. String 포맷 혹은 &lt;code class=&quot;highlighter-rouge&quot;&gt;java.net.URL&lt;/code&gt; 포맷으로 넘긴다.
    &lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;WebClient&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;RequestBodySpec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uri&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;
                             &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                             &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/search&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;필요하다면 Request에 &lt;code class=&quot;highlighter-rouge&quot;&gt;body, content-type,length, cookie, header&lt;/code&gt; 등을 포함할 수 있다.
    &lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;WebClient&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;RequestHeadersSpec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;?&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;req2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;
                                             &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/search&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                                             &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BodyInserters&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;fromObejct&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;data&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;아예 다르게 접근할 수도 있다. 원하는 uri를 직접 만들어 요청하는 방식이다.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WebClient&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;RequestHeaderUriSpec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;?&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;baseSpec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;baseSpec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Webclient&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;baseUrl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;주소&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// baseSpec에 원하는 파라미터를 추가로 붙여서 요청한다. &lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;baseSpec&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                                                                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;queryParam&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;이름&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;값&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                                                                &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
                            &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Response를 받아옴.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;response를-받아오기&quot;&gt;Response를 받아오기&lt;/h2&gt;

&lt;p&gt;이 과정에는 두 방법이 있다.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;exchange&lt;/code&gt;는 &lt;code class=&quot;highlighter-rouge&quot;&gt;ClientResponse&lt;/code&gt;를 상태값 그리고 헤더와 함께 가져오는 반면에,&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;retrieve&lt;/code&gt; 는 body를 바로 가져온다.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;exchange&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;req2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;retrieve&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bodyToMono&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;block&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;여기서 &lt;code class=&quot;highlighter-rouge&quot;&gt;bodyToMono&lt;/code&gt; 는 가져온 body를 Reactor의 &lt;code class=&quot;highlighter-rouge&quot;&gt;Mono&lt;/code&gt; 객체로 바꿔준다. &lt;code class=&quot;highlighter-rouge&quot;&gt;Mono&lt;/code&gt; 객체는 0-1개의 결과를 처리하는 객체이고, 반면 &lt;code class=&quot;highlighter-rouge&quot;&gt;Flux&lt;/code&gt; 는 0-N개인 결과를 처리하는 객체!&lt;/p&gt;

&lt;p&gt;위에서 &lt;code class=&quot;highlighter-rouge&quot;&gt;block&lt;/code&gt; 을 사용하면 Rest Template처럼 동기식으로 사용할 수 있다고 했다.&lt;/p&gt;

&lt;p&gt;block을 Mono에 사용하여, response와 함께 전송된 실제 데이터를 구독하고 얻어 올 수 있다!&lt;/p&gt;

&lt;h2 id=&quot;resttemplate도-어떻게-쓰는-건지-알아는-보자&quot;&gt;RestTemplate도 어떻게 쓰는 건지 알아는 보자&lt;/h2&gt;

&lt;p&gt;참고:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://sjh836.tistory.com/141&quot;&gt;https://sjh836.tistory.com/141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://blog.saltfactory.net/using-resttemplate-in-spring/&quot;&gt;http://blog.saltfactory.net/using-resttemplate-in-spring/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;RestTemplate도 생성과 사용이 그렇게 어렵지 않다.&lt;/p&gt;

&lt;h3 id=&quot;시작해보자&quot;&gt;시작해보자&lt;/h3&gt;

&lt;p&gt;일단 침착하게 RestTemplate 설정을 위한 Config 클래스를 만들어준다.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.boot.web.client.RestTemplateBuilder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.context.annotation.Bean&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.context.annotation.Configuration&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.retry.annotation.EnableRetry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;org.springframework.web.client.RestTemplate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;nd&quot;&gt;@Configuration&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@EnableRetry&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RestTemplateClient&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Bean&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RestTemplate&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;restTemplate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RestTemplateBuilder&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Config클래스는 &lt;code class=&quot;highlighter-rouge&quot;&gt;@Configuration&lt;/code&gt; 어노테이션이 붙어있어야한다. 이렇게 해주는 이유는 우리 프로젝트에서 기존 방법으로 RestTemplate 을 빈으로 인식하지 않았기때문이다. builder를 거쳐서 만들어줘야한다.&lt;/p&gt;

&lt;p&gt;이제 요청을 원하는 클래스에 가서 restTemplate 필드를 &lt;code class=&quot;highlighter-rouge&quot;&gt;@Autowired&lt;/code&gt; 를 사용해서 주입해준다.&lt;/p&gt;

&lt;p&gt;ResttemplateBulilder.build()를 사용해서 만들어서 주입해주는 경우도 있다.&lt;/p&gt;

&lt;h3 id=&quot;사용하기&quot;&gt;사용하기&lt;/h3&gt;

&lt;p&gt;주요 메소드를 &lt;code class=&quot;highlighter-rouge&quot;&gt;restTemplate.메소드명&lt;/code&gt; 과 같이 사용하면 된다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;execute(): Request / Response 를 수정할 수 있다. HTTP method를 직접 지정 가능&lt;/li&gt;
  &lt;li&gt;exchange() : Http header를 수정가능함. 응답은 HttpResponseEntity 형태&lt;/li&gt;
  &lt;li&gt;getForObject(String url, 원하는 클래스타입): Http header는 기본 형태. 응답은 원하는 오브젝트 형태로 결과를 받을 수 있다.&lt;/li&gt;
  &lt;li&gt;getForEntity(): Http header가 기본 형태. 응답은 HttpResponseEntity 형태.&lt;/li&gt;
  &lt;li&gt;postForObject: post 요청을 보냄, 응답은 HttpResponseEntity 형태
    &lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TestClass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nd&quot;&gt;@Autowired&lt;/span&gt; 
  &lt;span class=&quot;n&quot;&gt;RestTemplate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;restTemplate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;TestClass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RestTemplate&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;restTemplate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;restTemplate&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;restTemplate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getSthFromServer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;restTemplate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getForObject&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://api.com/search?text=호이&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;결론&quot;&gt;결론&lt;/h2&gt;

&lt;p&gt;결론적으로는, Spring 프로젝트가 RestTemplate에서 WebClient로 마이그레이션하고 있는 추세이고 추후 지원을 중단할지도 모르니 WebClient로 이동하는 것이 가장 좋다는 생각이 든다. 🤔&lt;/p&gt;

&lt;p&gt;WebClient가 기본 비동기식이긴 하지만, 동기식처럼 사용할 수도 있다는 장점 또한 마이그레이션할 이유가 될 수 있겠다.&lt;/p&gt;

</description>
            <pubDate>Mon, 11 Feb 2019 00:00:00 +0000</pubDate>
            <link>/2019-02-11/resttemplate-vs-webclient</link>
            <guid isPermaLink="true">junebuug.github.io/2019-02-11/resttemplate-vs-webclient</guid>
            
            <category>Spring</category>
            
            <category>WebInterface</category>
            
            
        </item>
        
        <item>
            <title>Mockito when으로 repository save 구현하기</title>
            <description>&lt;h3 id=&quot;상황&quot;&gt;상황&lt;/h3&gt;

&lt;p&gt;Test를 mockito로 작성하던 도중, repository의 save을 모킹해줄 일이 생겼다.&lt;/p&gt;

&lt;p&gt;테스트하려는 메소드의 로직이 respository의 행동을 포함하고 있었기때문인데,&lt;/p&gt;

&lt;p&gt;실제로 repository가 들고 있거나 DB에 저장되지 않아도 save 한 것 처럼&lt;/p&gt;

&lt;p&gt;넣은 객체를 그대로 받고 싶었다.&lt;/p&gt;

&lt;p&gt;일반적인 &lt;code class=&quot;highlighter-rouge&quot;&gt;when - return&lt;/code&gt; 으로는 해결되지 않아 스택오버플로우를 참조했다.&lt;/p&gt;

&lt;h3 id=&quot;해결방법&quot;&gt;해결방법&lt;/h3&gt;
&lt;p&gt;https://stackoverflow.com/questions/26161917/mockito-returning-the-same-object-as-passed-into-method&lt;br /&gt;
&lt;strong&gt;mockito에서 메소드에 전달된 오브젝트를 그대로 리턴하는 법&lt;/strong&gt; 으로 검색했다.&lt;/p&gt;

&lt;p&gt;이는 when에서 any object를 넘겨주고, then에서 AdditionalAnswers를 사용하는 방법이다.&lt;/p&gt;

&lt;p&gt;실제로 적용한 내용은 아래와 같다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;n&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;userRepository&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AdditionalAnswers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;returnFirstArg&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;어떤 User Object가 넘어가든지, 넘어간 args 중 첫번째 args를 리턴하도록 하여 해결했다.&lt;/p&gt;

</description>
            <pubDate>Fri, 08 Feb 2019 00:00:00 +0000</pubDate>
            <link>/2019-02-08/mockito-repo-save</link>
            <guid isPermaLink="true">junebuug.github.io/2019-02-08/mockito-repo-save</guid>
            
            <category>Test</category>
            
            <category>Mockito</category>
            
            
        </item>
        
        <item>
            <title>Custom Annotation으로 유효성 검사하기</title>
            <description>&lt;h2 id=&quot;상황&quot;&gt;상황&lt;/h2&gt;

&lt;p&gt;어떤 값이 유효한지 검사를 해야 하는데, 해당 값은 entity나 DTO에서 받을 때 매번 유효성 검사를 해야한다.&lt;/p&gt;

&lt;p&gt;이런 경우 대개 Validator를 사용해야하는데, Validator와 Annotation을 함께 사용하여 깔쌈하게 만드는 법을 알아본다.&lt;/p&gt;

&lt;h2 id=&quot;annotation은-뭐더라&quot;&gt;Annotation은 뭐더라&lt;/h2&gt;

&lt;h3 id=&quot;annotation-어노테이션&quot;&gt;Annotation 어노테이션&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;주석이라는 뜻, 보통 생각하는 &lt;code class=&quot;highlighter-rouge&quot;&gt;#&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;//&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;/* */&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;!-- --&amp;gt;&lt;/code&gt; 주석과는 다름. (ㅋㅋ)&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;이 속성을 어떻게 연결할지&lt;/code&gt; 혹은 &lt;code class=&quot;highlighter-rouge&quot;&gt;이 클래스는 이런 역할이야&lt;/code&gt; 라고 정의해주는 역할&lt;/li&gt;
  &lt;li&gt;annotation을 라벨로 생각하면 쉬운데, &lt;code class=&quot;highlighter-rouge&quot;&gt;이 라벨이 붙은 건 이렇게 처리해주십셔!&lt;/code&gt; 라고 말하는 것과 같음&lt;/li&gt;
  &lt;li&gt;읽기는 &lt;strong&gt;어노테이션&lt;/strong&gt;이라고 읽으며, @를 앞에 붙여서 표시.&lt;/li&gt;
  &lt;li&gt;대표적으로는 오버라이드한 메소드 위에 붙이는 &lt;code class=&quot;highlighter-rouge&quot;&gt;@Override&lt;/code&gt;나 이제 쓰이지 않을 메소드/ 클래스를 표현하는 &lt;code class=&quot;highlighter-rouge&quot;&gt;@Deprecated&lt;/code&gt; 가 있음&lt;/li&gt;
  &lt;li&gt;정해진 annotation외에도 &lt;strong&gt;유저가 직접 설정하여&lt;/strong&gt; annotation을 만들 수 있다.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;custom-annotation은-어떻게-만들어요&quot;&gt;Custom Annotation은 어떻게 만들어요?&lt;/h2&gt;

&lt;p&gt;Custom Annotation을 만드는 방법은 &lt;a href=&quot;https://jdm.kr/blog/216&quot;&gt;JDM’s Blog&lt;/a&gt; 에 매우 자세히 설명되어있다.&lt;/p&gt;

&lt;p&gt;간단하게 다시 정리해보자.&lt;/p&gt;

&lt;p&gt;Custom annotation을 만들기 위해서는 다음과 같이 정의만 내리면 된다.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValidNumber&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ValidNumber라는 이름으로 annotation을 만들었다.
즉 이제 어디에서든 &lt;code class=&quot;highlighter-rouge&quot;&gt;@ValidNumber&lt;/code&gt; 라는 어노테이션을 사용할 수 있다.&lt;/p&gt;

&lt;p&gt;그런데 이 라벨이 붙으면 어플리케이션이 언제, 어디에, 어떻게 동작해야하는지 정해줘야한다.&lt;/p&gt;

&lt;p&gt;이를 위해서는 메타 어노테이션들을 몇개 지정해준다.&lt;/p&gt;

&lt;h3 id=&quot;meta-annotation-메타-어노테이션&quot;&gt;Meta Annotation 메타 어노테이션&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@Retention&lt;/code&gt; : 표시된 어노테이션이 어떻게 저장될지 결정합니다. 코드 or 클래스로 컴파일 or 런타임. RetentionPolicy enum에서 참조 가능하다.
    &lt;ul&gt;
      &lt;li&gt;RetentionPolicy.RUNTIME: 컴파일 이후에도 JVM 참조가 가능&lt;/li&gt;
      &lt;li&gt;RetentionPolicy.CLASS: 컴파일러가 클래스를 참조할때까지 유효&lt;/li&gt;
      &lt;li&gt;RetentionPolicy.SOURCE: 어노테이션 정보는 컴파일 후 없어짐&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@Target&lt;/code&gt; : 어노테이션을 적용할 위치를 지정한다. ElementType enum에서 가져올 수 있다.
    &lt;ul&gt;
      &lt;li&gt;ElementType.TYPE : 클래스, 인터페이스, enum 정의에 사용&lt;/li&gt;
      &lt;li&gt;ElementType.FIELD: enum 상수를 포함한 필드 정의에 사용&lt;/li&gt;
      &lt;li&gt;ElementType.METHOD: method 정의에 사용&lt;/li&gt;
      &lt;li&gt;ElementType.PARAMETER: 파라미터 정의에 사용&lt;/li&gt;
      &lt;li&gt;ElementType.CONSTRUCTOR: 생성자 정의에 사용&lt;/li&gt;
      &lt;li&gt;ElementType.LOCAL_VARIABLE: 로컬 변수 정의에 사용&lt;/li&gt;
      &lt;li&gt;ElementType.ANNOTATION_TYPE: 어노테이션 타입 정의에 사용&lt;/li&gt;
      &lt;li&gt;ElementType.PACKAGE: 패키지 정의에 사용&lt;/li&gt;
      &lt;li&gt;ElementType.TYPE_PARAMTER: 자바 8이상부터 타입 파라미터 정의에 사용&lt;/li&gt;
      &lt;li&gt;ElementType.TYPE_USE: 자바 8이상부터, 타입에 사용&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@Documented&lt;/code&gt;: 문서에도 어노테이션 정보가 표시됨. (공식 문서에서는 public contract에 나오게 된다고 표현)&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@Inherited&lt;/code&gt; : 자식 클래스가 어노테이션을 상속 받을 수 있게 함&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@Repeatable&lt;/code&gt; : 반복적으로 어노테이션을 선언할 수 있음&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;다시-돌아와서&quot;&gt;다시 돌아와서&lt;/h3&gt;

&lt;p&gt;다시 어노테이션을 만들어보자.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;nd&quot;&gt;@Documented&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 문서에 표시할 거고 &lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Target&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ElementType&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;FIELD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;})&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 필드에만 적용할 거고&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Retention&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RetentionPolicy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;RUNTIME&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 런타임에서도 적용되었으면 함 &lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Constraint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;validateBy&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValidNumberValidator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// optional, 여기서는 유효성을 검사하기위해 넣었다.&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nd&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ValidNumber&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Invalid number&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;?&amp;gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;};&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;Class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;?&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;[]&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;};&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;이제-validator-class를-작성해보자&quot;&gt;이제 Validator Class를 작성해보자&lt;/h2&gt;

&lt;p&gt;위에서 Constraint annotation으로 사용된 Validator를 작성해보자.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// ConstraintValidator&amp;lt;어노테이션이름, 해당필드의자료형&amp;gt;을 구현한다. &lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ValidNumberValidator&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ConstraintValidator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ValidNumber&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isValid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ConstraintValidatorContext&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isValidNumber&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;isValidNumber&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ConstraintValidator를 상속해서 다음과 같은 Validator를 만들었다.&lt;/p&gt;

&lt;p&gt;여기에서 &lt;code class=&quot;highlighter-rouge&quot;&gt;isValid&lt;/code&gt; 함수를 override하여 값이 유효한지 판단하는 함수를 작성하면 완성이다.&lt;/p&gt;

&lt;h2 id=&quot;참고&quot;&gt;참고&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://jdm.kr/blog/216&quot;&gt;https://jdm.kr/blog/216&lt;/a&gt;
&lt;a href=&quot;http://www.nextree.co.kr/p5864/&quot;&gt;http://www.nextree.co.kr/p5864/&lt;/a&gt;&lt;/p&gt;
</description>
            <pubDate>Fri, 08 Feb 2019 00:00:00 +0000</pubDate>
            <link>/2019-02-08/make-validator-annotation</link>
            <guid isPermaLink="true">junebuug.github.io/2019-02-08/make-validator-annotation</guid>
            
            <category>Spring</category>
            
            <category>Annotation</category>
            
            
        </item>
        
        <item>
            <title>json을 펼쳐주는 @JsonUnwrapped</title>
            <description>&lt;h3 id=&quot;dto&quot;&gt;DTO&lt;/h3&gt;
&lt;p&gt;**DTO (Data Transfer Object) **는 클라이언트와 데이터를 교환하기 위해서 형식을 정해놓은 것이다.&lt;/p&gt;

&lt;p&gt;예를 들어 화면에 상품과 그에 대한 리뷰가 같이 필요하다면,&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Data&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Accessor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chain&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Home&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; 
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Product&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;product&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Review&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;review&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;와 같이 여러개를 감싸서 클라이언트에서 사용할 데이터만 쏙쏙 골라서 내려줄 집합인 것이다.&lt;/p&gt;

&lt;h3 id=&quot;json-모양이-복잡해--nested-json&quot;&gt;json 모양이 복잡해 : nested json&lt;/h3&gt;
&lt;p&gt;그런데 위와 같은 DTO는 json으로 생성할 때 괄호 안에 괄호가 있는 형식으로 생성된다.&lt;/p&gt;

&lt;p&gt;즉 Product와 Review가 하나의 엔티티이므로 다음과 같이&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{
    &quot;id&quot; : 1131310,
    {
        &quot;product_name&quot;: &quot;블루베리우유&quot;,
        &quot;price&quot; : 5000
    },
    {
        &quot;content&quot;: &quot;JMT입니다&quot;,
        &quot;user&quot; : {
            &quot;name&quot; : &quot;준벅&quot; 
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;괄호 안에 괄호를 품은 모양으로 생성된다. 이렇게 복잡도가 높아지는 모양을 보통 nested 라고 한다.&lt;/p&gt;

&lt;p&gt;그런데 너무 간단한 내용은 nested 되지 않게 펼쳐주는 것이 필요하다.&lt;/p&gt;

&lt;h3 id=&quot;json을-좀-펼쳐주자&quot;&gt;json을 좀 펼쳐주자!&lt;/h3&gt;

&lt;p&gt;아래를 보자.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Stat&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Stat은 count 하나만 가지고 있는 엔티티이다. Stat을 포함한 DTO를 만들면 json 형태는&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;s&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;어쩌구저쩌구리&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;s&quot;&gt;&quot;count&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;0&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
	 &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;와 같은 형태를 띄게 된다.&lt;/p&gt;

&lt;p&gt;이때 불필요한 count 주위의 괄호를 없애려면 &lt;code class=&quot;highlighter-rouge&quot;&gt;@JsonUnwrapped&lt;/code&gt;를 사용하면 된다.&lt;/p&gt;

&lt;p&gt;첫번째 예제에서 &lt;code class=&quot;highlighter-rouge&quot;&gt;@JsonUnwrapped&lt;/code&gt;를 사용해보자.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Data&lt;/span&gt;
&lt;span class=&quot;nd&quot;&gt;@Accessor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chain&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Home&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; 

    &lt;span class=&quot;nd&quot;&gt;@JsonUnwrapped&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Product&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;product&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Review&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;review&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Home은 json으로 변환될때 Product 부분이 &lt;strong&gt;펼쳐져서&lt;/strong&gt;  표시된다.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{
    &quot;id&quot; : 1131310,
    &quot;product_name&quot;: &quot;블루베리우유&quot;,
    &quot;price&quot; : 5000,
    {
        &quot;content&quot;: &quot;JMT입니다&quot;,
        &quot;user&quot; : {
            &quot;name&quot; : &quot;준벅&quot; 
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
</description>
            <pubDate>Fri, 08 Feb 2019 00:00:00 +0000</pubDate>
            <link>/2019-02-08/json-unwrapped</link>
            <guid isPermaLink="true">junebuug.github.io/2019-02-08/json-unwrapped</guid>
            
            <category>Spring</category>
            
            <category>Annotation</category>
            
            
        </item>
        
        <item>
            <title>Setter 설정안하고 set하기</title>
            <description>&lt;h2 id=&quot;상황&quot;&gt;상황&lt;/h2&gt;

&lt;p&gt;기존에 통합테스트로 돌고 있던 web client 테스트가 있다.&lt;/p&gt;

&lt;p&gt;외부 API를 찔러보는 테스트인데, 이에 필요한 파라미터는 해당 web client 내부에서 가져오는 방식이다.&lt;/p&gt;

&lt;p&gt;이때 무거운 통합테스트가 아니라, 직접 파라미터를 set해주는 가벼운 단위 테스트를 만들고 싶다.&lt;/p&gt;

&lt;h2 id=&quot;기존-통합테스트&quot;&gt;기존 통합테스트&lt;/h2&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@SpringBootTest&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CustomClientIT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Autowired&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CustomClient&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;customClient&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; 

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;테스트할&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;메소드야&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;param&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;abc1234&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;CustomReponse&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;customClient&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getSth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;n&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getEmail&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isNotNull&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;custom-client&quot;&gt;Custom Client&lt;/h2&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CustomClient&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt; 

    &lt;span class=&quot;nd&quot;&gt;@Value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;${somewhere.base-url}&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;baseUrl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; 
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;테스트해보고 싶은 메소드 요청에 필요한 baseUrl은 다음과 같이 &lt;strong&gt;@Value로 묶여있다.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;또한 baseUrl에 대해서 &lt;strong&gt;setter를 설정하는 것은 위험&lt;/strong&gt;하다.&lt;/p&gt;

&lt;p&gt;이때 ReflectionTestUtils를 가볍게 사용하면 좋다.&lt;/p&gt;

&lt;h2 id=&quot;변경된-단위-테스트&quot;&gt;변경된 단위 테스트&lt;/h2&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CustomClientTest&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CustomClient&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt; 
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;param&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;abc1234&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@BeforeEach&lt;/span&gt; 
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setUp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;sut&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CustomClient&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ReflectionTestUtils&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setField&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;baseUrl&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://api.somewhere.com&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;getSth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;CustomResponse&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sut&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getSth&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getEmail&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isNotNull&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;직접적으로 CustomClient에 변경사항 없이 테스트용으로 사용할 때 깔끔하고 좋다.&lt;/p&gt;
</description>
            <pubDate>Tue, 08 Jan 2019 00:00:00 +0000</pubDate>
            <link>/2019-01-08/reflectionTestUtils</link>
            <guid isPermaLink="true">junebuug.github.io/2019-01-08/reflectionTestUtils</guid>
            
            <category>Java</category>
            
            <category>Spring</category>
            
            <category>UnitTest</category>
            
            
        </item>
        
        <item>
            <title>2018. 회고</title>
            <description>&lt;p&gt;2017 회고를 쓰면서 2018에는..! 하는 마음이 있었던 것도 어제 같은데, 벌써 12월의 마지막 날이다.&lt;/p&gt;

&lt;p&gt;시간 순으로 할까, 주제 순으로 할까, Good, Bad로 할까 고민했는데, 일단 주제순으로 가도록 한다.&lt;/p&gt;

&lt;h2 id=&quot;졸업-그리고-&quot;&gt;졸업, 그리고 ..&lt;/h2&gt;

&lt;h3 id=&quot;1월--2월&quot;&gt;1월 :: 2월&lt;/h3&gt;

&lt;p&gt;휴학이 끝나고 겨우 2학기를 마친 후, 숨돌릴 틈도 없이 &lt;code class=&quot;highlighter-rouge&quot;&gt;코드스쿼드&lt;/code&gt;에서 인턴을 했다. (개인 블로그지만) 이 자리를 빌어 JK 마스터님께 정말 감사를 표한다. 학교의 얼토당토않는 행정처리 일정에 한줄기 빛처럼 내려와 인턴을 하게 되었다.&lt;/p&gt;

&lt;p&gt;이때 코드스쿼드 수료증 시스템과 관리툴을 &lt;code class=&quot;highlighter-rouge&quot;&gt;python &amp;amp; django&lt;/code&gt; 로 만들었다. Github 로그인 - OAuth2 로그인과 토큰 개념, jwt 개념, vue 끄적이기, google docs 긁어와서 코드스쿼드 맛집 봇 만들기 (?),  AWS 에 DB랑 웹어플리케이션 서버 나눠서 배포하는 것 등을 익혔다. NAT 해보고. nginx 로 배포도 해보고.. 아무것도 모르면서 겁도 없이 물어보고, 고통받으면서 만들었다. 아 나 근데 원래 iOS 개발하려던거 아니야?&lt;/p&gt;

&lt;p&gt;하지만 행복했다. 기획부터 개발까지 전부 다 했고, 매 순간이 배움이라 너무 재밌었다. 인턴급여를 받으면서도 이정도 가르침을 받았으면 돌려드려야하는 거 아닐까 싶을 정도. 그리고 김준영은 이때의 경험을 바탕으로 겁없이 서버 개발자 포지션에도 넣게 되는데…&lt;/p&gt;

&lt;h3 id=&quot;3월&quot;&gt;3월&lt;/h3&gt;

&lt;p&gt;3월의 메인은 바로 이것이 아닐까. 재수를 하고, 또 1년 휴학을 한 탓에 마음에 조급함이 있었나보다. 아슬아슬하게 한학기 조기졸업 가능하다는 사실을 알고, 계속해서 설계, 설계를 했고 1-2월의 인턴도 그의 연장선상이었다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/2018-12-30/2018-12-307-4590a06a-53b0-4f6f-886f-c24b1a1f39e4.07.17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;학부에서 제일 무섭다고 생각하던 교수님이 학과장님이었는데, 학과장님께 메일을 울면서 몇통 찔러서 (행정적 문제가) 해결됐다.&lt;/p&gt;

&lt;p&gt;지금이야 이렇게 담담하게 말하지만, 계획이 어그러지는 걸 못참아 못참아~~ 하는 성격이여서 계속 주변사람들 붙들고  나 졸업되냐..하고 물어봤다 (학우들이 어떻게 알겠어..) 죄송합니다..&lt;/p&gt;

&lt;h3 id=&quot;4월--6월&quot;&gt;4월 :: 6월&lt;/h3&gt;

&lt;p&gt;본격적으로 구직을 준비하기 시작한다. 7월부터 해도 되지않을까? 졸업이 해결되면, 남은 한학기로 가능하지 않을까? 하는 생각이 있었으나, 조급했으므로 그냥 진행했다.&lt;/p&gt;

&lt;p&gt;지금 생각하면 7월부터 천천히 하라고 말해주고싶다.  너 방학 이제 평생없어.. 하고 속삭여줄텐데.&lt;/p&gt;

&lt;p&gt;평생의 숙원이던 게임회사 A, 메신저 회사 B, 금융 스타트업 C, 글로벌 오픈소스 스타트업 D, 그리고 지금 재직 중인 네이버에 지원서를 냈다.&lt;/p&gt;

&lt;p&gt;C, D는 직접 티타임 or 바베큐파티를 갖고 먼저 사람들을 만나 뵈었는데, 둘다 너무 호감가는 (개발자로서도, 인간으로서도) 사람들이 있었다. 하지만 스케쥴을 조정하는 과정에서 나의 구직 체력 부족으로 코딩테스트 전에 조심스럽게 포기의사를 전했다.&lt;/p&gt;

&lt;p&gt;A,B와 네이버는 코딩테스트를 통과하고 면접을 보러갔다.&lt;/p&gt;

&lt;p&gt;A의 면접이 가장 먼저 있었는데, WTM과 장고걸스, 학업까지 겹쳐 하나도 공부를 안하고 갔다. FE 포지션이었고, 아주 기초적인 질문에도 답을 못했다. CS에서도 탈탈 털렸다. 면접을 굉장히 꼼꼼하게 짚는다는 느낌을 받았다. 꽤 시간이 지난 뒤에 정성스러운 불합격 이유를 받을 수 있었다. 첫 면접이 가장 빡셌던 게 이후의 준비에 도움이 됐다.&lt;/p&gt;

&lt;p&gt;네이버는 면접에서는 기초적인 stack, queue, BFS… 등을 물어봤다. 이 정도만 하면 우리가 키워줄게~~~ 라는 느낌을 받았다. 서버개발자 포지션으로 지원했다.&lt;/p&gt;

&lt;p&gt;B는 공채 형식으로 진행된 시험이었다. iOS 신입 포지션으로, 전반적인 CS와 디자인패턴에 관해서 물어봤다. 면접관들이 가장 젊어서 팀이 젊구나! 싶었다. 디자인패턴은 답을 못하고, 네트워크는 싹 답해서 왜인지 서버 개발자분의 마음에 든 것 같았다. 1차를 붙어서 매우 고민했지만, 네이버를 붙은 이후로 마음이 놓여서 2차 면접은 안감.&lt;/p&gt;

&lt;p&gt;이 와중에도 나의 12학점과 매주 나오는 퀴즈와 과제들은 내 발목을 잡고 있었다. 이 기간에 몸무게가 4키로 정도 늘었고 지금도 안빠진다(ㅋㅋㅋㅋㅋ) 받은 스트레스를 모두 먹는 것으로 풀어서, 위장장애도 심했다.&lt;/p&gt;

&lt;p&gt;네이버가 가장 먼저 결과가 나왔고, 나의 체력을 최대한 아끼기 위해 그리고 다른 여러 상황을 고려해서 네이버로 결정했다. 스스로 ‘스타트업향’ 인간이라고 생각했던 나에게는 나름 큰 결정이었다.&lt;/p&gt;

&lt;h3 id=&quot;7월--8월&quot;&gt;7월 :: 8월&lt;/h3&gt;

&lt;p&gt;… 입사를 했다. 그리고 버려졌다.😨 적응할 새도 없이, 회사의 사정으로 인해 팀이 분해되었다. 매일 하는 게 팀에서 정해준 멘토님과 ‘어떤 개발을 하고 싶고’ ‘그래서 준영님은 어느 팀으로 혹은 누구를 따라갈 것인가’ 에 대한 고민을 나누는 일이었다.&lt;/p&gt;

&lt;p&gt;나는 분명 플랫폼 팀에 지원을 해서 왔지만, 서비스가 더 좋았다. 그래서 서비스를 하는 팀으로 가기로 했다. 이 과정에서 iOS 로 갈 수 있나요?!!! 했지만 서버로 와! 해서 그대로 서버 개발자가 되었다.&lt;/p&gt;

&lt;p&gt;분명히 코딩테스트도 파이썬으로 풀었는데, 어느 팀을 가든 자바랑 스프링은 쓸거라면서 먼저 스프링을 공부해두면 좋을 것이라고 추천을 받았다. 내가 포비님을 알고 있어서 다행이야. 자바지기님의 유튜브와 책을 보면서 기본적인 CRUD 게시판을 만들고, 공부를 했다.&lt;/p&gt;

&lt;h3 id=&quot;9월--12월&quot;&gt;9월 :: 12월&lt;/h3&gt;

&lt;p&gt;하지만 이게 전화위복이 될 줄이야. 좋은 팀을 만났다. 그리고 좋은 멘토님을 만났다! 😭&lt;/p&gt;

&lt;p&gt;짧은 첫 팀 생활 중에도, 인간적으로 멋지신 분이다! 하고 생각하던 분이 같이 전배를 오시고, 사수가 되어 계속 공부를 봐주셨다.&lt;/p&gt;

&lt;p&gt;정말 맘껏 공부할 수 있었고, 솔직히 어려운게 바로 풀리니까 속도가 장난아니었다.&lt;/p&gt;

&lt;p&gt;게다가 나는 조금이라도 질책을 받으면 정말 스트레스를 많이 받는 편인데, 질책이나 짜증 한번 없이 지도해주셨다. 개발자이전에 한 사람으로서 닮고 싶습니다.&lt;/p&gt;

&lt;p&gt;더불어 중간에 Notion을 알게 된 이후로는 Dev 공부노트를 쭉쭉 쌓아갔다. 모르는 건 바로 적어두고, 나중에 시간이 나면 계속해서 공부해서 노트를 한 페이지씩 적어가는 방식. (지금 49개)&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/2018-12-30/2018-12-306-9475a126-31b7-4e43-9fc6-7f247bc28b99.51.07.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;하던 프로젝트를 접고 새로운 프로젝트를 시작하면서, 신입인 내 코드를 프로덕션에 내볼 기회가 생겼다. 😭 대박…근데 리더님 저 스프링 공부한지 2달밖에 안됐는데요…&lt;/p&gt;

&lt;p&gt;좋은 팀을 만나, 나의 역량보다 살짝 높은 목표를 받고, 꼼꼼한 코드리뷰를 받으면서 ‘어떤 개발자가 될 것인가’ 에 대한 윤곽을 만들어나가는 중이다. 또 나름대로 ‘이 부분 관련해서는 준영님이 담당했어’ 하는 파트가 생겨서 또 나름의 뿌듯함이 있다.&lt;/p&gt;

&lt;p&gt;연차만 보면 나보다 많이 높지 않은데, 엄청난 실력 차가 느껴지는 분도 있다. 이 분을 보고 또 마음을 새롭게 다지게 된다. &lt;code class=&quot;highlighter-rouge&quot;&gt;내가 몇년 뒤에 저분만큼 할 수 있을까?&lt;/code&gt; 싶어서. 계속해서 자극받고, 매일 배운다. 좋은 동료가 이렇게나 중요하구나. 그래서 하반기에는 커뮤니티를 많이 나가지 않아도 충분했다.&lt;/p&gt;

&lt;h2 id=&quot;커뮤니티&quot;&gt;커뮤니티&lt;/h2&gt;

&lt;p&gt;작년보다 참여는 적게, 운영은 더 많이 했다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;4월 7일  Women Techmakers Korea 운영진 : 너무 좋아서 &lt;a href=&quot;https://junebuug.github.io/2018-04-07/fastest-wtm-review&quot;&gt;후기&lt;/a&gt;도 빨리 적었다.&lt;/li&gt;
  &lt;li&gt;4월 30일 장고걸스 서울 세미나 Real Python &lt;code class=&quot;highlighter-rouge&quot;&gt;운영&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;6월 오픈핵 해커톤 디자이너로 &lt;code class=&quot;highlighter-rouge&quot;&gt;참가&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;7월 장고걸스 서울 워크샵 &lt;code class=&quot;highlighter-rouge&quot;&gt;운영&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;8월 파이콘 &lt;code class=&quot;highlighter-rouge&quot;&gt;참가&lt;/code&gt; : 파이썬 짱이야 멋있어 짜릿해 회사들도 위트넘쳐&lt;/li&gt;
  &lt;li&gt;12월 장고걸스 서울 밋업 Hello Developers &lt;code class=&quot;highlighter-rouge&quot;&gt;운영&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;새해에는 새로운 커뮤니티를 꾸려나가보려고 하는데, 많은 여성분들께 개발에 입문하는 데 있어 발판이 되길 열심히 소망하는 중이다.&lt;/p&gt;

&lt;h2 id=&quot;건강&quot;&gt;건강&lt;/h2&gt;

&lt;p&gt;상반기에 지속적인 급체와 두통이나,
두번의 위장장애로 인한 쇼크 기절 - 10월에 한번, 12월에 한번 - 이런 점은 내가 스트레스에 얼마나 취약하고 관리를 못하고 있었는지를 잘 보여준다.&lt;/p&gt;

&lt;p&gt;그나마 하반기에는 운동을 병행해서 컨디션이 많이 올라갔다. (그런데 갑자기 분위기 기절 ㅜ)&lt;/p&gt;

&lt;h2 id=&quot;여행&quot;&gt;여행&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;오사카 with 보우&lt;/li&gt;
  &lt;li&gt;속초 가족 여행&lt;/li&gt;
  &lt;li&gt;후쿠오카 당일치기 ( 아이폰XS와 돌아옴)&lt;/li&gt;
  &lt;li&gt;오빠 서프라이즈 미국 탐방 : 3개월 동안 거짓말 하느라 힘들었다. 다시는 안할 것임&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;올해의-best&quot;&gt;올해의 BEST&lt;/h2&gt;

&lt;h3 id=&quot;게임&quot;&gt;게임&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;단연 &lt;code class=&quot;highlighter-rouge&quot;&gt;Detroit: become human&lt;/code&gt;이다.  이런 스토리 게임은 처음 해보았다. 연수의 추천으로 5시간동안 스토리 1/3을 보고, PS4를 사게 만들었다(…)&lt;/li&gt;
  &lt;li&gt;제 5인격 : 하세요 하세요, 저같은 쫄보도 합니다. 데바데의 귀여운 버전.&lt;/li&gt;
  &lt;li&gt;저스트댄스 2019 with 플스 카메라 : 최고야…… 공간이 있는 곳에 저와 제 플스를 불러주세요&lt;/li&gt;
  &lt;li&gt;듀랑고 : 1-2월을 바쳤는데 너무 심한 노가다로 포기했다.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;지름&quot;&gt;지름&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;아이폰 XS.&lt;/li&gt;
  &lt;li&gt;PS4 와 플스 카메라&lt;/li&gt;
  &lt;li&gt;에어팟&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;만화&quot;&gt;만화&lt;/h3&gt;

&lt;p&gt;음식만화를 진짜 많이 봤는데, 생각나는게 별로 없다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;하이큐 (아껴보는 중) ,식극의 소마 ( 리액션 빼고 좋음 ㅜ,ㅜ)&lt;/li&gt;
  &lt;li&gt;녹풍당의 사계절 , 배달주문의 왕자님&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;신앙&quot;&gt;신앙&lt;/h2&gt;

&lt;p&gt;2018 하반기 들어서 특히나 교회를 자주 빠지기 시작했다. 최소한의 양심이던 식기도ㅋㅋㅋ도 빼먹는 날이 생겼고, 이때 쯤 부터 가족이나 남자친구에게 화를 자주 냈다. 정말 사람이 간사한게, 좀 살만하니까 간절했던 과거의 자신을 잊는다. 부족한 저를 용서해주세요.&lt;/p&gt;

&lt;h1 id=&quot;todo&quot;&gt;TODO&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;좀더 개발 공부를 열심히 하고 싶다. 내가 평생 개발자로 살지는 모르겠지만, 지금에 최선을 다하고 파. 스터디 1개 계획 중 ( Effective Java 3E : 연락주세요)&lt;/li&gt;
  &lt;li&gt;매일 QT&lt;/li&gt;
  &lt;li&gt;건강 챙기기 : 운동, 그리고 식단. 쓰러지지 않는 것이 1차 목표다.&lt;/li&gt;
  &lt;li&gt;일본어 배우기 : 서비스가 일본향이라, 만든 걸 확인 못해서 답답해죽겠다. 간단한 일본어라도 터득하고싶다.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;.&lt;/h2&gt;

&lt;p&gt;이렇게 일단은 2018을 마무리.&lt;/p&gt;

&lt;p&gt;일도 많고, 탈도 많고, 성장도 많았던 한 해였다.&lt;/p&gt;

&lt;p&gt;내년에도 잘 부탁드립니다.&lt;/p&gt;
</description>
            <pubDate>Sun, 30 Dec 2018 00:00:00 +0000</pubDate>
            <link>/2018-12-30/postmortem</link>
            <guid isPermaLink="true">junebuug.github.io/2018-12-30/postmortem</guid>
            
            <category>회고</category>
            
            
        </item>
        
        <item>
            <title>Java8 Datetime 대.정.리</title>
            <description>&lt;h1 id=&quot;-준영님-이-date-무슨-형식으로-보내야해요&quot;&gt;??: 준영님 이 Date 무슨 형식으로 보내야해요?&lt;/h1&gt;

&lt;p&gt;그동안은 date는 무조건 서버에서 만들어서 넣어주는 것이어서 몰랐는데, date를 클라이언트(iOS앱) 에서 받을 일이 생겼다. DTO에는 해당 필드(createdDate라고 하자.) 가 ZonedDateTime인 건 알았는데, json 에서 어떻게 보내야하지? String 으로 말고..!&lt;/p&gt;

&lt;p&gt;이러던 와중에  최근에 LocalDateTime DTO 변환에 관한 좋은 글을 읽었던 게 생각이 났다.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jojoldu.tistory.com/361&quot;&gt;https://jojoldu.tistory.com/361&lt;/a&gt; LocalDateTime 을 json 직렬화하기! 가 궁금하다면 이 링크를 참고하자.&lt;/p&gt;

&lt;p&gt;서버에서 대응해볼 수 있는 방법을 모두 적어두었다.&lt;/p&gt;

&lt;p&gt;다행히 swagger를 쓰고 있어서, 앱에서  ‘2018-12-27T16:44:29.264+09:00’ 형태로 보내면 된다는 걸 알아냈다. 그런데 yyyy-MM-dd’T’HH:mm.ss 까지는 알겠는데 그 뒤에 &lt;code class=&quot;highlighter-rouge&quot;&gt;264+09:00&lt;/code&gt;은 어떻게 표현하지..?&lt;/p&gt;

&lt;p&gt;너무 너무 당황했다 😢 나는 멍청이라네 깔깔&lt;/p&gt;

&lt;h2 id=&quot;멍청이는-java-datetimeformat을-살펴보자&quot;&gt;멍청이는 Java DateTimeFormat을 살펴보자~~&lt;/h2&gt;

&lt;p&gt;참고: &lt;a href=&quot;https://www.joda.org/joda-time/apidocs/org/joda/time/format/DateTimeFormat.html&quot;&gt;https://www.joda.org/joda-time/apidocs/org/joda/time/format/DateTimeFormat.html&lt;/a&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;심볼&lt;/th&gt;
      &lt;th&gt;뜻&lt;/th&gt;
      &lt;th&gt;예시&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;y&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;해(년)&lt;/td&gt;
      &lt;td&gt;1994&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;D&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;그 해의 몇번째 날인지&lt;/td&gt;
      &lt;td&gt;189&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;m&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;달&lt;/td&gt;
      &lt;td&gt;June; Jun; 06&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;d&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;일&lt;/td&gt;
      &lt;td&gt;31&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;a&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;AM, PM&lt;/td&gt;
      &lt;td&gt;PM&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;h&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;clock hour(12시간 기준)&lt;/td&gt;
      &lt;td&gt;12&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;H&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;hour of day (24시간 기준)&lt;/td&gt;
      &lt;td&gt;23; 24&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;m&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;분&lt;/td&gt;
      &lt;td&gt;30&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;s&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;초&lt;/td&gt;
      &lt;td&gt;55&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;S&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;1/1000 초 단위&lt;/td&gt;
      &lt;td&gt;978&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;z&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;time zone (text)&lt;/td&gt;
      &lt;td&gt;PST; Pacific Standard Time; UTC&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;Z&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;time zone 오프셋 (zone)&lt;/td&gt;
      &lt;td&gt;+0900; 09:00; Asia/Seoul&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;즉 위에서 본 ‘2018-12-27T16:44:29.264+09:00’ 은&lt;/p&gt;

&lt;p&gt;‘yyyy-MM-dd’T’HH:mm:ss’ → ‘2018-12-27T16:44:29’ 까지 매칭되고&lt;/p&gt;

&lt;p&gt;‘yyyy-MM-dd’T’HH:mm:ss.SSSZZ’ → ‘2018-12-27T16:44:29.264+09:00’ 까지 매칭된다.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Zone: ‘Z’ outputs offset without a colon, ‘ZZ’ outputs the offset with a colon, ‘ZZZ’ or more outputs the zone id.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;즉 Z인 경우 +0900, ZZ 인 경우 +09:00, ZZZ인 경우 “Asia/Seoul” 과 같이 붙는다는 뜻이다.&lt;/p&gt;

&lt;p&gt;참고로 offset은 GMT(UTC) 기준 더해야하는 시간이다. 서울은 GMT보다 +9시간해야하므로, +0900이다.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;iOS에서는 표현이 다르다.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;iOS에서는 &lt;strong&gt;yyyy-mm-dd’T’HH:mm:ss.SSSZZZZZ&lt;/strong&gt; 로 표현할 경우에 +09:00 로 표현이 되었고 이대로 json으로 보내니까 서버에서 200이 떨어졌다.  ZZZ 나 ZZ 등은 GMT가 붙고, 문제 상황에서 원하는 대로 표현이 안된다.  이와 관해서는 &lt;a href=&quot;https://stackoverflow.com/questions/28016578/how-to-create-a-date-time-stamp-and-format-as-iso-8601-rfc-3339-utc-time-zone?rq=1&quot;&gt;https://stackoverflow.com/questions/28016578/how-to-create-a-date-time-stamp-and-format-as-iso-8601-rfc-3339-utc-time-zone?rq=1&lt;/a&gt; 를 참조하도록 하자!&lt;/p&gt;

&lt;h2 id=&quot;일단-그래서-localdatetime--zoneddatetime-offsetdatetime-뭐가-다르니&quot;&gt;일단 그래서 LocalDateTime , ZonedDateTime, OffsetDateTime 뭐가 다르니&lt;/h2&gt;

&lt;p&gt;이 Time 들은 &lt;code class=&quot;highlighter-rouge&quot;&gt;java.time&lt;/code&gt; 패키지 안에 오밀조밀 모여있다. 설명을 읽어보면,&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/2018-12-27/scrn1-7050283d-1936-40e5-84b3-01b8dc4f0c3d.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;localdatetime&quot;&gt;LocalDateTime&lt;/h3&gt;

&lt;p&gt;ISO-8601 캘린더 시스템의 타임존 개념이 없는, 날짜-시간 시스템.&lt;/p&gt;

&lt;p&gt;예) 1994-06-13T11:15:30&lt;/p&gt;

&lt;p&gt;그냥 LocalDateTime을 사용하면, 해당 컴퓨터의 타임존에 맞춘 시간을 의미한다. 서울에서 new LocalDateTime()을 하면 서울의 현재시각이 나온다.&lt;/p&gt;

&lt;p&gt;ISO-8601는 날짜와 시간과 관련된 국제표준이다. ISO-8601의 핵심은 &lt;code class=&quot;highlighter-rouge&quot;&gt;- : T W Z&lt;/code&gt; 같은 정해진 문자만 써서 작성한다는 것인데, 이는 즉 Jan 13 09:00 와 같은 표현을 사용하지 않는다는 것이다. 깔끔하니 좋구만!&lt;/p&gt;

&lt;h3 id=&quot;zoneddatetime&quot;&gt;ZonedDateTime&lt;/h3&gt;

&lt;p&gt;그럼 Zone-d는? 당연히, ISO-8601 캘린더에 정의된 타임존을 포함한 날짜-시간 시스템이다.&lt;/p&gt;

&lt;p&gt;예) 1994-06-13T11:15:30+09:00 Asia/Seoul&lt;/p&gt;

&lt;p&gt;아 뭐야, Asia/Seoul 은 GMT+0900 인거 나도 알고 있는데 약간 TMI 스럽다. 0900만 있어도 되는데!&lt;/p&gt;

&lt;h3 id=&quot;offsetdatetime&quot;&gt;OffsetDateTime&lt;/h3&gt;

&lt;p&gt;그래서 있는 OffsetDateTime. UTC/그리니치 에서부터의 오프셋만을 표현해준다.&lt;/p&gt;

&lt;p&gt;예) 1994-06-13T:11:15:30+09:00&lt;/p&gt;

&lt;p&gt;즉 정보의 양은 LocalDateTime &amp;lt; OffsetDateTime &amp;lt; ZonedDateTime이라고 말할 수 있을까.&lt;/p&gt;

&lt;p&gt;오호오호, 그러면 서로 변환도 됐으면 좋겠는데?&lt;/p&gt;

&lt;p&gt;물론 아주 쉽게 된다.&lt;/p&gt;

&lt;h3 id=&quot;localdatetime의-변환&quot;&gt;LocalDateTime의 변환&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/java/time/LocalDateTime.html&quot;&gt;https://docs.oracle.com/javase/8/docs/api/java/time/LocalDateTime.html&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;LocalDateTime객체에 atOffset(ZoneOffset offset) 메소드를 사용하면 OffsetDateTime으로 변환할 수 있다. ZoneOffset은 of(int hours) 메소드를 사용해서 만들수 있고.&lt;/li&gt;
  &lt;li&gt;LocalDateTime객체에 atZone(ZoneId zone) 메소드를 사용하면 ZonedDateTime으로 변환할 수 있다. ZoneId는 of(String zoneId) 가 되는데, 지정된 String들이 있다.
    &lt;ul&gt;
      &lt;li&gt;EST - -05:00&lt;/li&gt;
      &lt;li&gt;HST - -10:00&lt;/li&gt;
      &lt;li&gt;MST - -07:00&lt;/li&gt;
      &lt;li&gt;ACT - Australia/Darwin&lt;/li&gt;
      &lt;li&gt;AET - Australia/Sydney&lt;/li&gt;
      &lt;li&gt;AGT - America/Argentina/Buenos_Aires&lt;/li&gt;
      &lt;li&gt;ART - Africa/Cairo&lt;/li&gt;
      &lt;li&gt;AST - America/Anchorage&lt;/li&gt;
      &lt;li&gt;BET - America/Sao_Paulo&lt;/li&gt;
      &lt;li&gt;BST - Asia/Dhaka&lt;/li&gt;
      &lt;li&gt;CAT - Africa/Harare&lt;/li&gt;
      &lt;li&gt;CNT - America/St_Johns&lt;/li&gt;
      &lt;li&gt;CST - America/Chicago&lt;/li&gt;
      &lt;li&gt;CTT - Asia/Shanghai&lt;/li&gt;
      &lt;li&gt;EAT - Africa/Addis_Ababa&lt;/li&gt;
      &lt;li&gt;ECT - Europe/Paris&lt;/li&gt;
      &lt;li&gt;IET - America/Indiana/Indianapolis&lt;/li&gt;
      &lt;li&gt;IST - Asia/Kolkata&lt;/li&gt;
      &lt;li&gt;JST - Asia/Tokyo&lt;/li&gt;
      &lt;li&gt;MIT - Pacific/Apia&lt;/li&gt;
      &lt;li&gt;NET - Asia/Yerevan&lt;/li&gt;
      &lt;li&gt;NST - Pacific/Auckland&lt;/li&gt;
      &lt;li&gt;PLT - Asia/Karachi&lt;/li&gt;
      &lt;li&gt;PNT - America/Phoenix&lt;/li&gt;
      &lt;li&gt;PRT - America/Puerto_Rico&lt;/li&gt;
      &lt;li&gt;PST - America/Los_Angeles&lt;/li&gt;
      &lt;li&gt;SST - Pacific/Guadalcanal&lt;/li&gt;
      &lt;li&gt;VST - Asia/Ho_Chi_Minh&lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;즉 &lt;code class=&quot;highlighter-rouge&quot;&gt;ZoneId.of(&quot;Asia/Tokyo&quot;)&lt;/code&gt; 하면 자동으로 도쿄로 타임존이 지정된다.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;zoneddatetime의-변환&quot;&gt;ZonedDatetime의 변환&lt;/h3&gt;

&lt;p&gt;ZonedDatetime은 많은 정보를 들고 있기 때문에, 빼기만 하면 변환이 된다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;toLocalDateTime()으로 LocalDateTime을 얻을 수 있다.&lt;/li&gt;
  &lt;li&gt;toOffsetDateTime()으로 OffsetDateTime을 얻을 수 있다.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;offsetdatetime의-변환&quot;&gt;OffsetDateTime의 변환&lt;/h3&gt;

&lt;p&gt;반면 정보양이 중간인 이 친구는.. LocalDateTime은 쉽지만 ZonedDateTime은 당연히 Zone 정보를 줘야겠다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;toLocalDateTime()으로 LocalDateTime을 얻을 수 있다.&lt;/li&gt;
  &lt;li&gt;atZoneSameInstant(ZoneId zone)으로 zone정보를 붙여 ZonedDateTime을 줄 수 있다.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;추가참고--jpa에서-offsetdatetime등을-사용한다고-바로-timestamp-로-테이블에-저장되는게-아니다&quot;&gt;추가참고 : JPA에서 OffsetDateTime등을 사용한다고 바로 timestamp 로 테이블에 저장되는게 아니다?&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://www.popit.kr/java-8-datetime-%EC%99%80-jpahiberante-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8/&quot;&gt;https://www.popit.kr/java-8-datetime-와-jpahiberante-그리고-스프링-부트/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;결론적으로 우리 프로젝트는 스프링부트 2.1 + 를 쓰고 있기때문에 자연스럽게 되는 것이다. 이하의 버전은 추가 설정이나 hibernate가 java8를 지원하도록 하는 라이브러리 임포트를 해주어야한다.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;참고 자료들&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jojoldu.tistory.com/361&quot;&gt;https://jojoldu.tistory.com/361&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.joda.org/joda-time/apidocs/org/joda/time/format/DateTimeFormat.html&quot;&gt;https://www.joda.org/joda-time/apidocs/org/joda/time/format/DateTimeFormat.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/28016578/how-to-create-a-date-time-stamp-and-format-as-iso-8601-rfc-3339-utc-time-zone?rq=1&quot;&gt;https://stackoverflow.com/questions/28016578/how-to-create-a-date-time-stamp-and-format-as-iso-8601-rfc-3339-utc-time-zone?rq=1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/java/time/LocalDateTime.html&quot;&gt;https://docs.oracle.com/javase/8/docs/api/java/time/LocalDateTime.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.popit.kr/java-8-datetime-%EC%99%80-jpahiberante-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8/&quot;&gt;https://www.popit.kr/java-8-datetime-와-jpahiberante-그리고-스프링-부트/&lt;/a&gt;&lt;/p&gt;
</description>
            <pubDate>Thu, 27 Dec 2018 00:00:00 +0000</pubDate>
            <link>/2018-12-27/java8-datetime</link>
            <guid isPermaLink="true">junebuug.github.io/2018-12-27/java8-datetime</guid>
            
            <category>Java</category>
            
            
        </item>
        
        <item>
            <title>쿠키, 로컬 스토리지, 세션 스토리지 5초만에 알기</title>
            <description>&lt;p&gt;&lt;img src=&quot;/img/2018-12-26/cookie.001.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;참고&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.zerocho.com/category/HTML&amp;amp;DOM/post/5918515b1ed39f00182d3048&quot;&gt;https://www.zerocho.com/category/HTML&amp;amp;DOM/post/5918515b1ed39f00182d3048&lt;/a&gt;&lt;/p&gt;

</description>
            <pubDate>Sun, 23 Dec 2018 00:00:00 +0000</pubDate>
            <link>/2018-12-23/web-storage</link>
            <guid isPermaLink="true">junebuug.github.io/2018-12-23/web-storage</guid>
            
            <category>Web</category>
            
            <category>Storage</category>
            
            
        </item>
        
        <item>
            <title>CORS 맨날 봐도 모르겠어</title>
            <description>&lt;p&gt;맨날맨날 봐도 맨날 맨날 헷갈리니까 정리.&lt;/p&gt;

&lt;h2 id=&quot;왜-웹에서-api-서버에-요청-안가는-거에요-&quot;&gt;왜 웹에서 API 서버에 요청 안가는 거에요? 😭&lt;/h2&gt;

&lt;p&gt;웹 개발 시에 자바스크립트로 야심차게 외부 서버 경로로 ajax 요청을 날리면 요청이 실패한다.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;No 'Access-Control-Allow-Origin' Header is present on requested resource.
... 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;요청한 리소스, 즉 서버에서 내려준 응답에 &lt;code class=&quot;highlighter-rouge&quot;&gt;Access-Control-Allow-Origin&lt;/code&gt; 이라는 헤더가 없단다.&lt;/p&gt;

&lt;p&gt;아니 이게 뭔데.. 왜..안되는 거야..? 나는 행복하고 싶었는데.. 🤢&lt;/p&gt;

&lt;h2 id=&quot;너는-같은-도메인에만-요청을-보낼-수-있다-어리석은-웹이여-sop-정책&quot;&gt;너는 같은 도메인에만 요청을 보낼 수 있다 어리석은 웹이여.. SOP 정책&lt;/h2&gt;

&lt;p&gt;이는 웹 어플리케이션 보안 모델에서 중요한 개념인 SOP (Same-Origin Policy) 때문이다.&lt;/p&gt;

&lt;p&gt;이 정책은 자바스크립트(XMLHttpRequest) 즉 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;script&amp;gt;&amp;lt;/script&amp;gt;&lt;/code&gt; 로 표기된 스크립트에서 생성되는 &lt;strong&gt;사이트 간 HTTP 요청&lt;/strong&gt;은 불가능 하다는 것을 의미한다.&lt;/p&gt;

&lt;p&gt;즉 Same-Origin만 가능하다는 것인데, 이때 Same-Origin은 &lt;code class=&quot;highlighter-rouge&quot;&gt;프로토콜&lt;/code&gt; (e.g. http) , &lt;code class=&quot;highlighter-rouge&quot;&gt;호스트명&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;포트&lt;/code&gt; 가 같다는 것을 의미한다. 프로토콜이 http일때는 80 포트를, https 를 쓰면 443 포트를 쓰니 포트까지 같아야한다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/2018-12-20/cors-078e554b-1b60-4de4-b5fd-96bd565d6134.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;웹 보안을 위한 좋은 정책처럼 보이지만, 여러 도메인에 걸쳐서 구성되는 대규모 웹 프로젝트가 늘어나고, REST API를 통한 외부 호출이 늘어나는 상황에서는 귀찮은 정책이 될 수 밖에 없다.&lt;/p&gt;

&lt;p&gt;그래서 추가로 정책을 만든 것이 CORS다.&lt;/p&gt;

&lt;h2 id=&quot;cors는-씨오알에스라고-읽나요&quot;&gt;CORS는 씨오알에스라고 읽나요&lt;/h2&gt;

&lt;p&gt;CORS(Cross-Origin Resource Sharing)은 말 그대로 다른 서버의 리소스를 사용할 수 있는 것을 의미한다.&lt;/p&gt;

&lt;p&gt;만약 서버에서 내 웹을 허용만 해준다면, 접근이 가능하다.&lt;/p&gt;

&lt;h2 id=&quot;그럼-서버에서-설정-가능한-것인가요&quot;&gt;그럼 서버에서 설정 가능한 것인가요&lt;/h2&gt;

&lt;p&gt;CORS는 서버에서 설정을 해주어야한다.&lt;/p&gt;

&lt;p&gt;하지만 CORS를 사용하지 않고 클라이언트에서도 SOP를 우회하는 방법이 있다.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;웹 브라우저 실행 시 외부 요청 허용 옵션
    &lt;ul&gt;
      &lt;li&gt;SOP는 클라이언트인 웹 브라우저가 결정하는 것이므로, 이 과정을 살짝 넘어가면 된다.&lt;/li&gt;
      &lt;li&gt;크롬의 경우 커맨드라인 옵션으로 SOP 검사 동작을 무시할 수 있다.&lt;code class=&quot;highlighter-rouge&quot;&gt;—disable-web-security&lt;/code&gt; 옵션을 추가하면 된다.&lt;/li&gt;
      &lt;li&gt;다만 고객이 내 페이지에 들어올 때마다 이 옵션을 사용해서 들어올 순 없으므로, 개발 시 CORS 설정이 되기 전 잠깐 사용하도록 하자.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;외부 요청을 가능하게 해주는 플러그인 설치.
    &lt;ul&gt;
      &lt;li&gt;CORS는  &lt;code class=&quot;highlighter-rouge&quot;&gt;Access-Control-Allow-Origin&lt;/code&gt; 헤더를 추가해주는 식으로 동작하므로, 서버의 응답을 가로채서 이 헤더를 추가해주는 플러그인이 있다.&lt;/li&gt;
      &lt;li&gt;크롬 웹스토어에서 CORS로 검색하자.&lt;/li&gt;
      &lt;li&gt;이 방법도 마찬가지로 일반 사용자는 사용할 수 없다.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;뭐야-결국-cors-해줘야-해-&quot;&gt;뭐야 결국 CORS 해줘야 해 ?&lt;/h2&gt;

&lt;p&gt;Proxy 하는 방법도 있다. 내 웹을 설정한 서버에서 nginx proxy를 통해서 내 도메인에 요청을 하면,&lt;/p&gt;

&lt;p&gt;해당 요청을 서버에 밀어 넣어주는 방법이다. 즉 나는 &lt;code class=&quot;highlighter-rouge&quot;&gt;[http://mydomain.com/api/users](http://mydomain.com/api/users)&lt;/code&gt; 로 요청을 했지만, nginx가 proxy하여서 실제로 요청은 &lt;code class=&quot;highlighter-rouge&quot;&gt;[http://api.otherdomain.com/api/users](http://api.otherdomain.com/api/users)&lt;/code&gt; 로 가도록 하는 것이다. 브라우저 상에서는 내 도메인에 요청을 하는 것이므로, SOP의 영향을 받지 않는다.&lt;/p&gt;

&lt;h2 id=&quot;cors-설정을-해보자&quot;&gt;CORS 설정을 해보자&lt;/h2&gt;

&lt;p&gt;요청하려는 URL이 외부 도메인 (Same origin X) 일 경우 브라우저는 먼저 preflight 요청을 날리게 된다.&lt;/p&gt;

&lt;p&gt;preflight 요청은 실제로 요청하는 경로와 같은 URL에 대해서 &lt;strong&gt;OPTIONS&lt;/strong&gt; 메소드로 요청을 미리 날려보고 요청을 할 수 있는 권한이 있는 지 확인한다.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/2018-12-20/cors2-3d891103-45ca-4c32-8d49-4a7b38f88d5c.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;결국 CORS를 위해서는 사전에 클라이언트가 찔러보는 작업이 필요하다.&lt;/p&gt;

&lt;h3 id=&quot;서버에서는&quot;&gt;서버에서는&lt;/h3&gt;

&lt;p&gt;다음과 같은 요청 헤더를 줄 것인지 결정해야한다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Access-Control-Allow-Origin: 요청을 허용하는 출처. 위의 예제에서는 “http://yourdomain.com”.  출처를 상관하지않고 허용하는 경우 *&lt;/li&gt;
  &lt;li&gt;Access-Control-Allow-Credentials: 클라이언트 요청이 쿠키를 통해서 자격 증명을 해야하는 경우 true. 이 경우 클라이언트가 정해진 규격의 쿠키와 함께 요청을 보내야한다.&lt;/li&gt;
  &lt;li&gt;Access-Control-Allow-Methods: 요청을 허용하는 메소드. *일 경우 전부, 기본값은 GET, POST이다. preflight를 허용해야하므로 OPTIONS를 포함시킨다.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;나머지 값들은 많이 쓰이지 않으므로 나중에 정리하기로 한다.&lt;/p&gt;

&lt;p&gt;Spring Boot 의 경우&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;WebMvcConfigurer&lt;/code&gt; 를 상속하는 &lt;code class=&quot;highlighter-rouge&quot;&gt;@Configuration&lt;/code&gt; 클래스를 만들고, 다음 함수를 오버라이드한다.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;addCorsMappings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CorsRegistry&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;registry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;registry&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;addMapping&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/api/**&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;allowedOrigins&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;allowCredentials&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;allowedMethods&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;*&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;  
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;더 이상 울지말자 CORS!&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;참고&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://brunch.co.kr/@adrenalinee31/1&quot;&gt;https://brunch.co.kr/@adrenalinee31/1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://homoefficio.github.io/2015/07/21/Cross-Origin-Resource-Sharing/&quot;&gt;https://homoefficio.github.io/2015/07/21/Cross-Origin-Resource-Sharing/&lt;/a&gt;&lt;/p&gt;
</description>
            <pubDate>Sun, 23 Dec 2018 00:00:00 +0000</pubDate>
            <link>/2018-12-23/cors</link>
            <guid isPermaLink="true">junebuug.github.io/2018-12-23/cors</guid>
            
            <category>Web</category>
            
            <category>CORS</category>
            
            
        </item>
        
        <item>
            <title>자바 8의 함수형 인터페이스는 뭐에요</title>
            <description>&lt;p&gt;자바! 학교에서도 지속적으로 배우는 가장 익숙한 프로그래밍 언어 중 하나이다. 졸업때까지(2018) 만 해도  학부에서 파이썬이나 go 같은 트렌디한 언어가 아니라 자바를 한다고 하면 ??? 하고 바라보고, 고루한 언어처럼 여겨지기도 했다.&lt;/p&gt;

&lt;p&gt;자바를 제대로 처음 배울 때는 2014년이었는데, 사실 이때 Java8이 릴리즈됐다. 그러나 그때의 자바 강의는 자바의 OOP 로서의 부분에 집중해서 배웠고, 클래스, 인스턴스, 상속 … 등의 개념 등만 줄을 이었다. 붕어빵 틀과 붕어빵 예제를 몇번이나 들었는지.&lt;/p&gt;

&lt;p&gt;변하지 않고 내는 OOP임! 할 거 같던 자바는 Java 8로 엄청난 변신을 시도했다. Optional, Stream, Lambda Expression .. 즉 함수형 프로그래밍 패러다임을 도입한 것이다. 애초에 설계에 포함되어 있지 않은 패러다임을 어떻게 도입하냐고? 함수 자료형을 가져오는 과정을 객체로 바꿔버렸다.&lt;/p&gt;

&lt;h2 id=&quot;아니-일단-함수형-프로그래밍이-뭐야ㅠㅠ-쉽게-좀&quot;&gt;아니 일단 함수형 프로그래밍이 뭐야ㅠㅠ 쉽게 좀..&lt;/h2&gt;

&lt;p&gt;일반적으로 어떤 이론의 앞에 있는 말이 그 이론을 설명하고, 가장 중요한 개념이다. 즉, 함수형 프로그래밍에서도 제일 중요한 건 &lt;code class=&quot;highlighter-rouge&quot;&gt;함수&lt;/code&gt; 이다. 얼마나 중요하냐면, 함수형 프로그래밍은 함수를 &lt;code class=&quot;highlighter-rouge&quot;&gt;1급 시민&lt;/code&gt; 으로 처리한다 !&lt;/p&gt;

&lt;p&gt;..그런데, 1급 시민이 뭐야?&lt;/p&gt;

&lt;p&gt;1급 시민은 변수에 담을 수 있고, 인자로 전달할 수 있으며, 반환값으로 전달할 수 있는 것을 의미한다. 프로그래밍 언어 입장에서는 아주 최선으로 생각한다 =  변수도 되고 인자도 되고 리턴 값도 된다 ! 라는 뜻이다.&lt;/p&gt;

&lt;p&gt;그래서, 함수형 프로그래밍은 함수를 변수에 담고, 인자로 전달하고, 반환 값으로 전달할 수 있는 프로그래밍 방식을 의미한다. 이렇게 하면, &lt;code class=&quot;highlighter-rouge&quot;&gt;고차함수&lt;/code&gt; 를 만들어서 특정 함수의 작업 내용과 결과를 2차, 3차로 고도화할 수 있다는 장점이 나온다.&lt;/p&gt;

&lt;p&gt;아래 (함수형 프로그래밍언어인) 자바스크립트 예제를 보자.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;multiplyResultOfMethod&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// method의 결과 값을 곱해준다. &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;함수를 인자로 쓸 수 있고, 반환 값으로 쓸 수 있기때문에 귀찮게 &lt;code class=&quot;highlighter-rouge&quot;&gt;method()&lt;/code&gt; 의 결과를 다른 변수에 &lt;strong&gt;담아줄 필요 없이&lt;/strong&gt; 고차 함수를 완성했다.&lt;/p&gt;

&lt;p&gt;OOP이던 자바 입장에서는 그동안 객체가 애지중지하던 1급시민이다. 하지만 자바 8부터는 함수형 프로그래밍의 컨셉을 가지고 오려고 람다식을 도입하게 되며, 이를 &lt;strong&gt;모던 자바&lt;/strong&gt; 라고 한다.&lt;/p&gt;

&lt;h2 id=&quot;람다-λ-파장-아니니&quot;&gt;람다..? λ..? 파장 아니니..?&lt;/h2&gt;

&lt;p&gt;람다(Lambda)는 익명함수를 의미한다. 이름 없이 간결하게 함수를 작성할 수 있다. 핵심 역시 지울 수 있는 건 모두 지우자는 것이다.&lt;/p&gt;

&lt;p&gt;추상 메소드를 하나만 가진 &lt;code class=&quot;highlighter-rouge&quot;&gt;Person&lt;/code&gt; 인터페이스를 구현하는 아래 예제를 보자.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;talk&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Student&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;talk&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;를 공부했습니다.&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;person&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;talk&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;라고 생각합니다.&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;인터페이스 한번 구현하는데 너무 줄을 많이 차지한다. 이걸 고치고 싶다.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;new Person()은 앞에서 Person을 선언해서 알 수 있다.&lt;/li&gt;
  &lt;li&gt;정작 구체적으로 선언해야 할 건 talk 메소드 뿐인데, 하나밖에 없으면 이름 생략해도 되지 않을까?&lt;/li&gt;
  &lt;li&gt;인자(word)도 순서대로 넣으면 추론 가능하지 않을까?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;이렇게 탄생한 게 아래다.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;person&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;word&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;라고 생각합니다&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;word 하나뿐이고, 아래도 프린트문 하나뿐이니 괄호는 지워보자.&lt;/p&gt;

    &lt;p&gt;Person person = word -&amp;gt; System.out.println(word + “라고 생각합니다.”);&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;코드가 매우 많이 줄어들었다. 이것만으로도 충분한 이점이 보인다 👻&lt;/p&gt;

&lt;h2 id=&quot;함수형-인터페이스&quot;&gt;함수형 인터페이스&lt;/h2&gt;

&lt;p&gt;슬쩍 말했지만, 위에서는 &lt;strong&gt;추상 메소드가 &lt;code class=&quot;highlighter-rouge&quot;&gt;하나&lt;/code&gt;인 인터페이스&lt;/strong&gt;를 람다로 바꾸었다. 그럼 추상 메소드가 두개면? 가차없이 안된다. 그러니까, 람다로 쉽게 만들고 싶어서 일부러 메소드를 하나만 만들었는데 다른 사람이 맘대로 추가하는 경우는 없어야한다. 그래서 아예 이런 인터페이스들에게 이름을 붙여주었다. 이게 바로 &lt;strong&gt;함수형 인터페이스&lt;/strong&gt; 이다.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@FunctionalInterface&lt;/code&gt; 를 붙이면 해당 인터페이스가 함수형 인터페이스임을 알려준다.&lt;/p&gt;

&lt;p&gt;그리고도 자바가 기본적으로 제공하는 함수형 인터페이스들이 있다.&lt;/p&gt;

&lt;p&gt;자주 나오고 자주 사용되는 인터페이스들 이니 한번씩 꼭 보도록 하자 =)&lt;/p&gt;

&lt;h2 id=&quot;runnable&quot;&gt;Runnable&lt;/h2&gt;

&lt;p&gt;스레드 생성 시 자주 사용되는 인터페이스이며, 기존부터 존재하던 인터페이스이다.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Runnable&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; 
&lt;span class=&quot;c1&quot;&gt;// 인자가 없다.&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;supplier&quot;&gt;Supplier&lt;T&gt;&lt;/T&gt;&lt;/h2&gt;

&lt;p&gt;인자가 없이, T라는 타입을 리턴하는 메서드 &lt;code class=&quot;highlighter-rouge&quot;&gt;get&lt;/code&gt; 을 갖고 있다.&lt;/p&gt;

&lt;p&gt;인자가 없는데도 T를 제공(Supply) 하는 인터페이스.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Supplier&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Supplier 입니다&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// &quot;Supplier 입니다&quot; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;consumer&quot;&gt;Consumer&lt;T&gt;&lt;/T&gt;&lt;/h2&gt;

&lt;p&gt;T라는 타입의 인자를 받고, 리턴을 하지 않는 메서드 &lt;code class=&quot;highlighter-rouge&quot;&gt;accept&lt;/code&gt;을 갖고 있다.&lt;/p&gt;

&lt;p&gt;인자를 먹어(Consume) 버리는 인터페이스.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Consumer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;I am&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;accept&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;June&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;functiontr&quot;&gt;Function&amp;lt;T,R&amp;gt;&lt;/h2&gt;

&lt;p&gt;T 타입을 받아 R 을 리턴하는 기본적인 함수형. 메서드 &lt;code class=&quot;highlighter-rouge&quot;&gt;apply&lt;/code&gt;를 갖고 있다.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Function&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;valueOf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numVal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;apply&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;613&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;predicate&quot;&gt;Predicate&lt;T&gt;&lt;/T&gt;&lt;/h2&gt;

&lt;p&gt;T타입을 받아 boolean을 리턴하는 인터페이스. Function에서 R이 boolean으로 고정된 것이라고 보면 된다.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt;&lt;/strong&gt;라는 메소드를 갖고 있다.&lt;/p&gt;

&lt;p&gt;Predicate이 전제 or 명제라는 뜻이므로 당연히 boolean 값을 리턴할 것 같다. (?)&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Predicate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isNull&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;unaryoperator&quot;&gt;UnaryOperator&lt;T&gt;&lt;/T&gt;&lt;/h2&gt;

&lt;p&gt;Una- 는 하나라는 뜻이다(스페인어에서도  uno는 1 이니께)&lt;/p&gt;

&lt;p&gt;Function의 특이한 종류인지, 메서드를 똑같이 &lt;code class=&quot;highlighter-rouge&quot;&gt;apply&lt;/code&gt; 를 사용한다.&lt;/p&gt;

&lt;p&gt;인자를 T타입으로 받아 T타입을 리턴한다.&lt;/p&gt;

&lt;p&gt;String을 받아 String을 리턴하는 식!&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;UnaryOperator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/