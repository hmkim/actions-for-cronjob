<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0">
<channel>
<title>GreeMate의 끄적끄적</title>
<link>https://greemate.tistory.com/</link>
<description></description>
<language>ko</language>
<pubDate>Sun, 12 May 2019 21:49:05 +0900</pubDate>
<generator>TISTORY</generator>
<managingEditor>GreeMate</managingEditor>
<image>
<title>GreeMate의 끄적끄적</title>
<url>http://cfile10.uf.tistory.com/image/115F230E4BB604640CF61F</url>
<link>https://greemate.tistory.com</link>
<description></description>
</image>
<item>
<title>수동으로 64비트 콜스택 추적하기 (2)</title>
<link>https://greemate.tistory.com/entry/%EC%88%98%EB%8F%99%EC%9C%BC%EB%A1%9C-64%EB%B9%84%ED%8A%B8-%EC%BD%9C%EC%8A%A4%ED%83%9D-%EC%B6%94%EC%A0%81%ED%95%98%EA%B8%B0-2</link>
<description>&lt;p&gt;이번 포스팅에서는 지난 번에 다뤘던&amp;nbsp;&lt;a href=&quot;http://greemate.tistory.com/entry/%EC%88%98%EB%8F%99%EC%9C%BC%EB%A1%9C-64%EB%B9%84%ED%8A%B8-%EC%BD%9C%EC%8A%A4%ED%83%9D-%EC%B6%94%EC%A0%81%ED%95%98%EA%B8%B0&quot; target=&quot;_blank&quot; class=&quot;tx-link&quot;&gt;수동으로 64비트 콜스택 추적하기&lt;/a&gt;의 이론적인 배경을 알아본다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;지난번 포스팅에서 함수 하나가 사용하는 스택의 크기를 계산하기 위한 공식은 다음과 같았다.&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; line-height: 16.3636360168457px; text-align: justify; background-color: rgb(255, 255, 255);&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(203, 203, 203); padding: 10px; background-color: rgb(255, 255, 255);&quot;&gt;&lt;p&gt;&lt;span style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; line-height: 16.3636360168457px; text-align: justify; font-size: 9pt; background-color: rgb(255, 255, 255);&quot;&gt;stacksize = 리턴주소 push 크기 + 함수 프롤로그에서 사용한 push 크기 + 함수 프롤로그에서 rsp를 빼는 크기&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; line-height: 16.3636360168457px;&quot;&gt;이런 계산이 가능한 이유는 함수에서 사용하는 스택 크기가 항상&amp;nbsp;정해져 있기 때문이다.&lt;/p&gt;&lt;div&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;이를 이해하기 위해서는 일단 64비트의 기본적인 스택 구조를 이해해야 한다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;그림으로 표현해 보면 다음과 같다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;table align=&quot;center&quot; cellpadding=&quot;2&quot; cellspacing=&quot;0&quot; border=&quot;0&quot; class=&quot;txc-layout-tb&quot; width=&quot;600&quot; style=&quot;line-height: 16.3636360168457px; width: 600px;&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td valign=&quot;top&quot; style=&quot;height: 266px; width: 177px;&quot;&gt;&lt;table width=&quot;208&quot; height=&quot;280&quot; cellpadding=&quot;5&quot; cellspacing=&quot;0&quot; border=&quot;0&quot; class=&quot;txc-layout-inner-table&quot; style=&quot;width: 208px;&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td valign=&quot;top&quot; style=&quot;height: 265px; width: 206px;&quot;&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;table class=&quot;txc-table&quot; width=&quot;228&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; style=&quot;border: none; border-collapse: collapse; font-size: 12px; width: 228px;&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td style=&quot;width: 227px; height: 24px; border: 1px solid rgb(204, 204, 204);&quot;&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;&amp;nbsp;리턴주소&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;width: 227px; height: 24px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(204, 204, 204); border-right-width: 1px; border-right-style: solid; border-right-color: rgb(204, 204, 204); border-left-width: 1px; border-left-style: solid; border-left-color: rgb(204, 204, 204);&quot;&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;특수목적 임시저장&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;(레지스터, 보안쿠키 등)&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;...&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;지역변수&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;지역변수&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;지역변수&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;&amp;nbsp;...&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;width: 227px; height: 24px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(204, 204, 204); border-right-width: 1px; border-right-style: solid; border-right-color: rgb(204, 204, 204); border-left-width: 1px; border-left-style: solid; border-left-color: rgb(204, 204, 204);&quot;&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;...&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;파라미터6&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;&amp;nbsp;파라미터5&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;&amp;nbsp;파라미터4&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;&amp;nbsp;파라미터3&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;&amp;nbsp;파라미터2&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;&amp;nbsp;파라미터1&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;width: 227px; height: 24px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(204, 204, 204); border-right-width: 1px; border-right-style: solid; border-right-color: rgb(204, 204, 204); border-left-width: 1px; border-left-style: solid; border-left-color: rgb(204, 204, 204);&quot;&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;리턴주소&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/td&gt;&lt;td valign=&quot;top&quot; style=&quot;height: 266px; width: 357px;&quot;&gt;&lt;table width=&quot;275&quot; height=&quot;280&quot; cellpadding=&quot;5&quot; cellspacing=&quot;0&quot; border=&quot;0&quot; class=&quot;txc-layout-inner-table&quot; style=&quot;width: 275px;&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td valign=&quot;top&quot; style=&quot;width: 273px; height: 279px;&quot;&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;&amp;lt;= 상위 함수의 rsp&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;상위 함수의 리턴 주소&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;함수 내부에서 사용하는 스택 영역&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;함수 내부에서 호출하는 Sub 함수 중 파라미터가 가장 많은 함수의 파라미터만큼 예약한 공간&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;(최소 4개 예약)&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;&amp;lt;= 이 함수의 rsp (파라미터 1의 스택 주소)&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;Sub 함수 호출시 저장되는 이 함수의 리턴&amp;nbsp;주소&lt;/p&gt;&lt;p style=&quot;margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px; text-align: center;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;어떤 함수가 실행 중일 때 스택을 사용하는 형태를 보면 그림과 같이 구성된다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;특별한 경우를 제외하고는 대부분 이와 같은 형태를 보인다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;따라서 이렇게 사용되는 원리를 이해하면 수동으로 콜스택 추적이 가능해 진다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;각 영역들에 대해 알아보면 다음과 같다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;b&gt;1. 상위 함수 리턴 주소&lt;/b&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;설명이 필요없이 이 함수를 호출할 때 스택에 저장되는 호출자 주소다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;b&gt;2. 함수 내부에서 사용하는 스택 영역&lt;/b&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;지역변수, 임시 저장 영역 등으로 컴파일러가 구성한 스택 영역이다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;컴파일 시에 컴파일러가 이 영역의 크기를 계산하기 때문에 컴파일 시에 크기가 정해진다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;b&gt;3.&amp;nbsp;Sub 함수 파라미터 예약 공간&lt;/b&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;이 함수 내부에서 여러 개의 Sub 함수를 호출할 수 있을 텐데 그 중에서 가장 많은 파라미터 수 만큼 예약해 놓는다. 컴파일 시에 컴파일러가 계산해 놓을 수 있다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;함수 내부에서 사용하는 스택 크기는 2번하고 3번을 더한 값이다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;컴파일러는 컴파일시 함수 프롤로그에서 push와 sub rsp로 2, 3번을 구성해 준다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;u&gt;컴파일러가 함수에서 사용하는 스택의 크기를 미리 계산해서 함수 프롤로그에&amp;nbsp;코드를 만들어 주기 때문에...&lt;/u&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;u&gt;거꾸로 함수 프롤로그를 보고&amp;nbsp;스택을 사용하는&amp;nbsp;크기를 계산해서 함수가 사용하는 스택 크기를 알 수 있는 것이다.&amp;nbsp;&lt;/u&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;b&gt;4. 최소 4개 예약?&lt;/b&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;함수 내부에서 호출하는 Sub 함수들이 파라미터를&amp;nbsp;1개 밖에 받지 않는다고 하더라도 이 파라미터 공간은 최소 4개가 예약된다. 4개로 정해지는 이유는&amp;nbsp;64비트에서 파라미터 전달이&amp;nbsp;4개까지는&amp;nbsp;rcx, rdx, r8, r9 레지스터를 이용하기 때문인 것 같다. Sub 함수의 파라미터가 5개라면 5개의 파라미터를 저장할 공간을 예약해 놓는다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;재미있는 것은 Sub 함수를 호출할 때 현재 함수에서는 파라미터1~파라미터4 예약 공간을 채우지 않는다는 것이다. 파라미터는 이미 rcx, rdx, r8, r9에 넣어 놨으므로 스택에 다시&amp;nbsp;저장하지&amp;nbsp;않는다. 다만 파라미터가 5개 이상인 경우는 스택을 통&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;해 파라미터를 전달하기로 되어 있으니 파라미터5 이후는&amp;nbsp;스택에 저장해 준다.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;파라미터가 7개인 PsCreateSystemThread를 호출하는 코드를 보면서 확인해 본다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p style=&quot;line-height: 1.5;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 244, 192);&quot;&gt;fffff800`01795328 488364243000 &amp;nbsp; &amp;nbsp;and &amp;nbsp; &amp;nbsp; qword ptr [rsp+30h],0&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 1.5;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0179532e 488d055bfeffff &amp;nbsp;lea &amp;nbsp; &amp;nbsp; rax,[nt!InbvRotateGuiBootDisplay]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 1.5;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`01795335 488d4c2458 &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 216, 216);&quot;&gt;lea &amp;nbsp; &amp;nbsp; rcx,[rsp+58h]&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 1.5;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 244, 192);&quot;&gt;fffff800`0179533a 4889442428 &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+28h],rax&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 1.5;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 244, 192);&quot;&gt;fffff800`0179533f 488364242000 &amp;nbsp; &amp;nbsp;and &amp;nbsp; &amp;nbsp; qword ptr [rsp+20h],0&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 1.5;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`01795345 4533c9 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 216, 216);&quot;&gt;xor &amp;nbsp; &amp;nbsp; r9d,r9d&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 1.5;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`01795348 4533c0 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 216, 216);&quot;&gt;xor &amp;nbsp; &amp;nbsp; r8d,r8d&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 1.5;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0179534b 33d2 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;background-color: rgb(255, 216, 216);&quot;&gt;xor &amp;nbsp; &amp;nbsp; edx,edx&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 1.5;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0179534d e802a21900 &amp;nbsp; &amp;nbsp; &amp;nbsp;call &amp;nbsp; &amp;nbsp;nt!PsCreateSystemThread&amp;nbsp;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p style=&quot;line-height: 1.5; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;span style=&quot;background-color: rgb(250, 244, 192);&quot;&gt;첫번째 라인은 마지막&lt;/span&gt;&lt;span style=&quot;background-color: rgb(250, 244, 192);&quot;&gt;&amp;nbsp;7번째 파라미터&lt;/span&gt;&lt;span style=&quot;background-color: rgb(250, 244, 192);&quot;&gt;&amp;nbsp;스택 위치인 [rsp+30h]에 0을 저장&lt;/span&gt;&lt;span style=&quot;background-color: rgb(250, 244, 192);&quot;&gt;하는 것이다. 네번째&lt;/span&gt;&lt;span style=&quot;background-color: rgb(250, 244, 192);&quot;&gt;&amp;nbsp;라인에서 [rsp+28h]에 6번째 파라미터를 저장하고 다섯번째 라인에서 [rsp+20h]에 5번째 파라미터를 저장한다.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;span style=&quot;background-color: rgb(255, 216, 216);&quot;&gt;첫번째 파라미터부터 네번째 파라미터까지는 스택에 저장하는 모양은&lt;/span&gt;&lt;span style=&quot;background-color: rgb(255, 216, 216);&quot;&gt;&amp;nbsp;볼 수 없고 rcx, edx, r8d, r9d에 저장하는 모양이 나타나 있다.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;그러면 예약해 놓은 앞 네개의 파라미터 스택 공간은 언제 사용할까?&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;a href=&quot;https://msdn.microsoft.com/en-us/library/ew5tede7.aspx&quot; target=&quot;_blank&quot; class=&quot;tx-link&quot;&gt;MSDN&lt;/a&gt; 상으로는 호출된 Sub 함수가 레지스터로 전달된 파라미터를 스택에 저장하고 싶으면 사용할 수 있다고 되어 있다. 디버깅을 편하게 하기 위해 Sub 함수 프롤로그에서 레지스터로 전달된 파라미터를 여기에 저장하게 할 수도 있다고 설명은 하고 있지만...&amp;nbsp;실제로 대부분 이 영역은&amp;nbsp;사용하지 않아서 쓰레기값만 저장되어 있다. 그래서 콜스택을 디버깅할 때 함수간에 전달된 파라미터를 찾기가 매우 힘든 것이다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;b&gt;5. 이 함수의 rsp&lt;/b&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;64비트에서 함수가 실행될 때 사용하는 스택 베이스는&amp;nbsp;rsp다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;32비트에서는 함수에 진입하면 ebp를 스택 베이스로 잡고 함수 내부에서 사용하는 스택은 [ebp-xx]로 접근한다.&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;하지만 64비트에서는 함수에 진입하면 이 함수에서 사용하는 스택 크기를&amp;nbsp;모두 계산해서 미리 빼놓고 rsp에 저장한 후에 [rsp+xx]로 접근한다.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;그림에서 알 수 있듯이 rsp는 호출할&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;&amp;nbsp;함수에 전달할 파라미터 1의 주소를 가리키게 된다.&amp;nbsp;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;그래서 다음 위치는 항상 다음과 같은 의미를 가진다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;[rsp+00h] : 호출&amp;nbsp;함수에 전달할 파라미터 1을 저장&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;[rsp+08h] : 호출&amp;nbsp;함수에 전달할 파라미터 2를&amp;nbsp;저장&lt;/p&gt;&lt;div&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;[rsp+10h] : 호출&amp;nbsp;함수에 전달할 파라미터 3을 저장&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;[rsp+18h] : 호출&amp;nbsp;함수에 전달할 파라미터 4를&amp;nbsp;저장&lt;/p&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;하지만 현재 함수에서&amp;nbsp;이 위치를 참조하는 일은 없다. ㅠㅠ&lt;/div&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;그냥 의미만 알아 놓자. 현재&amp;nbsp;함수가&amp;nbsp;호출하는 sub&amp;nbsp;함수에 파라미터 5가 있다면 [rsp+20h]에&amp;nbsp;저장한다는 것은 알았으니...&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;이렇게 해서 64비트 콜스택 구성에 대해 모두 알아봤다.&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; margin-top: 0px; margin-bottom: 0px;&quot;&gt;일단 이정도만 알아도 64비트를 탐험하는 작업이 좀 더 편해질 것 같다.&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</description>
<category>WinDbg 디버깅</category>
<category>64비트</category>
<category>콜스택</category>
<author>GreeMate</author>
<guid>https://greemate.tistory.com/269</guid>
<comments>https://greemate.tistory.com/entry/%EC%88%98%EB%8F%99%EC%9C%BC%EB%A1%9C-64%EB%B9%84%ED%8A%B8-%EC%BD%9C%EC%8A%A4%ED%83%9D-%EC%B6%94%EC%A0%81%ED%95%98%EA%B8%B0-2#entry269comment</comments>
<pubDate>Sun, 22 Mar 2015 22:48:11 +0900</pubDate>
</item>
<item>
<title>수동으로 64비트 콜스택 추적하기</title>
<link>https://greemate.tistory.com/entry/%EC%88%98%EB%8F%99%EC%9C%BC%EB%A1%9C-64%EB%B9%84%ED%8A%B8-%EC%BD%9C%EC%8A%A4%ED%83%9D-%EC%B6%94%EC%A0%81%ED%95%98%EA%B8%B0</link>
<description>&lt;p&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;64비트 콜스택을 좀 보다보니 수동으로 따라갈 수 있는 방법을 하나 알게 되었다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;거의 포기하고 있었는데 보다보니 이런 것들이 보이기 시작하는구나... ㅋㅋ&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;이론을 먼저 설명하면 머리만 복잡해지니 예제부터 보기로 한다.&lt;/p&gt;&lt;p&gt;다음과 같은 콜스택이 있다고 해 보자.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt; font-family: 'Courier New';&quot;&gt;kd&amp;gt; k&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;Child-SP &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;RetAddr &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Call Site&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&lt;span style=&quot;background-color: rgb(250, 237, 125);&quot;&gt;fffff880`009adeb0&lt;/span&gt; fffff800`019a6135 nt!ExAllocatePoolWithTag+0x326&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff880`009adfa0 fffff800`019a3e3e nt!RtlpInheritAcl+0xc5&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff880`009ae070 fffff800`0197f6c2 nt!RtlpNewSecurityObject+0x8ce&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff880`009ae300 fffff800`0197e582 nt!ObpAssignSecurity+0x82&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff880`009ae370 fffff800`01980db3 nt!ObInsertObjectEx+0x1e2&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff880`009ae5c0 fffff800`019801be nt!PspInsertThread+0x2f3&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff880`009ae740 fffff800`0192f679 nt!PspCreateThread+0x246&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff880`009ae9c0 fffff800`01795352 nt!PsCreateSystemThread+0x125&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff880`009aeab0 fffff800`01bc751d nt!DisplayBootBitmap+0x162&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff880`009aeb00 fffff800`01b18e29 nt!Phase1InitializationDiscard+0x17d&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff880`009aecd0 fffff800`0192f73a nt!Phase1Initialization+0x9&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff880`009aed00 fffff800`016848e6 nt!PspSystemThreadStartup+0x5a&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff880`009aed40 00000000`00000000 nt!KiStartSystemThread+0x16&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;ExAllocatePoolWithTag 중간쯤에서 멈춰있는 상태다.&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;ExAllocatePoolWithTag 함수에서 사용중인 스택 베이스 포인터가 Child-SP fffff880`009adeb0로 나타나고 있다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;콜스택을 수동으로&amp;nbsp;추적하려면 각 함수의 스택 프레임의 기준을 찾는 것이 중요한데 Child-SP가 기준이라고 보면 된다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;Child-SP를 따라갈 수 있으면 되는데... 어떻게 할 수 있는지 확인해 보자.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;ExAllocatePoolWithTag 함수에서 멈춰 있는 상태에서 레지스터 상태를 보면 다음과 같다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5; font-family: 'Courier New';&quot;&gt;kd&amp;gt; r&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;rax=fffff8a000006000 rbx=fffffa8000c2d280 rcx=0000000000000001&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;rdx=0000000000000001 rsi=000000000000000e rdi=0000000000000001&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;rip=fffff800017c7f36 &lt;span style=&quot;background-color: rgb(250, 237, 125);&quot;&gt;rsp=fffff880009adeb0&lt;/span&gt; rbp=0000000000001000&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp;r8=0000000000000000 &amp;nbsp;r9=0000000000000000 r10=0000000000000000&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;r11=fffff880009ade80 r12=fffffa8000c2c140 r13=0000000000000000&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;r14=0000000000000002 r15=0000000063416553&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;iopl=0 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; nv up ei ng nz na po nc&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;cs=0010 &amp;nbsp;ss=0018 &amp;nbsp;ds=002b &amp;nbsp;es=002b &amp;nbsp;fs=0053 &amp;nbsp;gs=002b &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; efl=00000286&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!ExAllocatePoolWithTag+0x326:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`017c7f36 448928 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; dword ptr [rax],r13d ds:002b:fffff8a0`00006000=fe05a30d&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;rsp가 Child-SP와 같은 값을 가지고 있다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;일단 이론을 보기 전에 하나는 그냥 외우고 시작하자.&lt;/p&gt;&lt;p&gt;64비트에서는 기본적으로 rsp가 32비트에서의 ebp와 비슷한 역할을 한다.&lt;/p&gt;&lt;p&gt;64비트 코드를 분석해 보면 알겠지만 대부분 rsp를 거의 변경하지 않고 사용한다.&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;따라서 ExAllocatePoolWithTag는 rsp를 기준으로 자신의 스택을 사용하고 있다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;여기서 상위 함수의 rsp 값을 찾으려면&amp;nbsp;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;ExAllocatePoolWithTag의 코드 앞부분(프롤로그)을&amp;nbsp;보면 된다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt; font-family: 'Courier New';&quot;&gt;kd&amp;gt; u nt!ExAllocatePoolWithTag&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!ExAllocatePoolWithTag:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`017c7c10 fff5 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rbp&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`017c7c12 57 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rdi&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`017c7c13 4157 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;r15&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`017c7c15 4881ecd0000000 &amp;nbsp;sub &amp;nbsp; &amp;nbsp; rsp,0D0h&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`017c7c1c 8bc1 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; eax,ecx&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`017c7c1e 458bf8 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; r15d,r8d&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`017c7c21 448944245c &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; dword ptr [rsp+5Ch],r8d&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`017c7c26 83e044 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;and &amp;nbsp; &amp;nbsp; eax,44h&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;함수에 진입하자마자 push를 3번하면서 스택을 약간 사용하고&amp;nbsp;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;이 함수가 사용할 스택 크기를 확보하는 코드가 있다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;여기에 상위함수가&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;ExAllocatePoolWithTag를 호출하면서&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;자신의 리턴 주소를 push하는 것까지만 추가로 고려하면 함수 호출시에&lt;/span&gt;&lt;span style=&quot;font-size: 9pt; line-height: 16.3636360168457px;&quot;&gt;&amp;nbsp;사용된 스택 크기를 알 수 있다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;현재 rsp에서 이 크기를 계산해 주면 상위 함수의 rsp가 나온다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 9pt; line-height: 16.3636360168457px;&quot;&gt;따라서 상위 함수의 기준 rsp를 정확히 구하는 식은 다음과 같다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;stacksize&amp;nbsp;= 8 (리턴주소 push) + 8*3 (push 3번) + 0D0h (rsp에서 빼준 값)&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;상위 함수 rsp = 현재 함수 rsp + stacksize&lt;/span&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;ExAllocatePoolWithTag의 stacksize 계산 결과는 0F0h다.&lt;/p&gt;&lt;p&gt;다음과 같이 계산할 수 있다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt; font-family: 'Courier New';&quot;&gt;kd&amp;gt; ? fffff880`009adeb0 + F0&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;Evaluate expression: -8246327058528 = fffff880`009adfa0&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;계산된 fffff880`009adfa0는 콜스택을&amp;nbsp;확인해 보면 두번째 함수인&amp;nbsp;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;RtlpInheritAcl의 Chile-SP와 일치한다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;계속해서 같은 방법으로 계속 따라갈 수 있다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;기계적으로 한번 진행해 보자.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;함수 프롤로그 보고...&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt; font-family: 'Courier New';&quot;&gt;kd&amp;gt; u nt!RtlpInheritAcl&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!RtlpInheritAcl:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`019a6070 fff3 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rbx&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`019a6072 55 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rbp&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`019a6073 56 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rsi&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`019a6074 57 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rdi&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`019a6075 4881eca8000000 &amp;nbsp;sub &amp;nbsp; &amp;nbsp; rsp,0A8h&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`019a607c 410fb6f1 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;movzx &amp;nbsp; esi,r9b&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`019a6080 418bd8 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; ebx,r8d&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`019a6083 488bea &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; rbp,rdx&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;stacksize를 계산한다.&lt;/p&gt;&lt;p&gt;stacksize = 8 + 8*4 + 0A8h = D0h&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt; font-family: 'Courier New';&quot;&gt;kd&amp;gt; ? fffff880`009adfa0 + D0&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;Evaluate expression: -8246327058320 = fffff880`009ae070&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;fffff880`009ae070은&amp;nbsp;RtlpNewSecurityObject의 Child-SP와 일치한다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;RtlpNewSecurityObject를&amp;nbsp;따라가 보자.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt; font-family: 'Courier New';&quot;&gt;kd&amp;gt; u nt!RtlpNewSecurityObject&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!RtlpNewSecurityObject:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`019a3570 fff3 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rbx&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`019a3572 55 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rbp&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`019a3573 57 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rdi&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`019a3574 4881ec70020000 &amp;nbsp;sub &amp;nbsp; &amp;nbsp; rsp,270h&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`019a357b 488b055eb4e6ff &amp;nbsp;mov &amp;nbsp; &amp;nbsp; rax,qword ptr [nt!_security_cookie (fffff800`0180e9e0)]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`019a3582 4833c4 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;xor &amp;nbsp; &amp;nbsp; rax,rsp&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`019a3585 4889842450020000 mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+250h],rax&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`019a358d 488b8424d0020000 mov &amp;nbsp; &amp;nbsp; rax,qword ptr [rsp+2D0h]&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;stacksize = 8 + 8*3&amp;nbsp;+ 270h = 290h&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt; font-family: 'Courier New';&quot;&gt;kd&amp;gt; ? fffff880`009ae070 + 290&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;Evaluate expression: -8246327057664 = fffff880`009ae300&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;fffff880`009ae300은&amp;nbsp;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;ObpAssignSecurity의 Child-SP와 일치한다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;ObpAssignSecurity를 확인한다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5; font-family: 'Courier New';&quot;&gt;kd&amp;gt; u nt!ObpAssignSecurity&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!ObpAssignSecurity:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0197f640 48895c2410 &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+10h],rbx&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0197f645 48896c2418 &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+18h],rbp&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197f64a 56 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rsi&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197f64b 57 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rdi&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197f64c 4154 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;r12&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197f64e 4883ec50 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;sub &amp;nbsp; &amp;nbsp; rsp,50h&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0197f652 488364247000 &amp;nbsp; &amp;nbsp;and &amp;nbsp; &amp;nbsp; qword ptr [rsp+70h],0&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0197f658 4d8be0 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; r12,r8&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;stacksize = 8 + 8*3&amp;nbsp;+ 50h = 70h&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt; font-family: 'Courier New';&quot;&gt;kd&amp;gt; ? fffff880`009ae300 + 70&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;Evaluate expression: -8246327057552 = fffff880`009ae370&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;fffff880`009ae370은 ObInsertObjectEx의 Child-SP와 일치한다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;계속해서&amp;nbsp;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;ObInsertObjectEx를 따라가 본다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt; font-family: 'Courier New';&quot;&gt;kd&amp;gt; u nt!ObInsertObjectEx&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!ObInsertObjectEx:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197e3a0 fff3 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rbx&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197e3a2 55 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rbp&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197e3a3 56 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rsi&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197e3a4 57 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rdi&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197e3a5 4154 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;r12&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197e3a7 4155 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;r13&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197e3a9 4156 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;r14&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197e3ab 4157 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;r15&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;kd&amp;gt; u&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!ObInsertObjectEx+0xd:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`0197e3ad 4881ec08020000 &amp;nbsp;sub &amp;nbsp; &amp;nbsp; rsp,208h&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0197e3b4 488b052506e9ff &amp;nbsp;mov &amp;nbsp; &amp;nbsp; rax,qword ptr [nt!_security_cookie (fffff800`0180e9e0)]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0197e3bb 4833c4 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;xor &amp;nbsp; &amp;nbsp; rax,rsp&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0197e3be 48898424f0010000 mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+1F0h],rax&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0197e3c6 488bac2480020000 mov &amp;nbsp; &amp;nbsp; rbp,qword ptr [rsp+280h]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0197e3ce 4c8bf9 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; r15,rcx&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0197e3d1 4533d2 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;xor &amp;nbsp; &amp;nbsp; r10d,r10d&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`0197e3d4 410fb647e8 &amp;nbsp; &amp;nbsp; &amp;nbsp;movzx &amp;nbsp; eax,byte ptr [r15-18h]&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;이번엔 u 명령 한번으로는 sub rsp, 208h까지 보이지 않아서 u 명령을 한번 더 사용했다.&lt;/p&gt;&lt;p&gt;마찬가지로 모든 push와 sub rsp 명령에서 사용한 스택 사용량을 계산하면 된다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;stacksize = 8 + 8*8&amp;nbsp;+ 208&lt;/span&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;h = 250&lt;/span&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;h&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5; font-family: 'Courier New';&quot;&gt;kd&amp;gt; ? fffff880`009ae370 + 250&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;Evaluate expression: -8246327056960 = fffff880`009ae5c0&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;fffff880`009ae5c0는&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;PspInsertThread의 Child-SP와 일치한다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 9pt;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;이 정도면 충분히 연습이 됐을 것 같다.&lt;/p&gt;&lt;p&gt;모두 같은 방법으로 따라간 것이고 계속해서 같은 방법으로 진행할 수 있다&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;너무 길어졌으므로 이에 대한 이론은 &lt;a href=&quot;http://greemate.tistory.com/entry/%EC%88%98%EB%8F%99%EC%9C%BC%EB%A1%9C-64%EB%B9%84%ED%8A%B8-%EC%BD%9C%EC%8A%A4%ED%83%9D-%EC%B6%94%EC%A0%81%ED%95%98%EA%B8%B0-2&quot; target=&quot;_top&quot; class=&quot;tx-link&quot;&gt;다음 포스팅&lt;/a&gt;에서 다루도록 하겠다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</description>
<category>WinDbg 디버깅</category>
<category>64비트</category>
<category>콜스택</category>
<author>GreeMate</author>
<guid>https://greemate.tistory.com/268</guid>
<comments>https://greemate.tistory.com/entry/%EC%88%98%EB%8F%99%EC%9C%BC%EB%A1%9C-64%EB%B9%84%ED%8A%B8-%EC%BD%9C%EC%8A%A4%ED%83%9D-%EC%B6%94%EC%A0%81%ED%95%98%EA%B8%B0#entry268comment</comments>
<pubDate>Thu, 26 Feb 2015 23:15:26 +0900</pubDate>
</item>
<item>
<title>64비트 콜스택에서 함수 파라미터 찾기</title>
<link>https://greemate.tistory.com/entry/64-bit%EC%97%90%EC%84%9C-NtQueryAttributesFile-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0-%EC%B0%BE%EA%B8%B0</link>
<description>&lt;p&gt;얼마 전부터 Visual Studio를 실행할 때 거의 1~2분간 행이 걸려 있는 현상이 발생했었다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;뭐가 문제인지 어떻게 확인할까 하다가...&lt;/p&gt;&lt;p&gt;배운게 도둑질이라고 행이 걸려 있을 때 전체 덤프를 떠 버렸다. ^^&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Windbg로 덤프를 열고 먼저 msdev.exe 프로세스를 찾아서&amp;nbsp;실행중인 스레드를 봤다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px; font-family: 'Courier New';&quot;&gt;0: kd&amp;gt; !process 0 3f msdev.exe&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;PROCESS fffffa800fce6b30&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; SessionId: 1 &amp;nbsp;Cid: 1a10 &amp;nbsp; &amp;nbsp;Peb: 7efdf000 &amp;nbsp;ParentCid: 1268&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; DirBase: 1dfa1c000 &amp;nbsp;ObjectTable: fffff8a00862a110 &amp;nbsp;HandleCount: 314.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; Image: MSDEV.EXE&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; VadRoot fffffa80107d3c90 Vads 367 Clone 0 Private 12752. Modified 197443. Locked 0.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; DeviceMap fffff8a007ec5160&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; Token &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff8a0157176f0&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; ElapsedTime &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00:00:45.997&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; UserTime &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;00:00:00.000&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; KernelTime &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;00:00:00.062&lt;/span&gt;&lt;/p&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; ...&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/div&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; THREAD fffffa80126a0060 &amp;nbsp;Cid 1a10.19d8 &amp;nbsp;Teb: 000000007efdb000 Win32Thread: fffff900c2d53c20 RUNNING on processor 3&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Not impersonating&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; DeviceMap &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff8a007ec5160&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Owning Process &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;fffffa800fce6b30 &amp;nbsp; &amp;nbsp; &amp;nbsp; Image: &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; MSDEV.EXE&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Attached Process &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;N/A &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;Image: &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; N/A&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Wait Start TickCount &amp;nbsp; &amp;nbsp; &amp;nbsp;131878 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Ticks: 0&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Context Switch Count &amp;nbsp; &amp;nbsp; &amp;nbsp;156311 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; IdealProcessor: 7 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; LargeStack&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; UserTime &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;00:00:21.762&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; KernelTime &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;00:00:13.041&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;*** ERROR: Module load completed but symbols could not be loaded for MSDEV.EXE&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Win32 Start Address MSDEV (0x000000000040155c)&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Stack Init fffff8800c441530 Current fffff8800c441210&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Base fffff8800c442000 Limit fffff8800c435000 Call fffff8800c441580&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Priority 9 BasePriority 8 UnusualBoost 0 ForegroundBoost 0 IoPriority 2 PagePriority 5&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Child-SP &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;RetAddr &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Call Site&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff880`0c440680 fffff880`012aa404 Ntfs!NtfsFindPrefix+0x222&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff880`0c440730 fffff880`012a7af3 Ntfs!NtfsFindStartingNode+0x6e4&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff880`0c440800 fffff880`0128a149 Ntfs!NtfsCommonCreate+0x3d3&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff880`0c4409d0 fffff880`01140367 Ntfs!NtfsNetworkOpenCreate+0x119&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff880`0c440cb0 fffff880`011438ba fltmgr!FltpPerformFastIoCall+0x357&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff880`0c440d10 fffff880`01161a9f fltmgr!FltpPassThroughFastIo+0xda&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff880`0c440d50 fffff800`035d3c72 fltmgr!FltpFastIoQueryOpen+0x10f&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff880`0c440df0 fffff800`035cf878 nt!IopParseDevice+0x1249&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff880`0c440f50 fffff800`035d0a96 nt!ObpLookupObjectName+0x588&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff880`0c441040 fffff800`035aef66 nt!ObOpenObjectByName+0x306&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(250, 237, 125);&quot;&gt;fffff880`0c441110 fffff800`032d2e53 nt!NtQueryAttributesFile+0x145&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff880`0c4413a0 00000000`7754168a nt!KiSystemServiceCopyEnd+0x13 (TrapFrame @ fffff880`0c4413a0)&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008c9f8 00000000`73a2ae19 ntdll!NtQueryAttributesFile+0xa&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008ca00 00000000`73a1d18f wow64!whNtQueryAttributesFile+0x91&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008ca80 00000000`750c2776 wow64!Wow64SystemServiceEx+0xd7&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008d340 00000000`73a1d286 wow64cpu!ServiceNoTurbo+0x2d&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008d400 00000000`73a18a90 wow64!RunCpuSimulation+0xa&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008d450 00000000`739e2c52 wow64!Wow64KiUserCallbackDispatcher+0x204&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008d7a0 00000000`775411f5 wow64win!whcbfnDWORD+0xe2&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008e190 00000000`739efe4a ntdll!KiUserCallbackDispatcherContinue (TrapFrame @ 00000000`0008e058)&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008e218 00000000`739caf02 wow64win!ZwUserMessageCall+0xa&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008e220 00000000`739e281f wow64win!whNT32NtUserMessageCallCB+0x32&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008e270 00000000`739cb03e wow64win!Wow64DoMessageThunk+0x8b&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008e2b0 00000000`73a1d18f wow64win!whNtUserMessageCall+0x12e&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008e350 00000000`750c2776 wow64!Wow64SystemServiceEx+0xd7&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008ec10 00000000`73a1d286 wow64cpu!ServiceNoTurbo+0x2d&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008ecd0 00000000`73a1c69e wow64!RunCpuSimulation+0xa&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008ed20 00000000`77534966 wow64!Wow64LdrpInitialize+0x42a&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008f270 00000000`77531937 ntdll!LdrpInitializeProcess+0x17e3&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008f760 00000000`7751c34e ntdll! ?? ::FNODOBFM::`string'+0x28ff0&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 00000000`0008f7d0 00000000`00000000 ntdll!LdrInitializeThunk+0xe&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;div&gt;나머지 스레드들은 모두 대기중이라 크게 의미 없었다.&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;현재 실행중인 스레드를 보니 NTFS에서 어떤 파일을 처리중인데&amp;nbsp;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;NtQueryAttributesFile 요청으로부터 진행됐다.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;이 파일이 뭔지가 궁금했는데 64비트라 살짝 난감했다.&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;파라미터를 확인할 수 있을지 없을지 몰라서...ㅋㅋ&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;그래도 궁금해서&amp;nbsp;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;NtQueryAttributesFile의 첫번째 파라미터를 찾아보기로 했다.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;b&gt;1. 파라미터가 저장된 스택 영역&amp;nbsp;찾기&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;NtQueryAttributesFile의 함수 원형은 다음과 같고 우리가 관심있는 파라미터는 파일 이름이 들어 있는 첫번째 파라미터&amp;nbsp;ObjectAttributes다.&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;color: rgb(0, 0, 0); font-family: 'Courier New'; font-size: 9pt; line-height: 17.5499992370605px;&quot;&gt;NTSTATUS NtQueryAttributesFile(&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;pre style=&quot;padding: 5px; margin-top: 0px; margin-bottom: 0px; overflow: auto; word-wrap: normal; color: rgb(0, 0, 0); font-size: 13px; line-height: 17.5499992370605px; font-family: Consolas, Courier, monospace !important;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; font-size: 9pt;&quot;&gt;  _In_&amp;nbsp;&amp;nbsp;&amp;nbsp;POBJECT_ATTRIBUTES ObjectAttributes,
  _Out_&amp;nbsp;&amp;nbsp;PFILE_BASIC_INFORMATION FileInformation
);&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;pre style=&quot;padding: 5px; margin-top: 0px; margin-bottom: 0px; overflow: auto; word-wrap: normal; color: rgb(0, 0, 0); font-size: 13px; line-height: 17.5499992370605px; font-family: Consolas, Courier, monospace !important;&quot;&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;line-height: 16.3636360168457px;&quot;&gt;이제&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;NtQueryAttributesFile의 코드를 좀 살펴 보자.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px; font-family: 'Courier New';&quot;&gt;0: kd&amp;gt; uf nt!NtQueryAttributesFile&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!NtQueryAttributesFile:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee20 48895c2418 &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+18h],rbx&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee25 56 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rsi&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee26 57 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;rdi&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee27 4154 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;push &amp;nbsp; &amp;nbsp;r12&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee29 4881ec70020000 &amp;nbsp;sub &amp;nbsp; &amp;nbsp; rsp,270h&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee30 488b05a9fbe9ff &amp;nbsp;mov &amp;nbsp; &amp;nbsp; rax,qword ptr [nt!_security_cookie (fffff800`0344e9e0)]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee37 4833c4 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;xor &amp;nbsp; &amp;nbsp; rax,rsp&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee3a 4889842460020000 mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+260h],rax&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee42 488bda &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; rbx,rdx&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&lt;span style=&quot;background-color: rgb(250, 237, 125);&quot;&gt;fffff800`035aee45 488bf1 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; rsi,rcx&lt;/span&gt;&lt;span style=&quot;background-color: rgb(250, 237, 125);&quot;&gt;&amp;nbsp; ; 첫번째 파라미터 저장 (rsi &amp;lt;= rcx)&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee48 65488b042588010000 mov &amp;nbsp; rax,qword ptr gs:[188h]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee51 0fb6b8f6010000 &amp;nbsp;movzx &amp;nbsp; edi,byte ptr [rax+1F6h]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee58 4084ff &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;test &amp;nbsp; &amp;nbsp;dil,dil&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee5b 7432 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;je &amp;nbsp; &amp;nbsp; &amp;nbsp;nt!NtQueryAttributesFile+0x6e (fffff800`035aee8f)&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!NtQueryAttributesFile+0x3d:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee5d 488bca &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; rcx,rdx&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee60 f6c207 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;test &amp;nbsp; &amp;nbsp;dl,7&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee63 750e &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;jne &amp;nbsp; &amp;nbsp; nt!NtQueryAttributesFile+0x53 (fffff800`035aee73)&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!NtQueryAttributesFile+0x45:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee65 488b0594c1f5ff &amp;nbsp;mov &amp;nbsp; &amp;nbsp; rax,qword ptr [nt!MmUserProbeAddress (fffff800`0350b000)]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee6c 483bd0 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;cmp &amp;nbsp; &amp;nbsp; rdx,rax&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee6f 7308 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;jae &amp;nbsp; &amp;nbsp; nt!NtQueryAttributesFile+0x58 (fffff800`035aee79)&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!NtQueryAttributesFile+0x51:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee71 eb09 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;jmp &amp;nbsp; &amp;nbsp; nt!NtQueryAttributesFile+0x5b (fffff800`035aee7c)&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!NtQueryAttributesFile+0x53:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee73 e818070b00 &amp;nbsp; &amp;nbsp; &amp;nbsp;call &amp;nbsp; &amp;nbsp;nt!ExRaiseDatatypeMisalignment (fffff800`0365f590)&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee78 cc &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;int &amp;nbsp; &amp;nbsp; 3&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!NtQueryAttributesFile+0x58:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee79 488bc8 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; rcx,rax&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!NtQueryAttributesFile+0x5b:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee7c 0fb601 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;movzx &amp;nbsp; eax,byte ptr [rcx]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee7f 8801 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; byte ptr [rcx],al&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee81 0fb64127 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;movzx &amp;nbsp; eax,byte ptr [rcx+27h]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee85 884127 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; byte ptr [rcx+27h],al&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee88 eb05 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;jmp &amp;nbsp; &amp;nbsp; nt!NtQueryAttributesFile+0x6e (fffff800`035aee8f)&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;nt!NtQueryAttributesFile+0x6e:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee8f 41bcb8000000 &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; r12d,0B8h&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee95 4d8bc4 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; r8,r12&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee98 33d2 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;xor &amp;nbsp; &amp;nbsp; edx,edx&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee9a 488d4c2450 &amp;nbsp; &amp;nbsp; &amp;nbsp;lea &amp;nbsp; &amp;nbsp; rcx,[rsp+50h]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aee9f e8ec6ed2ff &amp;nbsp; &amp;nbsp; &amp;nbsp;call &amp;nbsp; &amp;nbsp;nt!memset (fffff800`032d5d90)&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aeea4 41bb08000000 &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; r11d,8&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aeeaa 6644895c2450 &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; word ptr [rsp+50h],r11w&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aeeb0 664489642452 &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; word ptr [rsp+52h],r12w&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aeeb6 b807000000 &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; eax,7&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aeebb 6689842496000000 mov &amp;nbsp; &amp;nbsp; word ptr [rsp+96h],ax&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aeec3 c78424a800000001000000 mov dword ptr [rsp+0A8h],1&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aeece c784249000000000402000 mov dword ptr [rsp+90h],204000h&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aeed9 48899c24b0000000 mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+0B0h],rbx&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aeee1 488d842410010000 lea &amp;nbsp; &amp;nbsp; rax,[rsp+110h]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aeee9 48898424b8000000 mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+0B8h],rax&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aeef1 c68424d100000001 mov &amp;nbsp; &amp;nbsp; byte ptr [rsp+0D1h],1&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aeef9 488d842450010000 lea &amp;nbsp; &amp;nbsp; rax,[rsp+150h]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef01 48898424d8000000 mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+0D8h],rax&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&lt;span style=&quot;background-color: rgb(250, 237, 125);&quot;&gt;fffff800`035aef09 4889b42480000000 mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+80h],rsi&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(250, 237, 125);&quot;&gt;&amp;nbsp; &amp;lt;= rsi 값을 스택 영역에 저장&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef11 c78424e000000020000000 mov dword ptr [rsp+0E0h],20h&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef1c 65488b042588010000 mov &amp;nbsp; rax,qword ptr gs:[188h]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef25 48ff8030030000 &amp;nbsp;inc &amp;nbsp; &amp;nbsp; qword ptr [rax+330h]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef2c 65ff042564220000 inc &amp;nbsp; &amp;nbsp; dword ptr gs:[2264h]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef34 488d442440 &amp;nbsp; &amp;nbsp; &amp;nbsp;lea &amp;nbsp; &amp;nbsp; rax,[rsp+40h]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef39 4889442430 &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+30h],rax&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef3e 488d442450 &amp;nbsp; &amp;nbsp; &amp;nbsp;lea &amp;nbsp; &amp;nbsp; rax,[rsp+50h]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef43 4889442428 &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; qword ptr [rsp+28h],rax&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef48 c744242080000000 mov &amp;nbsp; &amp;nbsp; dword ptr [rsp+20h],80h&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef50 4533c9 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;xor &amp;nbsp; &amp;nbsp; r9d,r9d&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef53 440fb6c7 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;movzx &amp;nbsp; r8d,dil&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef57 488b15eac0f5ff &amp;nbsp;mov &amp;nbsp; &amp;nbsp; rdx,qword ptr [nt!IoFileObjectType (fffff800`0350b048)]&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New'; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`035aef5e 488bce &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;mov &amp;nbsp; &amp;nbsp; rcx,rsi&amp;nbsp; &amp;nbsp; &amp;lt;= rsi 값을 첫번째 파라미터로 전달&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;fffff800`035aef61 e82a180200 &amp;nbsp; &amp;nbsp; &amp;nbsp;call &amp;nbsp; &amp;nbsp;nt!ObOpenObjectByName (fffff800`035d0790)&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;일단 64비트에서는 첫번째 파라미터를 rcx로 전달한다는 것을 알고 있으므로 첫번째 파라미터를 추적해 볼 수 있다.&amp;nbsp;&lt;/div&gt;&lt;div&gt;함수 진입부에서부터 ObOpenObjectByName을 호출할 때까지의 rcx 값의 이동을 추적하면 된다.&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`035aee45에서 rcx값을 rsi에 저장한다.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`035aef09에서 rsi값을 [rsp+80h]에 저장한다.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px; background-color: rgb(250, 237, 125);&quot;&gt;fffff800`035aef5e에서&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px; background-color: rgb(250, 237, 125);&quot;&gt;ObOpenObjectByName을 호출하기 위해&amp;nbsp;rsi를 첫번째 파라미터 rcx로 전달한다.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;ObOpenObjectByName의 첫번째 파라미터도 POBJECT_ATTRIBUTES 이기 때문이다.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;NTSTATUS STDCALL&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;ObOpenObjectByName(&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; POBJECT_ATTRIBUTES ObjectAttributes,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; POBJECT_TYPE ObjectType,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; PVOID ParseContext,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; KPROCESSOR_MODE AccessMode,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; ACCESS_MASK DesiredAccess,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; PACCESS_STATE PassedAccessState,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; PHANDLE Handle);&lt;/span&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;fffff800`035aee45와&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;fffff800`035aef61 사이에서는 rsi값이 변하지 않기 때문에 이 구간에서 rsi는&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;NtQueryAttributesFile의 첫번째 파라미터인&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;line-height: 16.3636360168457px; font-size: 11.8181819915771px;&quot;&gt;POBJECT_ATTRIBUTES다.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;fffff800`035aef09에서&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;rsi값을&amp;nbsp;[rsp+80h]에 저장해 놓았으므로&amp;nbsp;이 값을 찾으면 된다.&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;b&gt;&lt;span style=&quot;font-size: 9pt;&quot;&gt;2. 스택 기준 주소 찾기&lt;/span&gt;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 16.3636360168457px; text-align: justify;&quot;&gt;NtQueryAttributesFile 내부 코드가 실행될 때 사용하던&lt;/span&gt;&amp;nbsp;rsp를 찾아야 하는데 이것은 콜스택에서 찾을 수 있다.&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Child-SP &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;RetAddr &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Call Site&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;line-height: 16.3636360168457px;&quot;&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; ...&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; fffff880`0c441040 fffff800`035aef66 nt!ObOpenObjectByName+0x306&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;background-color: rgb(250, 237, 125);&quot;&gt;fffff880`0c441110&lt;/span&gt; fffff800`032d2e53 nt!NtQueryAttributesFile+0x145&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;/div&gt;&lt;div&gt;WinDbg 콜스택을 보면 친절하게 Child-SP라는 것을 보여주는데 이것이 함수에서 사용하는 rsp다.&lt;/div&gt;&lt;div&gt;따라서&amp;nbsp;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;NtQueryAttributesFile의 rsp는&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;fffff880`0c441110이다.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;사실 rsp가 스택 포인터라 함수 내부에서 계속 변할 것이라고 생각했는데&amp;nbsp;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;NtQueryAttributesFile 함수 코드를 들여다보면 알 수 있듯이 함수 prolog에서 rsp를 설정하고 나면 함수 내부에서&amp;nbsp;rsp 값은&amp;nbsp;변경되지 않는다. 그래서 rsp는 마치 32비트의 ebp처럼 사용된다. 64비트 콜스택에서 왜 Child-SP라는 것을 보여주는지 잘 몰랐었는데 이제야 쓸모가 있는 정보였다는 것을 알게 되었다.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 10pt; line-height: 16.3636360168457px;&quot;&gt;&lt;b&gt;&lt;span style=&quot;font-size: 9pt;&quot;&gt;3. 파라미터 내용 확인&lt;/span&gt;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;본론으로 돌아와서 [rsp+80]을 확인해 보자.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;div&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;0: kd&amp;gt; dq fffff880`0c441110+80&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;fffff880`0c441190 &amp;nbsp;&lt;span style=&quot;background-color: rgb(250, 237, 125);&quot;&gt;00000000`0008d2e0&lt;/span&gt; 00000000`00000000&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;fffff880`0c4411a0 &amp;nbsp;00070000`00200000 00000000`00000000&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;...&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;[rsp+80]에 저장된&amp;nbsp;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;00000000`0008d2e0이 POBJECT_ATTRIBUTES 다.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;0: kd&amp;gt; dt _OBJECT_ATTRIBUTES&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;ntdll!_OBJECT_ATTRIBUTES&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp;+0x000 Length &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; : Uint4B&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp;+0x008 RootDirectory &amp;nbsp; &amp;nbsp;: Ptr64 Void&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp;+0x010 ObjectName &amp;nbsp; &amp;nbsp; &amp;nbsp; : Ptr64 _UNICODE_STRING&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp;+0x018 Attributes &amp;nbsp; &amp;nbsp; &amp;nbsp; : Uint4B&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp;+0x020 SecurityDescriptor : Ptr64 Void&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp;+0x028 SecurityQualityOfService : Ptr64 Void&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;내용을 보면 각 필드의 값을&amp;nbsp;알&amp;nbsp;수 있다.&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;0: kd&amp;gt; dq 00000000`0008d2e0&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;00000000`0008d2e0 &amp;nbsp;00000032`00000030 00000000`00000000&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;00000000`0008d2f0 &amp;nbsp;00000000`0008d2d0 00000000`00000040&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;00000000`0008d300 &amp;nbsp;00000000`00000000 00000000`00000000&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;...&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;필드를 대입해 보면 다음과 같다.&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;Length: 30&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;RootDirectory: 0&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;ObjectName: 00000000`0008d2d0&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;Attributes: 40&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;SecurityDescriptor: 0&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;SecurityQualityOfService: 0&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;_UNICODE_STRING 타입인 ObjectName&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;00000000`0008d2d0를 확인해 보면 다음과 같다.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;0: kd&amp;gt; dt _UNICODE_STRING 00000000`0008d2d0&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;ntdll!_UNICODE_STRING&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp;&quot;\??\D:\TEMP\Project\TestTool\dummy\dummy.cpp&quot;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp;+0x000 Length &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; : 0x5A&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp;+0x002 MaximumLength &amp;nbsp; &amp;nbsp;: 0x21a&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 11.8181819915771px; font-family: 'Courier New';&quot;&gt;&amp;nbsp; &amp;nbsp;+0x008 Buffer &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; : 0x00000000`04ffd1b8 &amp;nbsp;&quot;\??\D:\TEMP\Project\TestTool\dummy\dummy.cpp&quot;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;b&gt;4. 문제의 원인&lt;/b&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;파일 경로를 보니 번뜩 머리를 스치는 것이 있다.&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;'아뿔싸... 저 경로는 현재 존재하지 않는 경로다.'&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;얼마전에 개발 장비를 변경하면서 개발 환경을 그대로 복사한게 문제였다.&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;Visual Studio의 임시 파일들을&amp;nbsp;그대로 복사해 왔는데 데이터 디스크(D:)는 새로 구성하는 바람에 D:\TEMP는&amp;nbsp;존재하지 않는다.&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;존재하지 않는 경로의 파일을 읽어대려고 Visual Studio는 그렇게 버벅대고 있었나 부다.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;Visual&amp;nbsp;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;Studio&lt;/span&gt;의 임시 파일들을 모두 삭제하고 나니 행이 없어졌다.&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;만세!!!&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</description>
<category>WinDbg 디버깅</category>
<author>GreeMate</author>
<guid>https://greemate.tistory.com/265</guid>
<comments>https://greemate.tistory.com/entry/64-bit%EC%97%90%EC%84%9C-NtQueryAttributesFile-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0-%EC%B0%BE%EA%B8%B0#entry265comment</comments>
<pubDate>Tue, 27 Jan 2015 23:05:00 +0900</pubDate>
</item>
<item>
<title>2015년 목표</title>
<link>https://greemate.tistory.com/entry/2015%EB%85%84-%EB%AA%A9%ED%91%9C</link>
<description>&lt;p&gt;1. 미드, 영화 닥치는대로 보기&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; 교양 생활을 많이 해야할 필요가 느껴져 간접 체험을 많이 해 보기로 한다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;2. 구입후 읽지 않은 책 모두 보기&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; 관심이 있어 구입했지만 첫장도 펼쳐 보지 않은 책이 십여권이다. ㅠㅠ&amp;nbsp;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; 속독으로라도&amp;nbsp;이제 좀 읽자.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;3. 주말에 아이들 책읽어 주기&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; 몇 달 동안 잘 하다가&amp;nbsp;한동안 못했더니 최근에&amp;nbsp;책읽어 줄 때의 장점을 깨달았다.&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; 아이들 책이지만 굉장히 많은 사실들을 오히려 내가 알게 된다는 것...&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; 아이들에게 점수도 따고 나도 재미있고 일석이조다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;가벼운 목표처럼 보이는 가볍지 않은 목표다.&lt;/p&gt;&lt;p&gt;활기차게&amp;nbsp;2015년을 시작해 보자. ㅋㅋ&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;새해 복 많이 받으세요.^^&lt;/p&gt;</description>
<category>끄적끄적</category>
<author>GreeMate</author>
<guid>https://greemate.tistory.com/267</guid>
<comments>https://greemate.tistory.com/entry/2015%EB%85%84-%EB%AA%A9%ED%91%9C#entry267comment</comments>
<pubDate>Mon, 05 Jan 2015 08:37:42 +0900</pubDate>
</item>
<item>
<title>2014년 정리</title>
<link>https://greemate.tistory.com/entry/2014%EB%85%84-%EC%A0%95%EB%A6%AC</link>
<description>&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;1. 스카이프 전화영어 다시 시작&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;&amp;nbsp; &amp;nbsp; 1년간 잘 수행했다. ^^&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;2. 블로그 영문화&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;&amp;nbsp; &amp;nbsp; 일단 오픈은 했다. 지속적으로 포스팅할 수 있을지가 관건이다. ㅋㅋ&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;&amp;nbsp; &amp;nbsp; &lt;a href=&quot;http://windbgwindbg.blogspot.com&quot; target=&quot;_blank&quot; class=&quot;tx-link&quot;&gt;windbgwindbg.blogspot.com&lt;/a&gt;&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;3. 2주에 한번은 주말에&amp;nbsp;가족들과 어디론가 가 보기&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;&amp;nbsp; &amp;nbsp; 그늘막 텐트를 구매해 주로 한강 고수부지를 방문했다.&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;&amp;nbsp; &amp;nbsp; 공도 차고 무선 자동차도 굴리고 여유있게 누워있기도 하고 간식도 먹고... 좋았다.&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;정리하고 보니 80점 정도는 줄 수 있을 것 같다.&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;올해도 잘 마무리한 것 같다. ㅋㅋㅋ&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;color: rgb(85, 85, 85); font-family: Tahoma; font-size: 11.8181819915771px; line-height: 21.6000022888184px; text-align: justify; padding-top: 0px !important; padding-bottom: 0px !important; margin-top: 0px !important; margin-bottom: 0px !important;&quot;&gt;PS) 새해 복 많이 받으세요.&lt;/p&gt;</description>
<category>끄적끄적</category>
<author>GreeMate</author>
<guid>https://greemate.tistory.com/266</guid>
<comments>https://greemate.tistory.com/entry/2014%EB%85%84-%EC%A0%95%EB%A6%AC#entry266comment</comments>
<pubDate>Wed, 31 Dec 2014 19:38:59 +0900</pubDate>
</item>
<item>
<title>[Tip] Mac OS에서 윈도우 가상 머신 커널 디버깅</title>
<link>https://greemate.tistory.com/entry/Mac-OS%EC%97%90%EC%84%9C-%EC%9C%88%EB%8F%84%EC%9A%B0-%EA%B0%80%EC%83%81-%EB%A8%B8%EC%8B%A0-%EC%BB%A4%EB%84%90-%EB%94%94%EB%B2%84%EA%B9%85</link>
<description>&lt;p&gt;나의 맥북 에어에서 자유롭게 Windows 커널 디버깅을 하고 싶었는데...&lt;/p&gt;&lt;p&gt;Parallels가 있으니 Windows 가상 머신 두개 띄우고 어찌 어찌 연결할 수 있지 않을까 해서 검색을 시작했는데...&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;지금 내게 딱 필요한 링크를 발견했다. ㅋㅋ&lt;/p&gt;&lt;p&gt;사뿐히 링크!&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;http://s3ize.blogspot.kr/2012/09/tip-os-x-windbg-windows-kernel-debugging_21.html&quot; target=&quot;_blank&quot; class=&quot;tx-link&quot;&gt;http://s3ize.blogspot.kr/2012/09/tip-os-x-windbg-windows-kernel-debugging_21.html&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</description>
<category>WinDbg 디버깅</category>
<category>Parallels</category>
<author>GreeMate</author>
<guid>https://greemate.tistory.com/264</guid>
<comments>https://greemate.tistory.com/entry/Mac-OS%EC%97%90%EC%84%9C-%EC%9C%88%EB%8F%84%EC%9A%B0-%EA%B0%80%EC%83%81-%EB%A8%B8%EC%8B%A0-%EC%BB%A4%EB%84%90-%EB%94%94%EB%B2%84%EA%B9%85#entry264comment</comments>
<pubDate>Tue, 16 Dec 2014 09:24:44 +0900</pubDate>
</item>
<item>
<title>죽음이란 무엇인가 - 샐리 케이건</title>
<link>https://greemate.tistory.com/entry/%EC%A3%BD%EC%9D%8C%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80-%EC%83%90%EB%A6%AC-%EC%BC%80%EC%9D%B4%EA%B1%B4</link>
<description>&lt;p style=&quot;text-align: center; clear: none; float: none;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;text-align: center; clear: none; float: none;&quot;&gt;&lt;span class=&quot;imageblock&quot; style=&quot;display:inline-block;width:150px;;height:auto;max-width:100%&quot;&gt;&lt;img src=&quot;https://t1.daumcdn.net/cfile/tistory/222E993F5480F41D1C&quot; filemime=&quot;image/jpeg&quot; filename=&quot;죽음이란 무엇인가_2.jpg&quot; height=&quot;222&quot; width=&quot;150&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;나의 평점 : 5.0 / 5.0&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;책 제목을 보고 오해가 있을 것 같은데 주제를&amp;nbsp;굳이 좀 더 표현하자면&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&quot;죽음을 대하는 자세&quot;라고 해야 맞을 것 같다.&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;(죽음의 실체와 그 이후가 궁금하다면 '&lt;a href=&quot;http://greemate.tistory.com/entry/%ED%8B%B0%EB%B2%B3-%EC%82%AC%EC%9E%90%EC%9D%98-%EC%84%9C-%ED%8C%8C%EB%93%9C%EB%A7%88%EC%82%BC%EB%B0%94%EB%B0%94%EB%A5%98%EC%8B%9C%ED%99%94%EC%97%AD&quot; target=&quot;_blank&quot; class=&quot;tx-link&quot;&gt;사자의 서&lt;/a&gt;'를 읽는 편이 나을 것이다.)&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;전체적인 내용은 사람들이 죽음에 대해 인식하는 부분에 대한&amp;nbsp;철학적인 논의다.&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;예를 들면, 영생할 수 있는가? 영혼은 있는가? 죽음은 나쁜 것인가? 뭐 이런 것들이다.&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;책을 읽자마자 빠져들었던 이유는 매우 논리적인 구술이 이어지기 때문이었다.&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;철학자들이 모두 이렇게 사고하는지는 잘 모르겠지만 인문계열이라고 생각했던&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;철학 교수의 논조가 전혀 문학적이지 않고 지극히 논리적인 문장 구조를 가지고&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;전개되고 있었기 때문에 읽기가 매우 편했다. (이 부분은 매우 개인적인 관점이다.&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;일반인들은 읽기 편하지 않을 수 있다. 심지어는 나도 후반부에 가서는 힘들었다. ㅠㅠ)&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;예를 들면 A라는 가정을 두고&amp;nbsp;설명을 이어가는데 읽다보니 '그렇다면 B라는 가정도&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;할 수 있는거 아냐?'라는 생각이 든다. 그러면 바로 다음 문단에 귀신같이 &quot;이제 B라는&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;가정을 해 보자&quot;가 적혀 있다. 설명중에 약간 억지스러운 주장이 있어 '뭐야 이건 억지잖아'&amp;nbsp;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;생각하고 있으면 다음 문단에 &quot;이건 억지라고 생각할 수 있겠지만...&quot; 이 바로 튀어 나온다.&amp;nbsp;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;ㅋㅋ&amp;nbsp;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;font-size: 11.8181819915771px; line-height: 16.3636360168457px;&quot;&gt;예상했던 내용들을&lt;/span&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;&amp;nbsp;if else 구조로&amp;nbsp;친절하게 설명해 주신다.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;서두부터 이 아저씨의 주장이 바로 나오니 여기서도 밝혀도 되겠다.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;이 분은 죽음을 물리주의적 관점으로 해석해야 한다는 편의 철학자고&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;물리주의적 관점이란 영혼은 없고 영생도 없고 육체가 죽음과 동시에&amp;nbsp;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;우리가 영혼이라고&amp;nbsp;생각하는 정신적인 부분도 동시에 사라진다는 것이다.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;처음부터 이런 정의를 내린 후에 영혼을 믿는 사람, 영생을 믿는 사람을 위해&amp;nbsp;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;반박 주장들을 조곤조곤 해 나가는 것이 이 책의 전반적인 내용이다.&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;다 읽고나서 정리해 보니 죽음 이후에는 좋은 것은 없고&amp;nbsp;나쁜 것도 없다는 주장이다.&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;죽음 이후에 아무것도 없으니 사실상 주제는 어떻게 살아야 하는가로 돌아간다.&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;가장 가치 있는 것은 지금 내가 활동중인&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;지금 이 순간이라는 생각이 든다.&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5;&quot;&gt;미래보다 과거보다 지금 이 순간이&amp;nbsp;가장 가치있고&amp;nbsp;행복해야 한다. ^^&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;br /&gt;&lt;/p&gt;</description>
<category>책좀읽자</category>
<author>GreeMate</author>
<guid>https://greemate.tistory.com/263</guid>
<comments>https://greemate.tistory.com/entry/%EC%A3%BD%EC%9D%8C%EC%9D%B4%EB%9E%80-%EB%AC%B4%EC%97%87%EC%9D%B8%EA%B0%80-%EC%83%90%EB%A6%AC-%EC%BC%80%EC%9D%B4%EA%B1%B4#entry263comment</comments>
<pubDate>Sun, 07 Dec 2014 23:30:48 +0900</pubDate>
</item>
<item>
<title>멈추면, 비로소 보이는 것들 - 혜민스님</title>
<link>https://greemate.tistory.com/entry/%EB%A9%88%EC%B6%94%EB%A9%B4-%EB%B9%84%EB%A1%9C%EC%86%8C-%EB%B3%B4%EC%9D%B4%EB%8A%94-%EA%B2%83%EB%93%A4-%ED%98%9C%EB%AF%BC%EC%8A%A4%EB%8B%98</link>
<description>&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;text-align: center; clear: none; float: none;&quot;&gt;&lt;span class=&quot;imageblock&quot; style=&quot;display:inline-block;width:134px;;height:auto;max-width:100%&quot;&gt;&lt;img src=&quot;https://t1.daumcdn.net/cfile/tistory/2117F3365409BB131D&quot; filemime=&quot;image/jpeg&quot; filename=&quot;멈추면비로소보이는것들.jpg&quot; height=&quot;183&quot; width=&quot;134&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;나의 평점 : 4.5 / 5.0&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;이 책의&amp;nbsp;내용을 한 문장으로 요약하면 다음과 같다.&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;&quot;돈을 추구하지 말고 자신의 행복을 추구하라&quot;&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;본문 중 이를 표현하는 한 구절만 옮겨본다.&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;&quot;우리를 진정으로 행복하게 만드는 것 중 하나는&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;&amp;nbsp;누군가 나의 가치를 알아주고&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;&amp;nbsp;관심을 가져준다는 사실을 알았을 때입니다.&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;&amp;nbsp;아무리 부와 권력을 가졌다고 해도&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;&amp;nbsp;아무도 관심을 가져주지 않으면 불행합니다.&quot;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</description>
<category>책좀읽자</category>
<author>GreeMate</author>
<guid>https://greemate.tistory.com/259</guid>
<comments>https://greemate.tistory.com/entry/%EB%A9%88%EC%B6%94%EB%A9%B4-%EB%B9%84%EB%A1%9C%EC%86%8C-%EB%B3%B4%EC%9D%B4%EB%8A%94-%EA%B2%83%EB%93%A4-%ED%98%9C%EB%AF%BC%EC%8A%A4%EB%8B%98#entry259comment</comments>
<pubDate>Mon, 15 Sep 2014 23:29:40 +0900</pubDate>
</item>
<item>
<title>[Tip] 프로세스 크래시 발생시 유저덤프 남기기</title>
<link>https://greemate.tistory.com/entry/Tip-Windows-7%EC%97%90%EC%84%9C-%EC%9C%A0%EC%A0%80%EB%AA%A8%EB%93%9C-%ED%81%AC%EB%9E%98%EC%8B%9C-%EB%8D%A4%ED%94%84-%EC%BC%9C%EA%B8%B0</link>
<description>&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5; background-color: transparent;&quot;&gt;프로&lt;/span&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5; background-color: transparent;&quot;&gt;세스가 크래시될 때 유저모드 전체 덤프가 생성되도록 설정하는 방법이다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: rgb(219, 232, 251);&quot;&gt;&lt;br /&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5; background-color: transparent;&quot;&gt;1. Vista&amp;nbsp;이상&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;Vista부터 Windows Error Reporting이 생기면서 자동으로 MS에 덤프를 전송하게 됐는데...&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5; background-color: transparent;&quot;&gt;정작 로컬 시스템에는 덤프를 남기지 않는다.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;이런 경우 다음 레지스트리 설정을 통해 덤프를 남기도록 설정할 수 있다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;b style=&quot;font-size: 9pt; color: rgb(69, 69, 69); font-family: Dotum, 돋움; line-height: 20.006000518798828px; background-color: transparent;&quot;&gt;&lt;span style=&quot;font-family: Verdana;&quot;&gt;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\Windows Error Reporting\LocalDumps&lt;/span&gt;&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5; font-family: Verdana; background-color: transparent;&quot;&gt;DumpFolder =&amp;nbsp;%LOCALAPPDATA%\CrashDumps (원하는 경로로 변경해도 됨)&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-family: Verdana;&quot;&gt;DumpType = 2 &amp;nbsp; &amp;nbsp; (2는 전체덤프)&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;자세한 설명은 다음 링크를 참고한다.&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;http://msdn.microsoft.com/ko-kr/library/windows/desktop/bb787181(v=vs.85).aspx&quot; target=&quot;_blank&quot; class=&quot;tx-link&quot;&gt;http://msdn.microsoft.com/ko-kr/library/windows/desktop/bb787181(v=vs.85).aspx&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;2. XP 이하&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;닥터 왓슨이 덤프를 남기지 못하는 경우가 있기 때문에 ntsd를 이용해 수동으로 설정해서 유저덤프를 얻는 방법도 있다.&lt;/p&gt;&lt;p&gt;크래시 발생시 실행 디버거를 다음과 같이 ntsd로 설정한다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;b&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5; font-family: Verdana; color: rgb(51, 51, 51);&quot;&gt;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\AeDebug&lt;/span&gt;&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-family: Verdana;&quot;&gt;Debugger =&amp;nbsp;ntsd -p %ld -e %ld&amp;nbsp;-c &quot;.dump /ma&amp;nbsp;/u C:\Dumps\UserDump.dmp; q&quot;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;64비트 OS라면 32비트 프로세스를 위해 다음도 추가해 준다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;div class=&quot;txc-textbox&quot; style=&quot;border: 1px solid rgb(219, 232, 251); padding: 10px; background-color: rgb(219, 232, 251);&quot;&gt;&lt;p&gt;&lt;b&gt;&lt;span style=&quot;font-family: Verdana;&quot;&gt;HKEY_LOCAL_MACHINE\SO&lt;/span&gt;&lt;span style=&quot;font-family: Verdana;&quot;&gt;FTWARE\&lt;/span&gt;&lt;span style=&quot;font-family: Verdana; font-size: 13px; line-height: 22.100000381469727px;&quot;&gt;Wow6432Node&lt;/span&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5; background-color: transparent;&quot;&gt;&lt;span style=&quot;font-family: Verdana;&quot;&gt;\Mi&lt;/span&gt;&lt;span style=&quot;font-family: Verdana;&quot;&gt;crosoft\Windows NT\CurrentVersion\AeDebug&lt;/span&gt;&lt;/span&gt;&lt;/b&gt;&lt;/p&gt;&lt;div&gt;&lt;p&gt;&lt;span style=&quot;font-family: Verdana;&quot;&gt;Debugger =&amp;nbsp;ntsd -p %ld -e %ld&amp;nbsp;-c &quot;.dump /ma&amp;nbsp;/u C:\Dumps\UserDump.dmp; q&quot;&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;참고할 만한 링크는 다음과 같다.&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;http://support.citrix.com/article/ctx105888&quot; target=&quot;_blank&quot; class=&quot;tx-link&quot;&gt;http://support.citrix.com/article/ctx105888&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;</description>
<category>WinDbg 디버깅</category>
<category>aedebug</category>
<category>DumpFolder</category>
<category>LocalDumps</category>
<category>ntsd</category>
<author>GreeMate</author>
<guid>https://greemate.tistory.com/256</guid>
<comments>https://greemate.tistory.com/entry/Tip-Windows-7%EC%97%90%EC%84%9C-%EC%9C%A0%EC%A0%80%EB%AA%A8%EB%93%9C-%ED%81%AC%EB%9E%98%EC%8B%9C-%EB%8D%A4%ED%94%84-%EC%BC%9C%EA%B8%B0#entry256comment</comments>
<pubDate>Tue, 02 Sep 2014 00:29:57 +0900</pubDate>
</item>
<item>
<title>Mac OS X Source 한방에 받기</title>
<link>https://greemate.tistory.com/entry/Mac-OS-X-Source-%ED%95%9C%EB%B0%A9%EC%97%90-%EB%B0%9B%EA%B8%B0</link>
<description>&lt;p&gt;Mac OS X는 오픈 소스라서 소스를 좀 받아 보려고 했더니 다음과 같이 일일이 Downloads 버튼을 눌러야 하는 귀찮은 문제가 있었다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p style=&quot;text-align: center; clear: none; float: none;&quot;&gt;&lt;span class=&quot;imageblock&quot; style=&quot;display:inline-block;width:600px;;height:auto;max-width:100%&quot;&gt;&lt;img src=&quot;https://t1.daumcdn.net/cfile/tistory/2574C94E53F35D8709&quot; filemime=&quot;image/jpeg&quot; filename=&quot;스크린샷 2014-08-19 오전 9.48.30.png&quot; height=&quot;313&quot; width=&quot;600&quot;/&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;노가다를 하기 싫어서 좀 찾아보니 깔끔하게 스크립트를 만들어 두신 분이 계셨다. 감사감사 ^^b&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;http://hints.macworld.com/article.php?story=20091014194517371&quot; target=&quot;_blank&quot; class=&quot;tx-link&quot;&gt;http://hints.macworld.com/article.php?story=20091014194517371&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;스크립트 복사하고 하라는 대로 하면 된다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;현재 최신 버전인 10.9.2를 다운로드하려면 스크립트를 약간 고쳐줘야 한다.&lt;/p&gt;&lt;p&gt;스크립트에서 5번째 라인을 다음과 같이 수정한다.&lt;/p&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; version=&quot;mac-os-x-`echo $* | tr -d &quot;.&quot;`&quot;&lt;/p&gt;&lt;div&gt;&lt;div&gt;=&amp;gt; &amp;nbsp;version=&quot;os-x-`echo $* | tr -d &quot;.&quot;`&quot;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br /&gt;&lt;/div&gt;&lt;div&gt;10.8까지는 URL 경로가 &quot;&lt;span style=&quot;font-size: 9pt; line-height: 1.5; background-color: transparent;&quot;&gt;mac-os-x-&quot;로 시작했는데 10.9부터 &quot;&lt;/span&gt;&lt;span style=&quot;font-size: 9pt; line-height: 1.5; background-color: transparent;&quot;&gt;os-x-&quot;로 변경됐다.&lt;/span&gt;&lt;/div&gt;&lt;p&gt;&lt;br /&gt;&lt;/p&gt;&lt;p&gt;수정하고 실행하면&amp;nbsp;끝!&lt;/p&gt;</description>
<category>Mac OS X</category>
<author>GreeMate</author>
<guid>https://greemate.tistory.com/257</guid>
<comments>https://greemate.tistory.com/entry/Mac-OS-X-Source-%ED%95%9C%EB%B0%A9%EC%97%90-%EB%B0%9B%EA%B8%B0#entry257comment</comments>
<pubDate>Tue, 19 Aug 2014 23:52:08 +0900</pubDate>
</item>
</channel>
</rss>